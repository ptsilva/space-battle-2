var I=Object.defineProperty;var R=(p,t,e)=>t in p?I(p,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):p[t]=e;var h=(p,t,e)=>R(p,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function e(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=e(s);fetch(s.href,o)}})();class d{constructor(t=0,e=0){h(this,"x");h(this,"y");this.x=t,this.y=e}add(t){return new d(this.x+t.x,this.y+t.y)}subtract(t){return new d(this.x-t.x,this.y-t.y)}multiply(t){return new d(this.x*t,this.y*t)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const t=this.magnitude();return t===0?new d(0,0):new d(this.x/t,this.y/t)}distance(t){const e=this.x-t.x,i=this.y-t.y;return Math.sqrt(e*e+i*i)}clone(){return new d(this.x,this.y)}}class m{constructor(t,e,i,s,o,a,c,f=4,u=12){h(this,"position");h(this,"velocity");h(this,"width",4);h(this,"height",12);h(this,"damage");h(this,"isPlayerProjectile");h(this,"color");this.position=new d(t,e),this.velocity=new d(i,s),this.damage=o,this.isPlayerProjectile=a,this.color=c,this.width=f,this.height=u}update(t){this.position.x+=this.velocity.x*t/1e3,this.position.y+=this.velocity.y*t/1e3}render(t){t.save(),t.shadowColor=this.color,t.shadowBlur=5,t.fillStyle=this.color,this.isPlayerProjectile?(t.beginPath(),t.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),t.fill()):this.width>6?(t.beginPath(),t.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),t.fill()):t.fillRect(this.position.x,this.position.y,this.width,this.height),t.restore()}}var y=(p=>(p.HEALTH="health",p.SHIELD="shield",p.WEAPON="weapon",p.SPEED="speed",p))(y||{});class B{constructor(t,e){h(this,"position");h(this,"velocity");h(this,"width",30);h(this,"height",30);h(this,"type");h(this,"color");h(this,"lifeTime",15e3);h(this,"age",0);h(this,"pulseTimer",0);this.position=new d(t,e),this.velocity=new d(0,50);const i=Object.values(y);this.type=i[Math.floor(Math.random()*i.length)],this.color=this.getColor()}getColor(){switch(this.type){case"health":return"#00ff00";case"shield":return"#0088ff";case"weapon":return"#ff4400";case"speed":return"#ffff00";default:return"#ffffff"}}update(t){this.age+=t,this.pulseTimer+=t,this.position.x+=this.velocity.x*t/1e3,this.position.y+=this.velocity.y*t/1e3}isExpired(){return this.age>=this.lifeTime}render(t){t.save();const e=Math.sin(this.pulseTimer*.005)*.3+.7,i=this.age>this.lifeTime-3e3?Math.sin(this.age*.01)*.5+.5:1;t.globalAlpha=i,t.shadowColor=this.color,t.shadowBlur=10*e,t.fillStyle=this.color,t.strokeStyle="#ffffff",t.lineWidth=2;const s=this.position.x+this.width/2,o=this.position.y+this.height/2,a=this.width/2*e;switch(this.type){case"health":t.fillRect(s-a*.6,o-a*.2,a*1.2,a*.4),t.fillRect(s-a*.2,o-a*.6,a*.4,a*1.2);break;case"shield":t.beginPath(),t.arc(s,o,a,0,Math.PI*2),t.fill(),t.stroke();break;case"weapon":t.beginPath(),t.moveTo(s,o-a),t.lineTo(s-a*.5,o+a),t.lineTo(s+a*.5,o+a),t.closePath(),t.fill(),t.stroke();break;case"speed":t.beginPath(),t.moveTo(s-a*.3,o-a),t.lineTo(s+a*.3,o-a*.2),t.lineTo(s-a*.1,o-a*.2),t.lineTo(s+a*.3,o+a),t.lineTo(s-a*.3,o+a*.2),t.lineTo(s+a*.1,o+a*.2),t.closePath(),t.fill(),t.stroke();break}t.restore()}}class D{constructor(t,e){h(this,"position");h(this,"velocity");h(this,"width",40);h(this,"height",40);h(this,"hp",100);h(this,"maxHp",100);h(this,"shield",100);h(this,"maxShield",100);h(this,"speed",300);h(this,"damage",25);h(this,"fireRate",300);h(this,"ramDamage",50);h(this,"upgrades",{weapon:1,shield:1,hp:1,speed:1});h(this,"lastShot",0);h(this,"shootCooldown",300);h(this,"lastDamageTime",0);h(this,"shieldRegenDelay",3e3);h(this,"shieldRegenRate",20);h(this,"powerUpEffects",new Map);this.position=new d(t,e),this.velocity=new d(0,0),this.initializeStats()}initializeStats(){this.maxHp=100+(this.upgrades.hp-1)*25,this.hp=this.maxHp,this.maxShield=100+(this.upgrades.shield-1)*30,this.shield=this.maxShield,this.speed=300+(this.upgrades.speed-1)*50,this.damage=25+(this.upgrades.weapon-1)*10,this.fireRate=300-(this.upgrades.weapon-1)*30,this.shootCooldown=this.fireRate}update(t,e,i){this.velocity.x=0,this.velocity.y=0,e.isMovingLeft()&&(this.velocity.x-=1),e.isMovingRight()&&(this.velocity.x+=1),e.isMovingUp()&&(this.velocity.y-=1),e.isMovingDown()&&(this.velocity.y+=1);const s=e.getTouchInput();if(s){const a=s.x-this.width/2,c=s.y-this.height/2,f=a-this.position.x,u=c-this.position.y,S=Math.sqrt(f*f+u*u);S>5&&(this.velocity.x=f/S,this.velocity.y=u/S)}this.velocity.x!==0&&this.velocity.y!==0&&(this.velocity.x*=.707,this.velocity.y*=.707);const o=this.getCurrentSpeed();this.position.x+=this.velocity.x*o*t/1e3,this.position.y+=this.velocity.y*o*t/1e3,this.position.x=Math.max(0,Math.min(i.width-this.width,this.position.x)),this.position.y=Math.max(0,Math.min(i.height-this.height,this.position.y)),this.lastShot+=t,Date.now()-this.lastDamageTime>this.shieldRegenDelay&&this.shield<this.maxShield&&(this.shield=Math.min(this.maxShield,this.shield+this.shieldRegenRate*t/1e3)),this.updatePowerUpEffects(t)}getCurrentSpeed(){let t=this.speed;return this.powerUpEffects.has(y.SPEED)&&(t*=1.5),t}updatePowerUpEffects(t){for(const[e,i]of this.powerUpEffects.entries()){const s=i-t;s<=0?this.powerUpEffects.delete(e):this.powerUpEffects.set(e,s)}}shoot(){if(this.lastShot>=this.shootCooldown){this.lastShot=0;const t=this.getCurrentDamage();return new m(this.position.x+this.width/2-2,this.position.y,0,-800,t,!0,"#00ffff")}return null}getCurrentDamage(){let t=this.damage;return this.powerUpEffects.has(y.WEAPON)&&(t*=2),t}takeDamage(t){if(this.lastDamageTime=Date.now(),this.shield>0){const e=Math.min(this.shield,t);this.shield-=e,t-=e}t>0&&(this.hp=Math.max(0,this.hp-t))}applyPowerUp(t){switch(t.type){case y.HEALTH:this.hp=Math.min(this.maxHp,this.hp+30);break;case y.SHIELD:this.shield=Math.min(this.maxShield,this.shield+50);break;case y.WEAPON:this.powerUpEffects.set(y.WEAPON,1e4);break;case y.SPEED:this.powerUpEffects.set(y.SPEED,8e3);break}}upgrade(t){this.upgrades[t]++,this.initializeStats()}getUpgradeCost(t){return Math.floor({weapon:100,shield:150,hp:200,speed:120}[t]*Math.pow(1.5,this.upgrades[t]-1))}getUpgrades(){return{...this.upgrades}}applyUpgrades(t){this.upgrades={...t},this.initializeStats()}reset(t,e){this.position.x=t,this.position.y=e,this.velocity.x=0,this.velocity.y=0,this.hp=this.maxHp,this.shield=this.maxShield,this.lastShot=0,this.lastDamageTime=0,this.powerUpEffects.clear()}render(t){t.save(),this.shield>0&&(t.strokeStyle=`rgba(68, 68, 255, ${this.shield/this.maxShield*.5})`,t.lineWidth=3,t.beginPath(),t.arc(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2+5,0,Math.PI*2),t.stroke()),this.powerUpEffects.has(y.WEAPON)&&(t.shadowColor="#ff0000",t.shadowBlur=10),this.powerUpEffects.has(y.SPEED)&&(t.strokeStyle="#ffff00",t.lineWidth=2,t.strokeRect(this.position.x-2,this.position.y-2,this.width+4,this.height+4)),t.fillStyle="#00ffff",t.beginPath(),t.moveTo(this.position.x+this.width/2,this.position.y),t.lineTo(this.position.x,this.position.y+this.height),t.lineTo(this.position.x+this.width/4,this.position.y+this.height*.8),t.lineTo(this.position.x+this.width*.75,this.position.y+this.height*.8),t.lineTo(this.position.x+this.width,this.position.y+this.height),t.closePath(),t.fill(),t.fillStyle="#ff4444",t.beginPath(),t.ellipse(this.position.x+this.width/2,this.position.y+this.height+5,8,12,0,0,Math.PI*2),t.fill(),t.restore()}}const g=class g{constructor(t,e,i,s){h(this,"position");h(this,"velocity");h(this,"width",30);h(this,"height",30);h(this,"hp",25);h(this,"maxHp",25);h(this,"damage",15);h(this,"scoreValue",50);h(this,"coinValue",5);h(this,"type");h(this,"speed",150);h(this,"lastShot",0);h(this,"shootCooldown",2e3);h(this,"movementPattern");h(this,"patternTimer",0);h(this,"specialTimer",0);h(this,"burstCount",0);this.position=new d(t,e),this.velocity=new d(0,0),s?this.type=s:this.type=this.selectEnemyType(i),this.initializeStats(i),this.movementPattern=Math.floor(Math.random()*4)}selectEnemyType(t){const e=Math.random();return t<=3?e<.7?"scout":"fighter":t<=7?e<.4?"scout":e<.65?"fighter":e<.85?"heavy":"bomber":e<.25?"scout":e<.45?"fighter":e<.65?"heavy":e<.8?"bomber":e<.95?"interceptor":"destroyer"}initializeStats(t){const e=1+(t-1)*.1;switch(this.type){case"scout":this.width=30,this.height=30,this.maxHp=Math.floor(25*e*g.difficultyMultiplier),this.speed=150+t*10,this.damage=Math.floor(15*e),this.shootCooldown=2e3,this.scoreValue=50,this.coinValue=5;break;case"fighter":this.width=40,this.height=40,this.maxHp=Math.floor(50*e*g.difficultyMultiplier),this.speed=100+t*8,this.damage=Math.floor(25*e),this.shootCooldown=1500,this.scoreValue=100,this.coinValue=10;break;case"heavy":this.width=60,this.height=50,this.maxHp=Math.floor(100*e*g.difficultyMultiplier),this.speed=60+t*5,this.damage=Math.floor(40*e),this.shootCooldown=1e3,this.scoreValue=200,this.coinValue=20;break;case"bomber":this.width=50,this.height=45,this.maxHp=Math.floor(75*e*g.difficultyMultiplier),this.speed=80+t*6,this.damage=Math.floor(35*e),this.shootCooldown=3e3,this.scoreValue=150,this.coinValue=15;break;case"interceptor":this.width=35,this.height=35,this.maxHp=Math.floor(40*e*g.difficultyMultiplier),this.speed=200+t*15,this.damage=Math.floor(20*e),this.shootCooldown=800,this.scoreValue=120,this.coinValue=12;break;case"destroyer":this.width=70,this.height=60,this.maxHp=Math.floor(150*e*g.difficultyMultiplier),this.speed=50+t*4,this.damage=Math.floor(50*e),this.shootCooldown=1200,this.scoreValue=300,this.coinValue=30;break}this.hp=this.maxHp}update(t,e,i){this.patternTimer+=t,this.specialTimer+=t,this.lastShot+=t,this.updateMovement(e),this.position.x+=this.velocity.x*t/1e3,this.position.y+=this.velocity.y*t/1e3,this.position.x=Math.max(0,Math.min(i.width-this.width,this.position.x))}updateMovement(t){switch(this.type){case"scout":this.updateScoutMovement();break;case"fighter":this.updateFighterMovement();break;case"heavy":this.updateHeavyMovement();break;case"bomber":this.updateBomberMovement(t);break;case"interceptor":this.updateInterceptorMovement(t);break;case"destroyer":this.updateDestroyerMovement(t);break}}updateScoutMovement(){switch(this.movementPattern){case 0:this.velocity.y=this.speed,this.velocity.x=0;break;case 1:this.velocity.y=this.speed*.7,this.velocity.x=Math.sin(this.patternTimer*.003)*this.speed*.5;break;case 2:this.velocity.y=this.speed*.8,this.velocity.x=Math.sin(this.patternTimer*.005)*this.speed*.3;break;case 3:this.velocity.y=this.speed*.6,this.velocity.x=Math.cos(this.patternTimer*.004)*this.speed*.4;break}}updateFighterMovement(){this.velocity.y=this.speed*.7,this.velocity.x=Math.sin(this.patternTimer*.006)*this.speed*.6}updateHeavyMovement(){this.velocity.y=this.speed,this.velocity.x=Math.sin(this.patternTimer*.002)*this.speed*.2}updateBomberMovement(t){const e=t.x-this.position.x;this.velocity.y=this.speed*.5,this.velocity.x=Math.sign(e)*this.speed*.3}updateInterceptorMovement(t){const e=t.x-this.position.x,i=t.y-this.position.y,s=Math.sqrt(e*e+i*i);s>0&&(this.velocity.x=e/s*this.speed*.4+Math.sin(this.patternTimer*.008)*this.speed*.3,this.velocity.y=Math.max(i/s*this.speed*.2,this.speed*.6))}updateDestroyerMovement(t){const e=t.x-this.position.x;this.velocity.y=this.speed*.8,this.velocity.x=Math.sign(e)*this.speed*.2}shoot(){return this.lastShot>=this.shootCooldown?(this.lastShot=0,this.createProjectiles()):[]}createProjectiles(){const t=[],e=this.position.x+this.width/2,i=this.position.y+this.height;switch(this.type){case"scout":t.push(new m(e-2,i,0,400,this.damage,!1,"#ff4444"));break;case"fighter":t.push(new m(e-8,i,0,450,this.damage,!1,"#ff8800")),t.push(new m(e+4,i,0,450,this.damage,!1,"#ff8800"));break;case"heavy":t.push(new m(e-2,i,0,350,this.damage,!1,"#ff0088")),t.push(new m(e-10,i,-50,350,this.damage*.8,!1,"#ff0088")),t.push(new m(e+6,i,50,350,this.damage*.8,!1,"#ff0088"));break;case"bomber":t.push(new m(e-4,i,0,300,this.damage*1.5,!1,"#ffaa00",8,16));break;case"interceptor":this.burstCount<3?(t.push(new m(e-2,i,0,500,this.damage*.7,!1,"#00ff88")),this.burstCount++,this.lastShot=this.shootCooldown-200):this.burstCount=0;break;case"destroyer":for(let s=-2;s<=2;s++)t.push(new m(e-2,i,s*80,400,this.damage*.8,!1,"#8800ff"));break}return t}takeDamage(t){this.hp=Math.max(0,this.hp-t)}render(t){switch(t.save(),this.type){case"scout":this.renderScout(t);break;case"fighter":this.renderFighter(t);break;case"heavy":this.renderHeavy(t);break;case"bomber":this.renderBomber(t);break;case"interceptor":this.renderInterceptor(t);break;case"destroyer":this.renderDestroyer(t);break}this.renderHealthBar(t),t.restore()}renderScout(t){t.fillStyle="#ff4444",t.beginPath(),t.moveTo(this.position.x+this.width/2,this.position.y+this.height),t.lineTo(this.position.x,this.position.y),t.lineTo(this.position.x+this.width/4,this.position.y+this.height*.3),t.lineTo(this.position.x+this.width*.75,this.position.y+this.height*.3),t.lineTo(this.position.x+this.width,this.position.y),t.closePath(),t.fill()}renderFighter(t){t.fillStyle="#ff8800",t.fillRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle="#ffaa44",t.fillRect(this.position.x-5,this.position.y+10,10,20),t.fillRect(this.position.x+this.width-5,this.position.y+10,10,20)}renderHeavy(t){t.fillStyle="#ff0088",t.fillRect(this.position.x,this.position.y,this.width,this.height),t.fillStyle="#ff44aa",t.fillRect(this.position.x+5,this.position.y+5,this.width-10,this.height-10),t.fillStyle="#ffffff",t.fillRect(this.position.x+10,this.position.y+this.height-5,8,10),t.fillRect(this.position.x+this.width-18,this.position.y+this.height-5,8,10)}renderBomber(t){t.fillStyle="#ffaa00",t.fillRect(this.position.x+10,this.position.y,this.width-20,this.height),t.fillStyle="#ff8800",t.fillRect(this.position.x,this.position.y+15,this.width,15),t.fillStyle="#ff6600",t.fillRect(this.position.x+15,this.position.y+this.height-8,this.width-30,8)}renderInterceptor(t){t.fillStyle="#00ff88",t.beginPath(),t.moveTo(this.position.x+this.width/2,this.position.y),t.lineTo(this.position.x,this.position.y+this.height),t.lineTo(this.position.x+this.width/3,this.position.y+this.height*.7),t.lineTo(this.position.x+this.width*.67,this.position.y+this.height*.7),t.lineTo(this.position.x+this.width,this.position.y+this.height),t.closePath(),t.fill(),t.fillStyle="#44ffaa",t.fillRect(this.position.x+8,this.position.y+this.height,4,8),t.fillRect(this.position.x+this.width-12,this.position.y+this.height,4,8)}renderDestroyer(t){t.fillStyle="#8800ff",t.fillRect(this.position.x+5,this.position.y,this.width-10,this.height),t.fillStyle="#aa44ff",t.fillRect(this.position.x+20,this.position.y-5,this.width-40,15),t.fillStyle="#ffffff",t.beginPath(),t.arc(this.position.x+15,this.position.y+20,6,0,Math.PI*2),t.arc(this.position.x+this.width-15,this.position.y+20,6,0,Math.PI*2),t.fill(),t.fillStyle="#6600cc",t.fillRect(this.position.x,this.position.y+10,5,this.height-20),t.fillRect(this.position.x+this.width-5,this.position.y+10,5,this.height-20)}renderHealthBar(t){if(this.hp<this.maxHp){const e=this.width,i=4,s=this.position.y-8;t.fillStyle="rgba(255, 0, 0, 0.3)",t.fillRect(this.position.x,s,e,i),t.fillStyle="#ff0000";const o=this.hp/this.maxHp*e;t.fillRect(this.position.x,s,o,i)}}static increaseDifficulty(){g.difficultyMultiplier+=.2}static resetDifficulty(){g.difficultyMultiplier=1}};h(g,"difficultyMultiplier",1);let M=g;class O{constructor(t,e,i,s){h(this,"position");h(this,"velocity");h(this,"width");h(this,"height");h(this,"hp");h(this,"maxHp");h(this,"damage");h(this,"scoreValue");h(this,"coinValue");h(this,"type");h(this,"isDefeated",!1);h(this,"speed");h(this,"lastShot",0);h(this,"shootCooldown");h(this,"patternTimer",0);h(this,"specialTimer",0);h(this,"phase",1);h(this,"specialAttackTimer",0);h(this,"specialAttackCooldown",8e3);this.position=new d(t,e),this.velocity=new d(0,0),s?this.type=s:this.type=this.selectBossType(i),this.initializeStats(i)}selectBossType(t){return t<=5?"dreadnought":t<=10?"mothership":"fortress"}initializeStats(t){const e=1+(t-1)*.15;switch(this.type){case"dreadnought":this.width=120,this.height=80,this.maxHp=Math.floor(500*e),this.speed=80,this.damage=Math.floor(60*e),this.shootCooldown=1500,this.scoreValue=2e3,this.coinValue=200;break;case"mothership":this.width=160,this.height=100,this.maxHp=Math.floor(800*e),this.speed=60,this.damage=Math.floor(80*e),this.shootCooldown=1200,this.scoreValue=3500,this.coinValue=350;break;case"fortress":this.width=200,this.height=120,this.maxHp=Math.floor(1200*e),this.speed=40,this.damage=Math.floor(100*e),this.shootCooldown=1e3,this.scoreValue=5e3,this.coinValue=500;break}this.hp=this.maxHp}update(t,e,i){this.patternTimer+=t,this.specialTimer+=t,this.lastShot+=t,this.specialAttackTimer+=t;const s=this.hp/this.maxHp;s>.66?this.phase=1:s>.33?this.phase=2:this.phase=3,this.updateMovement(e),this.position.x+=this.velocity.x*t/1e3,this.position.y+=this.velocity.y*t/1e3,this.position.x=Math.max(0,Math.min(i.width-this.width,this.position.x)),this.position.y=Math.max(-this.height*.3,Math.min(i.height*.4,this.position.y))}updateMovement(t){switch(this.type){case"dreadnought":this.velocity.x=Math.sin(this.patternTimer*.001)*this.speed,this.velocity.y=Math.sin(this.patternTimer*5e-4)*this.speed*.3;break;case"mothership":const e=this.patternTimer*8e-4;this.velocity.x=Math.cos(e)*this.speed*.8,this.velocity.y=Math.sin(e)*this.speed*.4;break;case"fortress":if(this.phase===3){const i=t.x-(this.position.x+this.width/2);this.velocity.x=Math.sign(i)*this.speed*.5,this.velocity.y=Math.sin(this.patternTimer*3e-4)*this.speed*.2}else this.velocity.x=Math.sin(this.patternTimer*6e-4)*this.speed*.7,this.velocity.y=0;break}}shoot(){const t=[];return this.lastShot>=this.shootCooldown&&(this.lastShot=0,t.push(...this.createRegularProjectiles())),this.specialAttackTimer>=this.specialAttackCooldown&&(this.specialAttackTimer=0,t.push(...this.createSpecialAttack())),t}createRegularProjectiles(){const t=[],e=this.position.x+this.width/2,i=this.position.y+this.height;switch(this.type){case"dreadnought":for(let o=0;o<4;o++){const a=(o-1.5)*20;t.push(new m(e+a-3,i,0,350,this.damage,!1,"#ff0000",6,12))}break;case"mothership":for(let o=-3;o<=3;o++)t.push(new m(e-3,i,o*60,400,this.damage*.8,!1,"#ff4400",5,10));break;case"fortress":const s=this.phase===3?8:6;for(let o=0;o<s;o++){const a=o/s*Math.PI*2,c=Math.sin(a)*200,f=Math.cos(a)*300+200;t.push(new m(e-4,i,c,f,this.damage,!1,"#8800ff",8,16))}break}return t}createSpecialAttack(){const t=[],e=this.position.x+this.width/2,i=this.position.y+this.height;switch(this.type){case"dreadnought":for(let s=0;s<10;s++)t.push(new m(e-2,i+s*5,0,600,this.damage*1.5,!1,"#ffff00",4,20));break;case"mothership":for(let s=0;s<5;s++){const o=(s-2)*30;t.push(new m(e+o-3,i,0,250,this.damage*1.2,!1,"#ff8800",6,14))}break;case"fortress":for(let s=0;s<12;s++){const o=s/12*Math.PI*2,a=Math.sin(o)*300,c=Math.cos(o)*200+250;t.push(new m(e-5,i,a,c,this.damage*1.3,!1,"#ff00ff",10,20))}break}return t}takeDamage(t){this.hp=Math.max(0,this.hp-t),this.hp<=0&&(this.isDefeated=!0)}render(t){switch(t.save(),t.shadowColor=this.getBossColor(),t.shadowBlur=15,this.type){case"dreadnought":this.renderDreadnought(t);break;case"mothership":this.renderMothership(t);break;case"fortress":this.renderFortress(t);break}this.renderHealthBar(t),this.renderPhaseIndicator(t),t.restore()}renderDreadnought(t){t.fillStyle="#ff0000",t.fillRect(this.position.x+20,this.position.y+10,this.width-40,this.height-20),t.fillStyle="#ff4444",t.fillRect(this.position.x+40,this.position.y,this.width-80,20),t.fillStyle="#ffffff";for(let e=0;e<4;e++){const i=this.position.x+30+e*20;t.beginPath(),t.arc(i,this.position.y+this.height-10,8,0,Math.PI*2),t.fill()}t.fillStyle="#ffaa00",t.fillRect(this.position.x+10,this.position.y+this.height,this.width-20,8)}renderMothership(t){t.fillStyle="#ff4400",t.beginPath(),t.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),t.fill(),t.fillStyle="#ff8800",t.beginPath(),t.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/3,this.height/3,0,0,Math.PI*2),t.fill(),t.fillStyle="#ffff00",t.beginPath(),t.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/6,this.height/6,0,0,Math.PI*2),t.fill(),t.fillStyle="#ffffff";for(let e=0;e<8;e++){const i=e/8*Math.PI*2,s=this.position.x+this.width/2+Math.cos(i)*this.width/3,o=this.position.y+this.height/2+Math.sin(i)*this.height/3;t.beginPath(),t.arc(s,o,4,0,Math.PI*2),t.fill()}}renderFortress(t){t.fillStyle="#8800ff",t.fillRect(this.position.x,this.position.y+20,this.width,this.height-40),t.fillStyle="#aa44ff",t.fillRect(this.position.x+20,this.position.y,this.width-40,40),t.fillRect(this.position.x+20,this.position.y+this.height-20,this.width-40,20),t.fillStyle="#6600cc",t.fillRect(this.position.x,this.position.y,20,this.height),t.fillRect(this.position.x+this.width-20,this.position.y,20,this.height),t.fillStyle="#ffffff";for(let e=0;e<6;e++){const i=this.position.x+30+e*28;t.fillRect(i,this.position.y+this.height-15,8,15)}t.fillStyle="#ffff00",t.fillRect(this.position.x+this.width/2-10,this.position.y+this.height-25,20,25)}getBossColor(){switch(this.type){case"dreadnought":return"#ff0000";case"mothership":return"#ff4400";case"fortress":return"#8800ff";default:return"#ff0000"}}renderHealthBar(t){const e=this.width,i=8,s=this.position.y-20;t.fillStyle="rgba(255, 0, 0, 0.3)",t.fillRect(this.position.x,s,e,i),t.fillStyle="#ff0000";const o=this.hp/this.maxHp*e;t.fillRect(this.position.x,s,o,i),t.strokeStyle="#ffffff",t.lineWidth=2,t.strokeRect(this.position.x,s,e,i)}renderPhaseIndicator(t){t.fillStyle="#ffffff",t.font="bold 16px Orbitron",t.textAlign="center",t.fillText(`PHASE ${this.phase}`,this.position.x+this.width/2,this.position.y-30)}}class A{constructor(){h(this,"particles",[])}createExplosion(t,e,i,s){for(let o=0;o<s;o++){const a=Math.PI*2*o/s+Math.random()*.5,c=100+Math.random()*200,f={position:new d(t,e),velocity:new d(Math.cos(a)*c,Math.sin(a)*c),life:1e3+Math.random()*1e3,maxLife:1e3+Math.random()*1e3,color:i,size:2+Math.random()*4};this.particles.push(f)}}update(t){for(let e=this.particles.length-1;e>=0;e--){const i=this.particles[e];i.position.x+=i.velocity.x*t/1e3,i.position.y+=i.velocity.y*t/1e3,i.life-=t,i.velocity.y+=50*t/1e3,i.velocity.x*=.99,i.velocity.y*=.99,i.life<=0&&this.particles.splice(e,1)}}render(t){t.save();for(const e of this.particles){const i=e.life/e.maxLife;t.globalAlpha=i,t.fillStyle=e.color,t.beginPath(),t.arc(e.position.x,e.position.y,e.size*i,0,Math.PI*2),t.fill()}t.restore()}}class G{constructor(t){h(this,"keys",new Set);h(this,"mousePos",{x:0,y:0});h(this,"touchPos",null);h(this,"isTouching",!1);h(this,"canvas");this.canvas=t,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",t=>{this.keys.add(t.code),t.preventDefault()}),document.addEventListener("keyup",t=>{this.keys.delete(t.code),t.preventDefault()}),this.canvas.addEventListener("mousemove",t=>{const e=this.canvas.getBoundingClientRect();this.mousePos.x=t.clientX-e.left,this.mousePos.y=t.clientY-e.top}),this.canvas.addEventListener("touchstart",t=>{t.preventDefault(),this.isTouching=!0,this.updateTouchPosition(t)}),this.canvas.addEventListener("touchmove",t=>{t.preventDefault(),this.isTouching&&this.updateTouchPosition(t)}),this.canvas.addEventListener("touchend",t=>{t.preventDefault(),this.isTouching=!1,this.touchPos=null}),this.canvas.addEventListener("contextmenu",t=>{t.preventDefault()})}updateTouchPosition(t){if(t.touches.length>0){const e=this.canvas.getBoundingClientRect();this.touchPos={x:t.touches[0].clientX-e.left,y:t.touches[0].clientY-e.top}}}update(){}isMovingLeft(){return this.keys.has("KeyA")||this.keys.has("ArrowLeft")}isMovingRight(){return this.keys.has("KeyD")||this.keys.has("ArrowRight")}isMovingUp(){return this.keys.has("KeyW")||this.keys.has("ArrowUp")}isMovingDown(){return this.keys.has("KeyS")||this.keys.has("ArrowDown")}isShooting(){return this.keys.has("Space")}getTouchInput(){return this.touchPos}isMobile(){return this.isTouching}}class U{constructor(){h(this,"elements",{});h(this,"callbacks",{});this.initializeElements(),this.setupEventListeners()}initializeElements(){this.elements.hud=document.getElementById("hud"),this.elements.menuOverlay=document.getElementById("menu-overlay"),this.elements.shopOverlay=document.getElementById("shop-overlay"),this.elements.leaderboardOverlay=document.getElementById("leaderboard-overlay"),this.elements.controlsOverlay=document.getElementById("controls-overlay"),this.elements.gameOverOverlay=document.getElementById("game-over-overlay"),this.elements.pauseOverlay=document.getElementById("pause-overlay"),this.elements.hpFill=document.getElementById("hp-fill"),this.elements.hpText=document.getElementById("hp-text"),this.elements.shieldFill=document.getElementById("shield-fill"),this.elements.shieldText=document.getElementById("shield-text"),this.elements.scoreText=document.getElementById("score-text"),this.elements.waveText=document.getElementById("wave-text"),this.elements.coinsText=document.getElementById("coins-text"),this.elements.weaponCost=document.getElementById("weapon-cost"),this.elements.weaponLevel=document.getElementById("weapon-level"),this.elements.shieldCost=document.getElementById("shield-cost"),this.elements.shieldLevel=document.getElementById("shield-level"),this.elements.hpCost=document.getElementById("hp-cost"),this.elements.hpLevel=document.getElementById("hp-level"),this.elements.speedCost=document.getElementById("speed-cost"),this.elements.speedLevel=document.getElementById("speed-level"),this.elements.finalScore=document.getElementById("final-score"),this.elements.finalWave=document.getElementById("final-wave"),this.elements.finalCoins=document.getElementById("final-coins"),this.elements.playerName=document.getElementById("player-name"),this.elements.leaderboardList=document.getElementById("leaderboard-list"),Object.keys(this.elements).forEach(t=>{this.elements[t]||console.warn(`UI element not found: ${t}`)})}setupEventListeners(){var t,e,i,s,o,a,c,f,u,S,x,k,C,P,L,T;(t=document.getElementById("start-btn"))==null||t.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).startGame)==null||r.call(n)}),(e=document.getElementById("shop-btn"))==null||e.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).pauseAndShowShop)==null||r.call(n)}),(i=document.getElementById("leaderboard-btn"))==null||i.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).showLeaderboard)==null||r.call(n)}),(s=document.getElementById("controls-btn"))==null||s.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).showControls)==null||r.call(n)}),(o=document.getElementById("shop-close-btn"))==null||o.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).resumeFromShop)==null||r.call(n)}),document.querySelectorAll(".shop-buy-btn").forEach(n=>{n.addEventListener("click",r=>{var w,E;const v=r.target.getAttribute("data-upgrade");(E=(w=this.callbacks).purchaseUpgrade)==null||E.call(w,v)})}),(a=document.getElementById("leaderboard-close-btn"))==null||a.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).resumeFromLeaderboard)==null||r.call(n)}),(c=document.getElementById("controls-close-btn"))==null||c.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).resumeFromControls)==null||r.call(n)}),(f=document.getElementById("submit-score-btn"))==null||f.addEventListener("click",()=>{var b,v,w;const n=this.elements.playerName,r=((b=n==null?void 0:n.value)==null?void 0:b.trim())||"Anonymous";(w=(v=this.callbacks).submitScore)==null||w.call(v,r)}),(u=document.getElementById("restart-btn"))==null||u.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).restartGame)==null||r.call(n)}),(S=document.getElementById("main-menu-btn"))==null||S.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).mainMenu)==null||r.call(n)}),(x=document.getElementById("resume-btn"))==null||x.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).resumeGame)==null||r.call(n)}),(k=document.getElementById("pause-shop-btn"))==null||k.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).showShop)==null||r.call(n)}),(C=document.getElementById("pause-menu-btn"))==null||C.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).mainMenu)==null||r.call(n)}),(P=document.getElementById("mobile-menu-btn"))==null||P.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).pauseAndShowShop)==null||r.call(n)}),(L=document.getElementById("mobile-pause-btn"))==null||L.addEventListener("click",()=>{var n,r;(r=(n=this.callbacks).pauseGame)==null||r.call(n)}),(T=this.elements.playerName)==null||T.addEventListener("keypress",n=>{var r,b,v;if(n.key==="Enter"){const w=this.elements.playerName,E=((r=w==null?void 0:w.value)==null?void 0:r.trim())||"Anonymous";(v=(b=this.callbacks).submitScore)==null||v.call(b,E)}})}onStartGame(t){this.callbacks.startGame=t}onShowShop(t){this.callbacks.showShop=t}onPauseAndShowShop(t){this.callbacks.pauseAndShowShop=t}onResumeFromShop(t){this.callbacks.resumeFromShop=t}onResumeFromLeaderboard(t){this.callbacks.resumeFromLeaderboard=t}onResumeFromControls(t){this.callbacks.resumeFromControls=t}onShowLeaderboard(t){this.callbacks.showLeaderboard=t}onShowControls(t){this.callbacks.showControls=t}onPauseGame(t){this.callbacks.pauseGame=t}onResumeGame(t){this.callbacks.resumeGame=t}onRestartGame(t){this.callbacks.restartGame=t}onMainMenu(t){this.callbacks.mainMenu=t}onSubmitScore(t){this.callbacks.submitScore=t}onPurchaseUpgrade(t){this.callbacks.purchaseUpgrade=t}updateHP(t,e){const i=this.elements.hpFill,s=this.elements.hpText;if(i&&s){const o=t/e*100;i.style.width=`${o}%`,s.textContent=`${Math.ceil(t)}/${e}`}}updateShield(t,e){const i=this.elements.shieldFill,s=this.elements.shieldText;if(i&&s){const o=t/e*100;i.style.width=`${o}%`,s.textContent=`${Math.ceil(t)}/${e}`}}updateScore(t){const e=this.elements.scoreText;e&&(e.textContent=t.toLocaleString())}updateWave(t){const e=this.elements.waveText;e&&(e.textContent=`${t}`)}updateCoins(t){const e=this.elements.coinsText;e&&(e.textContent=t.toLocaleString())}updateUpgradeDisplay(t){const e=this.elements.weaponLevel;e&&(e.textContent=t.weapon.toString());const i=this.elements.shieldLevel;i&&(i.textContent=t.shield.toString());const s=this.elements.hpLevel;s&&(s.textContent=t.hp.toString());const o=this.elements.speedLevel;o&&(o.textContent=t.speed.toString());const a={weapon:100,shield:150,hp:200,speed:120};Object.keys(a).forEach(c=>{const f=Math.floor(a[c]*Math.pow(1.5,t[c]-1)),u=this.elements[`${c}Cost`];u&&(u.textContent=f.toString())})}showMainMenu(){this.hideAllOverlays();const t=this.elements.menuOverlay;t&&t.classList.remove("hidden")}showGame(){this.hideAllOverlays()}showShop(){this.hideAllOverlays();const t=this.elements.shopOverlay;t&&t.classList.remove("hidden")}showLeaderboard(t){this.hideAllOverlays();const e=this.elements.leaderboardOverlay;e&&e.classList.remove("hidden"),this.populateLeaderboard(t)}showControls(){this.hideAllOverlays();const t=this.elements.controlsOverlay;t&&t.classList.remove("hidden")}showGameOver(t,e,i){this.hideAllOverlays();const s=this.elements.gameOverOverlay;s&&s.classList.remove("hidden");const o=this.elements.finalScore;o&&(o.textContent=t.toLocaleString());const a=this.elements.finalWave;a&&(a.textContent=e.toString());const c=this.elements.finalCoins;c&&(c.textContent=i.toLocaleString());const f=this.elements.playerName;if(f){const u=f;u.value="",u.focus()}}showPause(){this.hideAllOverlays();const t=this.elements.pauseOverlay;t&&t.classList.remove("hidden")}hideAllOverlays(){document.querySelectorAll(".menu-overlay").forEach(t=>{t.classList.add("hidden")})}populateLeaderboard(t){const e=this.elements.leaderboardList;if(e){if(e.innerHTML="",t.length===0){e.innerHTML='<p style="text-align: center; color: #666;">No scores yet!</p>';return}t.forEach((i,s)=>{const o=document.createElement("div");o.className=`leaderboard-entry ${s<3?"top-3":""}`,o.innerHTML=`
        <span class="leaderboard-rank">#${s+1}</span>
        <span class="leaderboard-name">${i.name}</span>
        <span class="leaderboard-score">${i.score.toLocaleString()}</span>
      `,e.appendChild(o)})}}}class N{constructor(){h(this,"SAVE_KEY","spaceBattleSave");h(this,"LEADERBOARD_KEY","spaceBattleLeaderboard")}saveGameData(t){try{localStorage.setItem(this.SAVE_KEY,JSON.stringify(t))}catch(e){console.warn("Failed to save game data:",e)}}loadGameData(){try{const t=localStorage.getItem(this.SAVE_KEY);if(t)return JSON.parse(t)}catch(t){console.warn("Failed to load game data:",t)}return{coins:0,upgrades:{weapon:1,shield:1,hp:1,speed:1}}}addScore(t,e,i){try{const s=this.getLeaderboard();s.push({name:t.substring(0,20),score:e,wave:i,date:new Date().toISOString()}),s.sort((a,c)=>c.score-a.score);const o=s.slice(0,10);localStorage.setItem(this.LEADERBOARD_KEY,JSON.stringify(o))}catch(s){console.warn("Failed to save score:",s)}}getLeaderboard(){try{const t=localStorage.getItem(this.LEADERBOARD_KEY);if(t)return JSON.parse(t)}catch(t){console.warn("Failed to load leaderboard:",t)}return[]}clearAllData(){try{localStorage.removeItem(this.SAVE_KEY),localStorage.removeItem(this.LEADERBOARD_KEY)}catch(t){console.warn("Failed to clear data:",t)}}}class H{constructor(){h(this,"audioContext",null);h(this,"enabled",!0);this.initializeAudio()}initializeAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(t){console.warn("Web Audio API not supported:",t),this.enabled=!1}}playShoot(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(800,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(400,this.audioContext.currentTime+.1),e.gain.setValueAtTime(.1,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.1)}playExplosion(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(200,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.3),e.gain.setValueAtTime(.2,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.3)}playPowerUp(){if(!this.enabled||!this.audioContext)return;const t=this.audioContext.createOscillator(),e=this.audioContext.createGain();t.connect(e),e.connect(this.audioContext.destination),t.frequency.setValueAtTime(400,this.audioContext.currentTime),t.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.2),e.gain.setValueAtTime(.1,this.audioContext.currentTime),e.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),t.start(this.audioContext.currentTime),t.stop(this.audioContext.currentTime+.2)}setEnabled(t){this.enabled=t}}var l=(p=>(p.MENU="menu",p.PLAYING="playing",p.PAUSED="paused",p.GAME_OVER="gameOver",p.SHOP="shop",p.LEADERBOARD="leaderboard",p.CONTROLS="controls",p))(l||{});class W{constructor(t){h(this,"canvas");h(this,"ctx");h(this,"gameState",l.MENU);h(this,"previousGameState",l.MENU);h(this,"lastTime",0);h(this,"player");h(this,"enemies",[]);h(this,"boss",null);h(this,"projectiles",[]);h(this,"powerUps",[]);h(this,"particles");h(this,"inputManager");h(this,"uiManager");h(this,"storageManager");h(this,"soundManager");h(this,"stats",{score:0,wave:1,coins:0,enemiesKilled:0,gameTime:0});h(this,"waveTimer",0);h(this,"waveDelay",3e3);h(this,"enemiesInWave",5);h(this,"enemiesSpawned",0);h(this,"waveComplete",!1);h(this,"isBossWave",!1);h(this,"powerUpTimer",0);h(this,"powerUpSpawnRate",15e3);this.canvas=t,this.ctx=t.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.inputManager=new G(t),this.uiManager=new U,this.storageManager=new N,this.soundManager=new H,this.player=new D(t.width/2,t.height-100),this.particles=new A,this.loadGameData(),this.setupEventListeners()}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.player&&(this.player.position.x=Math.min(this.player.position.x,this.canvas.width-this.player.width),this.player.position.y=Math.min(this.player.position.y,this.canvas.height-this.player.height))}setupEventListeners(){this.uiManager.onStartGame(()=>this.startNewGame()),this.uiManager.onPauseAndShowShop(()=>this.pauseAndShowShop()),this.uiManager.onShowShop(()=>this.showShop()),this.uiManager.onResumeFromShop(()=>this.resumeFromShop()),this.uiManager.onShowLeaderboard(()=>this.showLeaderboard()),this.uiManager.onResumeFromLeaderboard(()=>this.resumeFromLeaderboard()),this.uiManager.onShowControls(()=>this.showControls()),this.uiManager.onResumeFromControls(()=>this.resumeFromControls()),this.uiManager.onPauseGame(()=>this.pauseGame()),this.uiManager.onResumeGame(()=>this.resumeGame()),this.uiManager.onRestartGame(()=>this.startNewGame()),this.uiManager.onMainMenu(()=>this.showMainMenu()),this.uiManager.onSubmitScore(t=>this.submitScore(t)),this.uiManager.onPurchaseUpgrade(t=>this.purchaseUpgrade(t)),document.addEventListener("keydown",t=>{t.code==="Escape"?this.gameState===l.PLAYING?this.pauseGame():this.gameState===l.PAUSED?this.resumeGame():this.gameState===l.SHOP&&this.previousGameState===l.PLAYING?this.resumeFromShop():this.gameState===l.LEADERBOARD&&this.previousGameState===l.PLAYING?this.resumeFromLeaderboard():this.gameState===l.CONTROLS&&this.previousGameState===l.PLAYING&&this.resumeFromControls():t.code==="KeyP"&&this.gameState===l.PLAYING&&this.pauseGame()})}loadGameData(){const t=this.storageManager.loadGameData();this.stats.coins=t.coins,this.player.applyUpgrades(t.upgrades),this.uiManager.updateUpgradeDisplay(t.upgrades),this.uiManager.updateCoins(this.stats.coins)}saveGameData(){this.storageManager.saveGameData({coins:this.stats.coins,upgrades:this.player.getUpgrades()})}start(){this.gameLoop(0)}gameLoop(t){const e=t-this.lastTime;this.lastTime=t,this.update(e),this.render(),requestAnimationFrame(i=>this.gameLoop(i))}update(t){if(this.gameState===l.PLAYING){if(this.stats.gameTime+=t,this.inputManager.update(),this.player.update(t,this.inputManager,this.canvas),this.inputManager.isShooting()||this.inputManager.isMobile()){const e=this.player.shoot();e&&(this.projectiles.push(e),this.soundManager.playShoot())}this.updateProjectiles(t),this.updateEnemies(t),this.updateBoss(t),this.updatePowerUps(t),this.particles.update(t),this.checkCollisions(),this.updateWaveLogic(t),this.updatePowerUpSpawning(t),this.updateUI(),this.player.hp<=0&&this.gameOver()}}updateProjectiles(t){for(let e=this.projectiles.length-1;e>=0;e--){const i=this.projectiles[e];i.update(t),(i.position.y<-50||i.position.y>this.canvas.height+50||i.position.x<-50||i.position.x>this.canvas.width+50)&&this.projectiles.splice(e,1)}}updateEnemies(t){for(let e=this.enemies.length-1;e>=0;e--){const i=this.enemies[e];i.update(t,this.player.position,this.canvas);const s=i.shoot();s.length>0&&this.projectiles.push(...s),i.position.y>this.canvas.height+100&&this.enemies.splice(e,1)}}updateBoss(t){if(!this.boss)return;this.boss.update(t,this.player.position,this.canvas);const e=this.boss.shoot();if(e.length>0&&this.projectiles.push(...e),this.boss.isDefeated){this.stats.enemiesKilled++,this.stats.score+=this.boss.scoreValue,this.stats.coins+=this.boss.coinValue,this.particles.createExplosion(this.boss.position.x+this.boss.width/2,this.boss.position.y+this.boss.height/2,"#ffaa00",30),this.soundManager.playExplosion();for(let i=0;i<3;i++)this.spawnPowerUp(this.boss.position.x+Math.random()*this.boss.width,this.boss.position.y+Math.random()*this.boss.height);this.boss=null,this.isBossWave=!1,this.waveComplete=!0,this.waveTimer=0}}updatePowerUps(t){for(let e=this.powerUps.length-1;e>=0;e--){const i=this.powerUps[e];i.update(t),(i.position.y>this.canvas.height+50||i.isExpired())&&this.powerUps.splice(e,1)}}checkCollisions(){for(let t=this.projectiles.length-1;t>=0;t--){const e=this.projectiles[t];if(e.isPlayerProjectile){for(let i=this.enemies.length-1;i>=0;i--){const s=this.enemies[i];if(this.checkCollision(e,s)){s.takeDamage(e.damage),this.projectiles.splice(t,1),this.particles.createExplosion(s.position.x,s.position.y,"#ff4444",5),s.hp<=0&&(this.enemies.splice(i,1),this.stats.enemiesKilled++,this.stats.score+=s.scoreValue,this.stats.coins+=s.coinValue,this.particles.createExplosion(s.position.x,s.position.y,"#ffaa00",15),this.soundManager.playExplosion(),Math.random()<.15&&this.spawnPowerUp(s.position.x,s.position.y));break}}this.boss&&this.checkCollision(e,this.boss)&&(this.boss.takeDamage(e.damage),this.projectiles.splice(t,1),this.particles.createExplosion(e.position.x,e.position.y,"#ff4444",8))}}for(let t=this.projectiles.length-1;t>=0;t--){const e=this.projectiles[t];e.isPlayerProjectile||this.checkCollision(e,this.player)&&(this.player.takeDamage(e.damage),this.projectiles.splice(t,1),this.particles.createExplosion(this.player.position.x,this.player.position.y,"#4444ff",8))}for(let t=this.enemies.length-1;t>=0;t--){const e=this.enemies[t];this.checkCollision(e,this.player)&&(this.player.takeDamage(e.damage),e.takeDamage(this.player.ramDamage),this.particles.createExplosion((e.position.x+this.player.position.x)/2,(e.position.y+this.player.position.y)/2,"#ffffff",10),e.hp<=0&&(this.enemies.splice(t,1),this.stats.enemiesKilled++,this.stats.score+=e.scoreValue,this.stats.coins+=e.coinValue,this.soundManager.playExplosion()))}this.boss&&this.checkCollision(this.boss,this.player)&&(this.player.takeDamage(this.boss.damage),this.particles.createExplosion(this.player.position.x,this.player.position.y,"#ffffff",15));for(let t=this.powerUps.length-1;t>=0;t--){const e=this.powerUps[t];this.checkCollision(e,this.player)&&(this.player.applyPowerUp(e),this.powerUps.splice(t,1),this.particles.createExplosion(e.position.x,e.position.y,e.color,8),this.soundManager.playPowerUp())}}checkCollision(t,e){return t.position.x<e.position.x+e.width&&t.position.x+t.width>e.position.x&&t.position.y<e.position.y+e.height&&t.position.y+t.height>e.position.y}updateWaveLogic(t){this.enemies.length===0&&(!this.isBossWave||!this.boss)&&this.enemiesSpawned>=this.enemiesInWave?(this.waveComplete||(this.waveComplete=!0,this.waveTimer=0,this.stats.score+=this.stats.wave*100,this.stats.coins+=this.stats.wave*10),this.waveTimer+=t,this.waveTimer>=this.waveDelay&&this.startNextWave()):!this.isBossWave&&this.enemiesSpawned<this.enemiesInWave&&this.enemies.length<3&&(this.spawnEnemy(),this.enemiesSpawned++)}startNextWave(){this.stats.wave++,this.waveComplete=!1,this.waveTimer=0,this.isBossWave=this.stats.wave%5===0,this.isBossWave?(this.spawnBoss(),this.enemiesInWave=0,this.enemiesSpawned=0):(this.enemiesInWave=Math.min(5+Math.floor(this.stats.wave/2),15),this.enemiesSpawned=0),this.stats.wave%5===0&&M.increaseDifficulty()}spawnEnemy(){const t=Math.random()*(this.canvas.width-60),e=-60,i=new M(t,e,this.stats.wave);this.enemies.push(i)}spawnBoss(){const t=this.canvas.width/2-100,e=-120;this.boss=new O(t,e,this.stats.wave)}updatePowerUpSpawning(t){if(this.powerUpTimer+=t,this.powerUpTimer>=this.powerUpSpawnRate){this.powerUpTimer=0;const e=Math.random()*(this.canvas.width-40);this.spawnPowerUp(e,-40)}}spawnPowerUp(t,e){const i=new B(t,e);this.powerUps.push(i)}updateUI(){this.uiManager.updateHP(this.player.hp,this.player.maxHp),this.uiManager.updateShield(this.player.shield,this.player.maxShield),this.uiManager.updateScore(this.stats.score),this.uiManager.updateWave(this.stats.wave),this.uiManager.updateCoins(this.stats.coins)}render(){const t=this.ctx.createLinearGradient(0,0,0,this.canvas.height);t.addColorStop(0,"#000428"),t.addColorStop(1,"#004e92"),this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawStars(),(this.gameState===l.PLAYING||this.gameState===l.PAUSED)&&(this.player.render(this.ctx),this.enemies.forEach(e=>e.render(this.ctx)),this.boss&&this.boss.render(this.ctx),this.projectiles.forEach(e=>e.render(this.ctx)),this.powerUps.forEach(e=>e.render(this.ctx)),this.particles.render(this.ctx),this.waveComplete&&this.waveTimer<2e3&&this.drawWaveTransition(),this.isBossWave&&this.boss&&this.waveTimer<3e3&&this.drawBossWarning())}drawStars(){this.ctx.fillStyle="#ffffff";for(let t=0;t<100;t++){const e=t*137.5%this.canvas.width,i=t*73.3%this.canvas.height,s=Math.sin(t+this.stats.gameTime*.001)*.5+1;this.ctx.globalAlpha=Math.sin(t+this.stats.gameTime*.002)*.3+.7,this.ctx.fillRect(e,i,s,s)}this.ctx.globalAlpha=1}drawWaveTransition(){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ffff00",this.ctx.font="bold 48px Orbitron",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const t=this.isBossWave?`BOSS WAVE ${this.stats.wave}!`:`WAVE ${this.stats.wave} COMPLETE!`;this.ctx.fillText(t,this.canvas.width/2,this.canvas.height/2-30),this.ctx.font="bold 24px Orbitron",this.ctx.fillStyle="#00ffff";const e=`Next wave in ${Math.ceil((this.waveDelay-this.waveTimer)/1e3)}...`;this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2+30),this.ctx.restore()}drawBossWarning(){this.ctx.save(),this.ctx.fillStyle="rgba(255, 0, 0, 0.3)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ff0000",this.ctx.font="bold 64px Orbitron",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const t=Math.sin(this.stats.gameTime*.01)*.5+.5;this.ctx.globalAlpha=t,this.ctx.fillText("WARNING",this.canvas.width/2,this.canvas.height/2-50),this.ctx.font="bold 32px Orbitron",this.ctx.fillStyle="#ffff00",this.ctx.fillText("BOSS APPROACHING",this.canvas.width/2,this.canvas.height/2+20),this.ctx.restore()}startNewGame(){this.gameState=l.PLAYING,this.previousGameState=l.MENU,this.stats={score:0,wave:1,coins:this.stats.coins,enemiesKilled:0,gameTime:0},this.player.reset(this.canvas.width/2,this.canvas.height-100),this.enemies=[],this.boss=null,this.projectiles=[],this.powerUps=[],this.particles=new A,this.enemiesInWave=5,this.enemiesSpawned=0,this.waveComplete=!1,this.isBossWave=!1,this.waveTimer=0,this.powerUpTimer=0,M.resetDifficulty(),this.uiManager.showGame()}pauseGame(){this.gameState===l.PLAYING&&(this.previousGameState=this.gameState,this.gameState=l.PAUSED,this.uiManager.showPause())}resumeGame(){this.gameState===l.PAUSED&&(this.gameState=l.PLAYING,this.uiManager.showGame())}pauseAndShowShop(){this.gameState===l.PLAYING?(this.previousGameState=this.gameState,this.gameState=l.SHOP,this.uiManager.showShop()):this.gameState===l.MENU&&this.showShop()}showShop(){this.uiManager.showShop()}resumeFromShop(){this.previousGameState===l.PLAYING?(this.gameState=l.PLAYING,this.uiManager.showGame()):this.showMainMenu()}showLeaderboard(){this.gameState===l.PLAYING&&(this.previousGameState=this.gameState,this.gameState=l.LEADERBOARD);const t=this.storageManager.getLeaderboard();this.uiManager.showLeaderboard(t)}resumeFromLeaderboard(){this.previousGameState===l.PLAYING?(this.gameState=l.PLAYING,this.uiManager.showGame()):this.showMainMenu()}showControls(){this.gameState===l.PLAYING&&(this.previousGameState=this.gameState,this.gameState=l.CONTROLS),this.uiManager.showControls()}resumeFromControls(){this.previousGameState===l.PLAYING?(this.gameState=l.PLAYING,this.uiManager.showGame()):this.showMainMenu()}gameOver(){this.gameState=l.GAME_OVER,this.previousGameState=l.GAME_OVER,this.saveGameData(),this.uiManager.showGameOver(this.stats.score,this.stats.wave-1,this.stats.coins)}showMainMenu(){this.gameState=l.MENU,this.previousGameState=l.MENU,this.uiManager.showMainMenu()}submitScore(t){this.storageManager.addScore(t,this.stats.score,this.stats.wave-1),this.showLeaderboard()}purchaseUpgrade(t){const e=this.player.getUpgradeCost(t);return this.stats.coins>=e?(this.stats.coins-=e,this.player.upgrade(t),this.saveGameData(),this.uiManager.updateCoins(this.stats.coins),this.uiManager.updateUpgradeDisplay(this.player.getUpgrades()),!0):!1}}document.addEventListener("DOMContentLoaded",()=>{const p=document.getElementById("gameCanvas");if(!p){console.error("Canvas element not found!");return}new W(p).start(),console.log("Space Battle Game v2.0 - Enemy Variety & Boss Battles Loaded"),console.log("Build timestamp:",new Date().toISOString())});
//# sourceMappingURL=index-DQ2kh1zh.js.map
