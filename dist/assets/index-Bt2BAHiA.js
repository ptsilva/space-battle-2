var A=Object.defineProperty;var D=(l,e,t)=>e in l?A(l,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[e]=t;var i=(l,e,t)=>D(l,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&a(h)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();class c{constructor(e=0,t=0){i(this,"x");i(this,"y");this.x=e,this.y=t}add(e){return new c(this.x+e.x,this.y+e.y)}subtract(e){return new c(this.x-e.x,this.y-e.y)}multiply(e){return new c(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e===0?new c(0,0):new c(this.x/e,this.y/e)}distance(e){const t=this.x-e.x,a=this.y-e.y;return Math.sqrt(t*t+a*a)}clone(){return new c(this.x,this.y)}}class I{constructor(e,t,a,s,o,h,m){i(this,"position");i(this,"velocity");i(this,"width",4);i(this,"height",12);i(this,"damage");i(this,"isPlayerProjectile");i(this,"color");this.position=new c(e,t),this.velocity=new c(a,s),this.damage=o,this.isPlayerProjectile=h,this.color=m}update(e){this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3}render(e){e.save(),e.shadowColor=this.color,e.shadowBlur=5,e.fillStyle=this.color,this.isPlayerProjectile?(e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),e.fill()):e.fillRect(this.position.x,this.position.y,this.width,this.height),e.restore()}}var d=(l=>(l.HEALTH="health",l.SHIELD="shield",l.WEAPON="weapon",l.SPEED="speed",l))(d||{});class U{constructor(e,t){i(this,"position");i(this,"velocity");i(this,"width",30);i(this,"height",30);i(this,"type");i(this,"color");i(this,"lifeTime",15e3);i(this,"age",0);i(this,"pulseTimer",0);this.position=new c(e,t),this.velocity=new c(0,50);const a=Object.values(d);this.type=a[Math.floor(Math.random()*a.length)],this.color=this.getColor()}getColor(){switch(this.type){case"health":return"#00ff00";case"shield":return"#0088ff";case"weapon":return"#ff4400";case"speed":return"#ffff00";default:return"#ffffff"}}update(e){this.age+=e,this.pulseTimer+=e,this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3}isExpired(){return this.age>=this.lifeTime}render(e){e.save();const t=Math.sin(this.pulseTimer*.005)*.3+.7,a=this.age>this.lifeTime-3e3?Math.sin(this.age*.01)*.5+.5:1;e.globalAlpha=a,e.shadowColor=this.color,e.shadowBlur=10*t,e.fillStyle=this.color,e.strokeStyle="#ffffff",e.lineWidth=2;const s=this.position.x+this.width/2,o=this.position.y+this.height/2,h=this.width/2*t;switch(this.type){case"health":e.fillRect(s-h*.6,o-h*.2,h*1.2,h*.4),e.fillRect(s-h*.2,o-h*.6,h*.4,h*1.2);break;case"shield":e.beginPath(),e.arc(s,o,h,0,Math.PI*2),e.fill(),e.stroke();break;case"weapon":e.beginPath(),e.moveTo(s,o-h),e.lineTo(s-h*.5,o+h),e.lineTo(s+h*.5,o+h),e.closePath(),e.fill(),e.stroke();break;case"speed":e.beginPath(),e.moveTo(s-h*.3,o-h),e.lineTo(s+h*.3,o-h*.2),e.lineTo(s-h*.1,o-h*.2),e.lineTo(s+h*.3,o+h),e.lineTo(s-h*.3,o+h*.2),e.lineTo(s+h*.1,o+h*.2),e.closePath(),e.fill(),e.stroke();break}e.restore()}}class O{constructor(e,t){i(this,"position");i(this,"velocity");i(this,"width",40);i(this,"height",40);i(this,"hp",100);i(this,"maxHp",100);i(this,"shield",100);i(this,"maxShield",100);i(this,"speed",300);i(this,"damage",25);i(this,"fireRate",300);i(this,"ramDamage",50);i(this,"upgrades",{weapon:1,shield:1,hp:1,speed:1});i(this,"lastShot",0);i(this,"shootCooldown",300);i(this,"lastDamageTime",0);i(this,"shieldRegenDelay",3e3);i(this,"shieldRegenRate",20);i(this,"powerUpEffects",new Map);this.position=new c(e,t),this.velocity=new c(0,0),this.initializeStats()}initializeStats(){this.maxHp=100+(this.upgrades.hp-1)*25,this.hp=this.maxHp,this.maxShield=100+(this.upgrades.shield-1)*30,this.shield=this.maxShield,this.speed=300+(this.upgrades.speed-1)*50,this.damage=25+(this.upgrades.weapon-1)*10,this.fireRate=300-(this.upgrades.weapon-1)*30,this.shootCooldown=this.fireRate}update(e,t,a){this.velocity.x=0,this.velocity.y=0,t.isMovingLeft()&&(this.velocity.x-=1),t.isMovingRight()&&(this.velocity.x+=1),t.isMovingUp()&&(this.velocity.y-=1),t.isMovingDown()&&(this.velocity.y+=1);const s=t.getTouchInput();if(s){const h=s.x-this.width/2,m=s.y-this.height/2,u=h-this.position.x,y=m-this.position.y,f=Math.sqrt(u*u+y*y);f>5&&(this.velocity.x=u/f,this.velocity.y=y/f)}this.velocity.x!==0&&this.velocity.y!==0&&(this.velocity.x*=.707,this.velocity.y*=.707);const o=this.getCurrentSpeed();this.position.x+=this.velocity.x*o*e/1e3,this.position.y+=this.velocity.y*o*e/1e3,this.position.x=Math.max(0,Math.min(a.width-this.width,this.position.x)),this.position.y=Math.max(0,Math.min(a.height-this.height,this.position.y)),this.lastShot+=e,Date.now()-this.lastDamageTime>this.shieldRegenDelay&&this.shield<this.maxShield&&(this.shield=Math.min(this.maxShield,this.shield+this.shieldRegenRate*e/1e3)),this.updatePowerUpEffects(e)}getCurrentSpeed(){let e=this.speed;return this.powerUpEffects.has(d.SPEED)&&(e*=1.5),e}updatePowerUpEffects(e){for(const[t,a]of this.powerUpEffects.entries()){const s=a-e;s<=0?this.powerUpEffects.delete(t):this.powerUpEffects.set(t,s)}}shoot(){if(this.lastShot>=this.shootCooldown){this.lastShot=0;const e=this.getCurrentDamage();return new I(this.position.x+this.width/2-2,this.position.y,0,-800,e,!0,"#00ffff")}return null}getCurrentDamage(){let e=this.damage;return this.powerUpEffects.has(d.WEAPON)&&(e*=2),e}takeDamage(e){if(this.lastDamageTime=Date.now(),this.shield>0){const t=Math.min(this.shield,e);this.shield-=t,e-=t}e>0&&(this.hp=Math.max(0,this.hp-e))}applyPowerUp(e){switch(e.type){case d.HEALTH:this.hp=Math.min(this.maxHp,this.hp+30);break;case d.SHIELD:this.shield=Math.min(this.maxShield,this.shield+50);break;case d.WEAPON:this.powerUpEffects.set(d.WEAPON,1e4);break;case d.SPEED:this.powerUpEffects.set(d.SPEED,8e3);break}}upgrade(e){this.upgrades[e]++,this.initializeStats()}getUpgradeCost(e){return Math.floor({weapon:100,shield:150,hp:200,speed:120}[e]*Math.pow(1.5,this.upgrades[e]-1))}getUpgrades(){return{...this.upgrades}}applyUpgrades(e){this.upgrades={...e},this.initializeStats()}reset(e,t){this.position.x=e,this.position.y=t,this.velocity.x=0,this.velocity.y=0,this.hp=this.maxHp,this.shield=this.maxShield,this.lastShot=0,this.lastDamageTime=0,this.powerUpEffects.clear()}render(e){e.save(),this.shield>0&&(e.strokeStyle=`rgba(68, 68, 255, ${this.shield/this.maxShield*.5})`,e.lineWidth=3,e.beginPath(),e.arc(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2+5,0,Math.PI*2),e.stroke()),this.powerUpEffects.has(d.WEAPON)&&(e.shadowColor="#ff0000",e.shadowBlur=10),this.powerUpEffects.has(d.SPEED)&&(e.strokeStyle="#ffff00",e.lineWidth=2,e.strokeRect(this.position.x-2,this.position.y-2,this.width+4,this.height+4)),e.fillStyle="#00ffff",e.beginPath(),e.moveTo(this.position.x+this.width/2,this.position.y),e.lineTo(this.position.x,this.position.y+this.height),e.lineTo(this.position.x+this.width/4,this.position.y+this.height*.8),e.lineTo(this.position.x+this.width*.75,this.position.y+this.height*.8),e.lineTo(this.position.x+this.width,this.position.y+this.height),e.closePath(),e.fill(),e.fillStyle="#ff4444",e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height+5,8,12,0,0,Math.PI*2),e.fill(),e.restore()}}const g=class g{constructor(e,t,a){i(this,"position");i(this,"velocity");i(this,"width",30);i(this,"height",30);i(this,"hp",25);i(this,"maxHp",25);i(this,"damage",15);i(this,"scoreValue",50);i(this,"coinValue",5);i(this,"type");i(this,"speed",150);i(this,"lastShot",0);i(this,"shootCooldown",2e3);i(this,"movementPattern");i(this,"patternTimer",0);this.position=new c(e,t),this.velocity=new c(0,0);const s=Math.random();s<.6?this.type="scout":s<.85?this.type="fighter":this.type="heavy",this.initializeStats(a),this.movementPattern=Math.floor(Math.random()*3)}initializeStats(e){const t=1+(e-1)*.1;switch(this.type){case"scout":this.width=30,this.height=30,this.maxHp=Math.floor(25*t*g.difficultyMultiplier),this.speed=150+e*10,this.damage=Math.floor(15*t),this.shootCooldown=2e3,this.scoreValue=50,this.coinValue=5;break;case"fighter":this.width=40,this.height=40,this.maxHp=Math.floor(50*t*g.difficultyMultiplier),this.speed=100+e*8,this.damage=Math.floor(25*t),this.shootCooldown=1500,this.scoreValue=100,this.coinValue=10;break;case"heavy":this.width=60,this.height=50,this.maxHp=Math.floor(100*t*g.difficultyMultiplier),this.speed=60+e*5,this.damage=Math.floor(40*t),this.shootCooldown=1e3,this.scoreValue=200,this.coinValue=20;break}this.hp=this.maxHp}update(e,t,a){switch(this.patternTimer+=e,this.lastShot+=e,this.movementPattern){case 0:this.velocity.y=this.speed,this.velocity.x=0;break;case 1:this.velocity.y=this.speed*.7,this.velocity.x=Math.sin(this.patternTimer*.003)*this.speed*.5;break;case 2:const s=t.x-this.position.x,o=t.y-this.position.y,h=Math.sqrt(s*s+o*o);h>0&&(this.velocity.x=s/h*this.speed*.3,this.velocity.y=Math.max(o/h*this.speed*.3,this.speed*.5));break}this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3,this.position.x=Math.max(0,Math.min(a.width-this.width,this.position.x))}shoot(){return this.lastShot>=this.shootCooldown?(this.lastShot=0,new I(this.position.x+this.width/2-2,this.position.y+this.height,0,400,this.damage,!1,this.getProjectileColor())):null}getProjectileColor(){switch(this.type){case"scout":return"#ff4444";case"fighter":return"#ff8800";case"heavy":return"#ff0088";default:return"#ff4444"}}takeDamage(e){this.hp=Math.max(0,this.hp-e)}render(e){switch(e.save(),this.type){case"scout":this.renderScout(e);break;case"fighter":this.renderFighter(e);break;case"heavy":this.renderHeavy(e);break}this.renderHealthBar(e),e.restore()}renderScout(e){e.fillStyle="#ff4444",e.beginPath(),e.moveTo(this.position.x+this.width/2,this.position.y+this.height),e.lineTo(this.position.x,this.position.y),e.lineTo(this.position.x+this.width/4,this.position.y+this.height*.3),e.lineTo(this.position.x+this.width*.75,this.position.y+this.height*.3),e.lineTo(this.position.x+this.width,this.position.y),e.closePath(),e.fill()}renderFighter(e){e.fillStyle="#ff8800",e.fillRect(this.position.x,this.position.y,this.width,this.height),e.fillStyle="#ffaa44",e.fillRect(this.position.x-5,this.position.y+10,10,20),e.fillRect(this.position.x+this.width-5,this.position.y+10,10,20)}renderHeavy(e){e.fillStyle="#ff0088",e.fillRect(this.position.x,this.position.y,this.width,this.height),e.fillStyle="#ff44aa",e.fillRect(this.position.x+5,this.position.y+5,this.width-10,this.height-10),e.fillStyle="#ffffff",e.fillRect(this.position.x+10,this.position.y+this.height-5,8,10),e.fillRect(this.position.x+this.width-18,this.position.y+this.height-5,8,10)}renderHealthBar(e){if(this.hp<this.maxHp){const t=this.width,a=4,s=this.position.y-8;e.fillStyle="rgba(255, 0, 0, 0.3)",e.fillRect(this.position.x,s,t,a),e.fillStyle="#ff0000";const o=this.hp/this.maxHp*t;e.fillRect(this.position.x,s,o,a)}}static increaseDifficulty(){g.difficultyMultiplier+=.2}static resetDifficulty(){g.difficultyMultiplier=1}};i(g,"difficultyMultiplier",1);let E=g;class k{constructor(){i(this,"particles",[])}createExplosion(e,t,a,s){for(let o=0;o<s;o++){const h=Math.PI*2*o/s+Math.random()*.5,m=100+Math.random()*200,u={position:new c(e,t),velocity:new c(Math.cos(h)*m,Math.sin(h)*m),life:1e3+Math.random()*1e3,maxLife:1e3+Math.random()*1e3,color:a,size:2+Math.random()*4};this.particles.push(u)}}update(e){for(let t=this.particles.length-1;t>=0;t--){const a=this.particles[t];a.position.x+=a.velocity.x*e/1e3,a.position.y+=a.velocity.y*e/1e3,a.life-=e,a.velocity.y+=50*e/1e3,a.velocity.x*=.99,a.velocity.y*=.99,a.life<=0&&this.particles.splice(t,1)}}render(e){e.save();for(const t of this.particles){const a=t.life/t.maxLife;e.globalAlpha=a,e.fillStyle=t.color,e.beginPath(),e.arc(t.position.x,t.position.y,t.size*a,0,Math.PI*2),e.fill()}e.restore()}}class B{constructor(e){i(this,"keys",new Set);i(this,"mousePos",{x:0,y:0});i(this,"touchPos",null);i(this,"isTouching",!1);i(this,"canvas");this.canvas=e,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",e=>{this.keys.add(e.code),e.preventDefault()}),document.addEventListener("keyup",e=>{this.keys.delete(e.code),e.preventDefault()}),this.canvas.addEventListener("mousemove",e=>{const t=this.canvas.getBoundingClientRect();this.mousePos.x=e.clientX-t.left,this.mousePos.y=e.clientY-t.top}),this.canvas.addEventListener("touchstart",e=>{e.preventDefault(),this.isTouching=!0,this.updateTouchPosition(e)}),this.canvas.addEventListener("touchmove",e=>{e.preventDefault(),this.isTouching&&this.updateTouchPosition(e)}),this.canvas.addEventListener("touchend",e=>{e.preventDefault(),this.isTouching=!1,this.touchPos=null}),this.canvas.addEventListener("contextmenu",e=>{e.preventDefault()})}updateTouchPosition(e){if(e.touches.length>0){const t=this.canvas.getBoundingClientRect();this.touchPos={x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}}update(){}isMovingLeft(){return this.keys.has("KeyA")||this.keys.has("ArrowLeft")}isMovingRight(){return this.keys.has("KeyD")||this.keys.has("ArrowRight")}isMovingUp(){return this.keys.has("KeyW")||this.keys.has("ArrowUp")}isMovingDown(){return this.keys.has("KeyS")||this.keys.has("ArrowDown")}isShooting(){return this.keys.has("Space")}getTouchInput(){return this.touchPos}isMobile(){return this.isTouching}}class G{constructor(){i(this,"elements",{});i(this,"callbacks",{});this.initializeElements(),this.setupEventListeners()}initializeElements(){this.elements.hud=document.getElementById("hud"),this.elements.menuOverlay=document.getElementById("menu-overlay"),this.elements.shopOverlay=document.getElementById("shop-overlay"),this.elements.leaderboardOverlay=document.getElementById("leaderboard-overlay"),this.elements.controlsOverlay=document.getElementById("controls-overlay"),this.elements.gameOverOverlay=document.getElementById("game-over-overlay"),this.elements.pauseOverlay=document.getElementById("pause-overlay"),this.elements.hpFill=document.getElementById("hp-fill"),this.elements.hpText=document.getElementById("hp-text"),this.elements.shieldFill=document.getElementById("shield-fill"),this.elements.shieldText=document.getElementById("shield-text"),this.elements.scoreText=document.getElementById("score-text"),this.elements.waveText=document.getElementById("wave-text"),this.elements.coinsText=document.getElementById("coins-text"),this.elements.weaponCost=document.getElementById("weapon-cost"),this.elements.weaponLevel=document.getElementById("weapon-level"),this.elements.shieldCost=document.getElementById("shield-cost"),this.elements.shieldLevel=document.getElementById("shield-level"),this.elements.hpCost=document.getElementById("hp-cost"),this.elements.hpLevel=document.getElementById("hp-level"),this.elements.speedCost=document.getElementById("speed-cost"),this.elements.speedLevel=document.getElementById("speed-level"),this.elements.finalScore=document.getElementById("final-score"),this.elements.finalWave=document.getElementById("final-wave"),this.elements.finalCoins=document.getElementById("final-coins"),this.elements.playerName=document.getElementById("player-name"),this.elements.leaderboardList=document.getElementById("leaderboard-list")}setupEventListeners(){var e,t,a,s,o,h,m,u,y,f,M,x,b,C,L,P;(e=document.getElementById("start-btn"))==null||e.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).startGame)==null||n.call(r)}),(t=document.getElementById("shop-btn"))==null||t.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).showShop)==null||n.call(r)}),(a=document.getElementById("leaderboard-btn"))==null||a.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).showLeaderboard)==null||n.call(r)}),(s=document.getElementById("controls-btn"))==null||s.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).showControls)==null||n.call(r)}),(o=document.getElementById("shop-close-btn"))==null||o.addEventListener("click",()=>{this.showMainMenu()}),document.querySelectorAll(".shop-buy-btn").forEach(r=>{r.addEventListener("click",n=>{var S,T;const v=n.target.getAttribute("data-upgrade");(T=(S=this.callbacks).purchaseUpgrade)==null||T.call(S,v)})}),(h=document.getElementById("leaderboard-close-btn"))==null||h.addEventListener("click",()=>{this.showMainMenu()}),(m=document.getElementById("controls-close-btn"))==null||m.addEventListener("click",()=>{this.showMainMenu()}),(u=document.getElementById("submit-score-btn"))==null||u.addEventListener("click",()=>{var w,v;const n=this.elements.playerName.value.trim()||"Anonymous";(v=(w=this.callbacks).submitScore)==null||v.call(w,n)}),(y=document.getElementById("restart-btn"))==null||y.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).restartGame)==null||n.call(r)}),(f=document.getElementById("main-menu-btn"))==null||f.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).mainMenu)==null||n.call(r)}),(M=document.getElementById("resume-btn"))==null||M.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).resumeGame)==null||n.call(r)}),(x=document.getElementById("pause-shop-btn"))==null||x.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).showShop)==null||n.call(r)}),(b=document.getElementById("pause-menu-btn"))==null||b.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).mainMenu)==null||n.call(r)}),(C=document.getElementById("mobile-menu-btn"))==null||C.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).showShop)==null||n.call(r)}),(L=document.getElementById("mobile-pause-btn"))==null||L.addEventListener("click",()=>{var r,n;(n=(r=this.callbacks).pauseGame)==null||n.call(r)}),(P=this.elements.playerName)==null||P.addEventListener("keypress",r=>{var n,w;if(r.key==="Enter"){const S=this.elements.playerName.value.trim()||"Anonymous";(w=(n=this.callbacks).submitScore)==null||w.call(n,S)}})}onStartGame(e){this.callbacks.startGame=e}onShowShop(e){this.callbacks.showShop=e}onShowLeaderboard(e){this.callbacks.showLeaderboard=e}onShowControls(e){this.callbacks.showControls=e}onPauseGame(e){this.callbacks.pauseGame=e}onResumeGame(e){this.callbacks.resumeGame=e}onRestartGame(e){this.callbacks.restartGame=e}onMainMenu(e){this.callbacks.mainMenu=e}onSubmitScore(e){this.callbacks.submitScore=e}onPurchaseUpgrade(e){this.callbacks.purchaseUpgrade=e}updateHP(e,t){const a=e/t*100;this.elements.hpFill.style.width=`${a}%`,this.elements.hpText.textContent=`${Math.ceil(e)}/${t}`}updateShield(e,t){const a=e/t*100;this.elements.shieldFill.style.width=`${a}%`,this.elements.shieldText.textContent=`${Math.ceil(e)}/${t}`}updateScore(e){this.elements.scoreText.textContent=e.toLocaleString()}updateWave(e){this.elements.waveText.textContent=`Wave ${e}`}updateCoins(e){this.elements.coinsText.textContent=e.toLocaleString()}updateUpgradeDisplay(e){this.elements.weaponLevel.textContent=e.weapon.toString(),this.elements.shieldLevel.textContent=e.shield.toString(),this.elements.hpLevel.textContent=e.hp.toString(),this.elements.speedLevel.textContent=e.speed.toString();const t={weapon:100,shield:150,hp:200,speed:120};Object.keys(t).forEach(a=>{const s=Math.floor(t[a]*Math.pow(1.5,e[a]-1)),o=this.elements[`${a}Cost`];o&&(o.textContent=s.toString())})}showMainMenu(){this.hideAllOverlays(),this.elements.menuOverlay.classList.remove("hidden")}showGame(){this.hideAllOverlays()}showShop(){this.hideAllOverlays(),this.elements.shopOverlay.classList.remove("hidden")}showLeaderboard(e){this.hideAllOverlays(),this.elements.leaderboardOverlay.classList.remove("hidden"),this.populateLeaderboard(e)}showControls(){this.hideAllOverlays(),this.elements.controlsOverlay.classList.remove("hidden")}showGameOver(e,t,a){this.hideAllOverlays(),this.elements.gameOverOverlay.classList.remove("hidden"),this.elements.finalScore.textContent=e.toLocaleString(),this.elements.finalWave.textContent=t.toString(),this.elements.finalCoins.textContent=a.toLocaleString();const s=this.elements.playerName;s.value="",s.focus()}showPause(){this.hideAllOverlays(),this.elements.pauseOverlay.classList.remove("hidden")}hideAllOverlays(){document.querySelectorAll(".menu-overlay").forEach(e=>{e.classList.add("hidden")})}populateLeaderboard(e){if(this.elements.leaderboardList.innerHTML="",e.length===0){this.elements.leaderboardList.innerHTML='<p style="text-align: center; color: #666;">No scores yet!</p>';return}e.forEach((t,a)=>{const s=document.createElement("div");s.className=`leaderboard-entry ${a<3?"top-3":""}`,s.innerHTML=`
        <span class="leaderboard-rank">#${a+1}</span>
        <span class="leaderboard-name">${t.name}</span>
        <span class="leaderboard-score">${t.score.toLocaleString()}</span>
      `,this.elements.leaderboardList.appendChild(s)})}}class R{constructor(){i(this,"SAVE_KEY","spaceBattleSave");i(this,"LEADERBOARD_KEY","spaceBattleLeaderboard")}saveGameData(e){try{localStorage.setItem(this.SAVE_KEY,JSON.stringify(e))}catch(t){console.warn("Failed to save game data:",t)}}loadGameData(){try{const e=localStorage.getItem(this.SAVE_KEY);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load game data:",e)}return{coins:0,upgrades:{weapon:1,shield:1,hp:1,speed:1}}}addScore(e,t,a){try{const s=this.getLeaderboard();s.push({name:e.substring(0,20),score:t,wave:a,date:new Date().toISOString()}),s.sort((h,m)=>m.score-h.score);const o=s.slice(0,10);localStorage.setItem(this.LEADERBOARD_KEY,JSON.stringify(o))}catch(s){console.warn("Failed to save score:",s)}}getLeaderboard(){try{const e=localStorage.getItem(this.LEADERBOARD_KEY);if(e)return JSON.parse(e)}catch(e){console.warn("Failed to load leaderboard:",e)}return[]}clearAllData(){try{localStorage.removeItem(this.SAVE_KEY),localStorage.removeItem(this.LEADERBOARD_KEY)}catch(e){console.warn("Failed to clear data:",e)}}}class N{constructor(){i(this,"audioContext",null);i(this,"enabled",!0);this.initializeAudio()}initializeAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn("Web Audio API not supported:",e),this.enabled=!1}}playShoot(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(800,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(400,this.audioContext.currentTime+.1),t.gain.setValueAtTime(.1,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.1)}playExplosion(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(200,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.3),t.gain.setValueAtTime(.2,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.3)}playPowerUp(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(400,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.2),t.gain.setValueAtTime(.1,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.2)}setEnabled(e){this.enabled=e}}var p=(l=>(l.MENU="menu",l.PLAYING="playing",l.PAUSED="paused",l.GAME_OVER="gameOver",l))(p||{});class H{constructor(e){i(this,"canvas");i(this,"ctx");i(this,"gameState",p.MENU);i(this,"lastTime",0);i(this,"player");i(this,"enemies",[]);i(this,"projectiles",[]);i(this,"powerUps",[]);i(this,"particles");i(this,"inputManager");i(this,"uiManager");i(this,"storageManager");i(this,"soundManager");i(this,"stats",{score:0,wave:1,coins:0,enemiesKilled:0,gameTime:0});i(this,"waveTimer",0);i(this,"waveDelay",3e3);i(this,"enemiesInWave",5);i(this,"enemiesSpawned",0);i(this,"waveComplete",!1);i(this,"powerUpTimer",0);i(this,"powerUpSpawnRate",15e3);this.canvas=e,this.ctx=e.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.inputManager=new B(e),this.uiManager=new G,this.storageManager=new R,this.soundManager=new N,this.player=new O(e.width/2,e.height-100),this.particles=new k,this.loadGameData(),this.setupEventListeners()}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.player&&(this.player.position.x=Math.min(this.player.position.x,this.canvas.width-this.player.width),this.player.position.y=Math.min(this.player.position.y,this.canvas.height-this.player.height))}setupEventListeners(){this.uiManager.onStartGame(()=>this.startNewGame()),this.uiManager.onShowShop(()=>this.showShop()),this.uiManager.onShowLeaderboard(()=>this.showLeaderboard()),this.uiManager.onShowControls(()=>this.showControls()),this.uiManager.onPauseGame(()=>this.pauseGame()),this.uiManager.onResumeGame(()=>this.resumeGame()),this.uiManager.onRestartGame(()=>this.startNewGame()),this.uiManager.onMainMenu(()=>this.showMainMenu()),this.uiManager.onSubmitScore(e=>this.submitScore(e)),this.uiManager.onPurchaseUpgrade(e=>this.purchaseUpgrade(e)),document.addEventListener("keydown",e=>{e.code==="Escape"?this.gameState===p.PLAYING?this.pauseGame():this.gameState===p.PAUSED&&this.resumeGame():e.code==="KeyP"&&this.gameState===p.PLAYING&&this.pauseGame()})}loadGameData(){const e=this.storageManager.loadGameData();this.stats.coins=e.coins,this.player.applyUpgrades(e.upgrades),this.uiManager.updateUpgradeDisplay(e.upgrades),this.uiManager.updateCoins(this.stats.coins)}saveGameData(){this.storageManager.saveGameData({coins:this.stats.coins,upgrades:this.player.getUpgrades()})}start(){this.gameLoop(0)}gameLoop(e){const t=e-this.lastTime;this.lastTime=e,this.update(t),this.render(),requestAnimationFrame(a=>this.gameLoop(a))}update(e){if(this.gameState===p.PLAYING){if(this.stats.gameTime+=e,this.inputManager.update(),this.player.update(e,this.inputManager,this.canvas),this.inputManager.isShooting()||this.inputManager.isMobile()){const t=this.player.shoot();t&&(this.projectiles.push(t),this.soundManager.playShoot())}this.updateProjectiles(e),this.updateEnemies(e),this.updatePowerUps(e),this.particles.update(e),this.checkCollisions(),this.updateWaveLogic(e),this.updatePowerUpSpawning(e),this.updateUI(),this.player.hp<=0&&this.gameOver()}}updateProjectiles(e){for(let t=this.projectiles.length-1;t>=0;t--){const a=this.projectiles[t];a.update(e),(a.position.y<-50||a.position.y>this.canvas.height+50||a.position.x<-50||a.position.x>this.canvas.width+50)&&this.projectiles.splice(t,1)}}updateEnemies(e){for(let t=this.enemies.length-1;t>=0;t--){const a=this.enemies[t];a.update(e,this.player.position,this.canvas);const s=a.shoot();s&&this.projectiles.push(s),a.position.y>this.canvas.height+100&&this.enemies.splice(t,1)}}updatePowerUps(e){for(let t=this.powerUps.length-1;t>=0;t--){const a=this.powerUps[t];a.update(e),(a.position.y>this.canvas.height+50||a.isExpired())&&this.powerUps.splice(t,1)}}checkCollisions(){for(let e=this.projectiles.length-1;e>=0;e--){const t=this.projectiles[e];if(t.isPlayerProjectile)for(let a=this.enemies.length-1;a>=0;a--){const s=this.enemies[a];if(this.checkCollision(t,s)){s.takeDamage(t.damage),this.projectiles.splice(e,1),this.particles.createExplosion(s.position.x,s.position.y,"#ff4444",5),s.hp<=0&&(this.enemies.splice(a,1),this.stats.enemiesKilled++,this.stats.score+=s.scoreValue,this.stats.coins+=s.coinValue,this.particles.createExplosion(s.position.x,s.position.y,"#ffaa00",15),this.soundManager.playExplosion(),Math.random()<.15&&this.spawnPowerUp(s.position.x,s.position.y));break}}}for(let e=this.projectiles.length-1;e>=0;e--){const t=this.projectiles[e];t.isPlayerProjectile||this.checkCollision(t,this.player)&&(this.player.takeDamage(t.damage),this.projectiles.splice(e,1),this.particles.createExplosion(this.player.position.x,this.player.position.y,"#4444ff",8))}for(let e=this.enemies.length-1;e>=0;e--){const t=this.enemies[e];this.checkCollision(t,this.player)&&(this.player.takeDamage(t.damage),t.takeDamage(this.player.ramDamage),this.particles.createExplosion((t.position.x+this.player.position.x)/2,(t.position.y+this.player.position.y)/2,"#ffffff",10),t.hp<=0&&(this.enemies.splice(e,1),this.stats.enemiesKilled++,this.stats.score+=t.scoreValue,this.stats.coins+=t.coinValue,this.soundManager.playExplosion()))}for(let e=this.powerUps.length-1;e>=0;e--){const t=this.powerUps[e];this.checkCollision(t,this.player)&&(this.player.applyPowerUp(t),this.powerUps.splice(e,1),this.particles.createExplosion(t.position.x,t.position.y,t.color,8),this.soundManager.playPowerUp())}}checkCollision(e,t){return e.position.x<t.position.x+t.width&&e.position.x+e.width>t.position.x&&e.position.y<t.position.y+t.height&&e.position.y+e.height>t.position.y}updateWaveLogic(e){this.enemies.length===0&&this.enemiesSpawned>=this.enemiesInWave?(this.waveComplete||(this.waveComplete=!0,this.waveTimer=0,this.stats.score+=this.stats.wave*100,this.stats.coins+=this.stats.wave*10),this.waveTimer+=e,this.waveTimer>=this.waveDelay&&this.startNextWave()):this.enemiesSpawned<this.enemiesInWave&&this.enemies.length<3&&(this.spawnEnemy(),this.enemiesSpawned++)}startNextWave(){this.stats.wave++,this.enemiesInWave=Math.min(5+Math.floor(this.stats.wave/2),15),this.enemiesSpawned=0,this.waveComplete=!1,this.waveTimer=0,this.stats.wave%5===0&&E.increaseDifficulty()}spawnEnemy(){const e=Math.random()*(this.canvas.width-60),t=-60,a=new E(e,t,this.stats.wave);this.enemies.push(a)}updatePowerUpSpawning(e){if(this.powerUpTimer+=e,this.powerUpTimer>=this.powerUpSpawnRate){this.powerUpTimer=0;const t=Math.random()*(this.canvas.width-40);this.spawnPowerUp(t,-40)}}spawnPowerUp(e,t){const a=new U(e,t);this.powerUps.push(a)}updateUI(){this.uiManager.updateHP(this.player.hp,this.player.maxHp),this.uiManager.updateShield(this.player.shield,this.player.maxShield),this.uiManager.updateScore(this.stats.score),this.uiManager.updateWave(this.stats.wave),this.uiManager.updateCoins(this.stats.coins)}render(){const e=this.ctx.createLinearGradient(0,0,0,this.canvas.height);e.addColorStop(0,"#000428"),e.addColorStop(1,"#004e92"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawStars(),(this.gameState===p.PLAYING||this.gameState===p.PAUSED)&&(this.player.render(this.ctx),this.enemies.forEach(t=>t.render(this.ctx)),this.projectiles.forEach(t=>t.render(this.ctx)),this.powerUps.forEach(t=>t.render(this.ctx)),this.particles.render(this.ctx),this.waveComplete&&this.waveTimer<2e3&&this.drawWaveTransition())}drawStars(){this.ctx.fillStyle="#ffffff";for(let e=0;e<100;e++){const t=e*137.5%this.canvas.width,a=e*73.3%this.canvas.height,s=Math.sin(e+this.stats.gameTime*.001)*.5+1;this.ctx.globalAlpha=Math.sin(e+this.stats.gameTime*.002)*.3+.7,this.ctx.fillRect(t,a,s,s)}this.ctx.globalAlpha=1}drawWaveTransition(){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ffff00",this.ctx.font="bold 48px Orbitron",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const e=`WAVE ${this.stats.wave} COMPLETE!`;this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2-30),this.ctx.font="bold 24px Orbitron",this.ctx.fillStyle="#00ffff";const t=`Next wave in ${Math.ceil((this.waveDelay-this.waveTimer)/1e3)}...`;this.ctx.fillText(t,this.canvas.width/2,this.canvas.height/2+30),this.ctx.restore()}startNewGame(){this.gameState=p.PLAYING,this.stats={score:0,wave:1,coins:this.stats.coins,enemiesKilled:0,gameTime:0},this.player.reset(this.canvas.width/2,this.canvas.height-100),this.enemies=[],this.projectiles=[],this.powerUps=[],this.particles=new k,this.enemiesInWave=5,this.enemiesSpawned=0,this.waveComplete=!1,this.waveTimer=0,this.powerUpTimer=0,E.resetDifficulty(),this.uiManager.showGame()}pauseGame(){this.gameState===p.PLAYING&&(this.gameState=p.PAUSED,this.uiManager.showPause())}resumeGame(){this.gameState===p.PAUSED&&(this.gameState=p.PLAYING,this.uiManager.showGame())}gameOver(){this.gameState=p.GAME_OVER,this.saveGameData(),this.uiManager.showGameOver(this.stats.score,this.stats.wave-1,this.stats.coins)}showMainMenu(){this.gameState=p.MENU,this.uiManager.showMainMenu()}showShop(){this.uiManager.showShop()}showLeaderboard(){const e=this.storageManager.getLeaderboard();this.uiManager.showLeaderboard(e)}showControls(){this.uiManager.showControls()}submitScore(e){this.storageManager.addScore(e,this.stats.score,this.stats.wave-1),this.showLeaderboard()}purchaseUpgrade(e){const t=this.player.getUpgradeCost(e);return this.stats.coins>=t?(this.stats.coins-=t,this.player.upgrade(e),this.saveGameData(),this.uiManager.updateCoins(this.stats.coins),this.uiManager.updateUpgradeDisplay(this.player.getUpgrades()),!0):!1}}document.addEventListener("DOMContentLoaded",()=>{const l=document.getElementById("gameCanvas");new H(l).start()});
