var Ut=Object.defineProperty;var Dt=(r,e,t)=>e in r?Ut(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var d=(r,e,t)=>Dt(r,typeof e!="symbol"?e+"":e,t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();class A{constructor(e=0,t=0){d(this,"x");d(this,"y");this.x=e,this.y=t}add(e){return new A(this.x+e.x,this.y+e.y)}subtract(e){return new A(this.x-e.x,this.y-e.y)}multiply(e){return new A(this.x*e,this.y*e)}magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}normalize(){const e=this.magnitude();return e===0?new A(0,0):new A(this.x/e,this.y/e)}distance(e){const t=this.x-e.x,s=this.y-e.y;return Math.sqrt(t*t+s*s)}clone(){return new A(this.x,this.y)}}class C{constructor(e,t,s,i,n,o,a,h=4,l=12){d(this,"position");d(this,"velocity");d(this,"width",4);d(this,"height",12);d(this,"damage");d(this,"isPlayerProjectile");d(this,"color");this.position=new A(e,t),this.velocity=new A(s,i),this.damage=n,this.isPlayerProjectile=o,this.color=a,this.width=h,this.height=l}update(e){this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3}render(e){e.save(),e.shadowColor=this.color,e.shadowBlur=5,e.fillStyle=this.color,this.isPlayerProjectile?(e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),e.fill()):this.width>6?(e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),e.fill()):e.fillRect(this.position.x,this.position.y,this.width,this.height),e.restore()}}var L=(r=>(r.HEALTH="health",r.SHIELD="shield",r.WEAPON="weapon",r.SPEED="speed",r))(L||{});class Bt{constructor(e,t){d(this,"position");d(this,"velocity");d(this,"width",30);d(this,"height",30);d(this,"type");d(this,"color");d(this,"lifeTime",15e3);d(this,"age",0);d(this,"pulseTimer",0);this.position=new A(e,t),this.velocity=new A(0,50);const s=Object.values(L);this.type=s[Math.floor(Math.random()*s.length)],this.color=this.getColor()}getColor(){switch(this.type){case"health":return"#00ff00";case"shield":return"#0088ff";case"weapon":return"#ff4400";case"speed":return"#ffff00";default:return"#ffffff"}}update(e){this.age+=e,this.pulseTimer+=e,this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3}isExpired(){return this.age>=this.lifeTime}render(e){e.save();const t=Math.sin(this.pulseTimer*.005)*.3+.7,s=this.age>this.lifeTime-3e3?Math.sin(this.age*.01)*.5+.5:1;e.globalAlpha=s,e.shadowColor=this.color,e.shadowBlur=10*t,e.fillStyle=this.color,e.strokeStyle="#ffffff",e.lineWidth=2;const i=this.position.x+this.width/2,n=this.position.y+this.height/2,o=this.width/2*t;switch(this.type){case"health":e.fillRect(i-o*.6,n-o*.2,o*1.2,o*.4),e.fillRect(i-o*.2,n-o*.6,o*.4,o*1.2);break;case"shield":e.beginPath(),e.arc(i,n,o,0,Math.PI*2),e.fill(),e.stroke();break;case"weapon":e.beginPath(),e.moveTo(i,n-o),e.lineTo(i-o*.5,n+o),e.lineTo(i+o*.5,n+o),e.closePath(),e.fill(),e.stroke();break;case"speed":e.beginPath(),e.moveTo(i-o*.3,n-o),e.lineTo(i+o*.3,n-o*.2),e.lineTo(i-o*.1,n-o*.2),e.lineTo(i+o*.3,n+o),e.lineTo(i-o*.3,n+o*.2),e.lineTo(i+o*.1,n+o*.2),e.closePath(),e.fill(),e.stroke();break}e.restore()}}class Nt{constructor(e,t){d(this,"position");d(this,"velocity");d(this,"width",40);d(this,"height",40);d(this,"hp",100);d(this,"maxHp",100);d(this,"shield",100);d(this,"maxShield",100);d(this,"speed",300);d(this,"damage",25);d(this,"fireRate",300);d(this,"ramDamage",50);d(this,"upgrades",{weapon:1,shield:1,hp:1,speed:1});d(this,"lastShot",0);d(this,"shootCooldown",300);d(this,"lastDamageTime",0);d(this,"shieldRegenDelay",3e3);d(this,"shieldRegenRate",20);d(this,"powerUpEffects",new Map);this.position=new A(e,t),this.velocity=new A(0,0),this.initializeStats()}initializeStats(){this.maxHp=100+(this.upgrades.hp-1)*25,this.hp=this.maxHp,this.maxShield=100+(this.upgrades.shield-1)*30,this.shield=this.maxShield,this.speed=300+(this.upgrades.speed-1)*50,this.damage=25+(this.upgrades.weapon-1)*10,this.fireRate=300-(this.upgrades.weapon-1)*30,this.shootCooldown=this.fireRate}update(e,t,s){this.velocity.x=0,this.velocity.y=0,t.isMovingLeft()&&(this.velocity.x-=1),t.isMovingRight()&&(this.velocity.x+=1),t.isMovingUp()&&(this.velocity.y-=1),t.isMovingDown()&&(this.velocity.y+=1);const i=t.getTouchInput();if(i){const o=i.x-this.width/2,a=i.y-this.height/2,h=o-this.position.x,l=a-this.position.y,c=Math.sqrt(h*h+l*l);c>5&&(this.velocity.x=h/c,this.velocity.y=l/c)}this.velocity.x!==0&&this.velocity.y!==0&&(this.velocity.x*=.707,this.velocity.y*=.707);const n=this.getCurrentSpeed();this.position.x+=this.velocity.x*n*e/1e3,this.position.y+=this.velocity.y*n*e/1e3,this.position.x=Math.max(0,Math.min(s.width-this.width,this.position.x)),this.position.y=Math.max(0,Math.min(s.height-this.height,this.position.y)),this.lastShot+=e,Date.now()-this.lastDamageTime>this.shieldRegenDelay&&this.shield<this.maxShield&&(this.shield=Math.min(this.maxShield,this.shield+this.shieldRegenRate*e/1e3)),this.updatePowerUpEffects(e)}getCurrentSpeed(){let e=this.speed;return this.powerUpEffects.has(L.SPEED)&&(e*=1.5),e}updatePowerUpEffects(e){for(const[t,s]of this.powerUpEffects.entries()){const i=s-e;i<=0?this.powerUpEffects.delete(t):this.powerUpEffects.set(t,i)}}shoot(){if(this.lastShot>=this.shootCooldown){this.lastShot=0;const e=this.getCurrentDamage();return new C(this.position.x+this.width/2-2,this.position.y,0,-800,e,!0,"#00ffff")}return null}getCurrentDamage(){let e=this.damage;return this.powerUpEffects.has(L.WEAPON)&&(e*=2),e}takeDamage(e){if(this.lastDamageTime=Date.now(),this.shield>0){const t=Math.min(this.shield,e);this.shield-=t,e-=t}e>0&&(this.hp=Math.max(0,this.hp-e))}applyPowerUp(e){switch(e.type){case L.HEALTH:this.hp=Math.min(this.maxHp,this.hp+30);break;case L.SHIELD:this.shield=Math.min(this.maxShield,this.shield+50);break;case L.WEAPON:this.powerUpEffects.set(L.WEAPON,1e4);break;case L.SPEED:this.powerUpEffects.set(L.SPEED,8e3);break}}upgrade(e){this.upgrades[e]++,this.initializeStats()}getUpgradeCost(e){return Math.floor({weapon:100,shield:150,hp:200,speed:120}[e]*Math.pow(1.5,this.upgrades[e]-1))}getUpgrades(){return{...this.upgrades}}applyUpgrades(e){this.upgrades={...e},this.initializeStats()}reset(e,t){this.position.x=e,this.position.y=t,this.velocity.x=0,this.velocity.y=0,this.hp=this.maxHp,this.shield=this.maxShield,this.lastShot=0,this.lastDamageTime=0,this.powerUpEffects.clear()}render(e){e.save(),this.shield>0&&(e.strokeStyle=`rgba(68, 68, 255, ${this.shield/this.maxShield*.5})`,e.lineWidth=3,e.beginPath(),e.arc(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2+5,0,Math.PI*2),e.stroke()),this.powerUpEffects.has(L.WEAPON)&&(e.shadowColor="#ff0000",e.shadowBlur=10),this.powerUpEffects.has(L.SPEED)&&(e.strokeStyle="#ffff00",e.lineWidth=2,e.strokeRect(this.position.x-2,this.position.y-2,this.width+4,this.height+4)),e.fillStyle="#00ffff",e.beginPath(),e.moveTo(this.position.x+this.width/2,this.position.y),e.lineTo(this.position.x,this.position.y+this.height),e.lineTo(this.position.x+this.width/4,this.position.y+this.height*.8),e.lineTo(this.position.x+this.width*.75,this.position.y+this.height*.8),e.lineTo(this.position.x+this.width,this.position.y+this.height),e.closePath(),e.fill(),e.fillStyle="#ff4444",e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height+5,8,12,0,0,Math.PI*2),e.fill(),e.restore()}}const D=class D{constructor(e,t,s,i){d(this,"position");d(this,"velocity");d(this,"width",30);d(this,"height",30);d(this,"hp",25);d(this,"maxHp",25);d(this,"damage",15);d(this,"scoreValue",50);d(this,"coinValue",5);d(this,"type");d(this,"speed",150);d(this,"lastShot",0);d(this,"shootCooldown",2e3);d(this,"movementPattern");d(this,"patternTimer",0);d(this,"specialTimer",0);d(this,"burstCount",0);this.position=new A(e,t),this.velocity=new A(0,0),i?this.type=i:this.type=this.selectEnemyType(s),this.initializeStats(s),this.movementPattern=Math.floor(Math.random()*4)}selectEnemyType(e){const t=Math.random();return e<=3?t<.7?"scout":"fighter":e<=7?t<.4?"scout":t<.65?"fighter":t<.85?"heavy":"bomber":t<.25?"scout":t<.45?"fighter":t<.65?"heavy":t<.8?"bomber":t<.95?"interceptor":"destroyer"}initializeStats(e){const t=1+(e-1)*.1;switch(this.type){case"scout":this.width=30,this.height=30,this.maxHp=Math.floor(25*t*D.difficultyMultiplier),this.speed=150+e*10,this.damage=Math.floor(15*t),this.shootCooldown=2e3,this.scoreValue=50,this.coinValue=5;break;case"fighter":this.width=40,this.height=40,this.maxHp=Math.floor(50*t*D.difficultyMultiplier),this.speed=100+e*8,this.damage=Math.floor(25*t),this.shootCooldown=1500,this.scoreValue=100,this.coinValue=10;break;case"heavy":this.width=60,this.height=50,this.maxHp=Math.floor(100*t*D.difficultyMultiplier),this.speed=60+e*5,this.damage=Math.floor(40*t),this.shootCooldown=1e3,this.scoreValue=200,this.coinValue=20;break;case"bomber":this.width=50,this.height=45,this.maxHp=Math.floor(75*t*D.difficultyMultiplier),this.speed=80+e*6,this.damage=Math.floor(35*t),this.shootCooldown=3e3,this.scoreValue=150,this.coinValue=15;break;case"interceptor":this.width=35,this.height=35,this.maxHp=Math.floor(40*t*D.difficultyMultiplier),this.speed=200+e*15,this.damage=Math.floor(20*t),this.shootCooldown=800,this.scoreValue=120,this.coinValue=12;break;case"destroyer":this.width=70,this.height=60,this.maxHp=Math.floor(150*t*D.difficultyMultiplier),this.speed=50+e*4,this.damage=Math.floor(50*t),this.shootCooldown=1200,this.scoreValue=300,this.coinValue=30;break}this.hp=this.maxHp}update(e,t,s){this.patternTimer+=e,this.specialTimer+=e,this.lastShot+=e,this.updateMovement(t),this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3,this.position.x=Math.max(0,Math.min(s.width-this.width,this.position.x))}updateMovement(e){switch(this.type){case"scout":this.updateScoutMovement();break;case"fighter":this.updateFighterMovement();break;case"heavy":this.updateHeavyMovement();break;case"bomber":this.updateBomberMovement(e);break;case"interceptor":this.updateInterceptorMovement(e);break;case"destroyer":this.updateDestroyerMovement(e);break}}updateScoutMovement(){switch(this.movementPattern){case 0:this.velocity.y=this.speed,this.velocity.x=0;break;case 1:this.velocity.y=this.speed*.7,this.velocity.x=Math.sin(this.patternTimer*.003)*this.speed*.5;break;case 2:this.velocity.y=this.speed*.8,this.velocity.x=Math.sin(this.patternTimer*.005)*this.speed*.3;break;case 3:this.velocity.y=this.speed*.6,this.velocity.x=Math.cos(this.patternTimer*.004)*this.speed*.4;break}}updateFighterMovement(){this.velocity.y=this.speed*.7,this.velocity.x=Math.sin(this.patternTimer*.006)*this.speed*.6}updateHeavyMovement(){this.velocity.y=this.speed,this.velocity.x=Math.sin(this.patternTimer*.002)*this.speed*.2}updateBomberMovement(e){const t=e.x-this.position.x;this.velocity.y=this.speed*.5,this.velocity.x=Math.sign(t)*this.speed*.3}updateInterceptorMovement(e){const t=e.x-this.position.x,s=e.y-this.position.y,i=Math.sqrt(t*t+s*s);i>0&&(this.velocity.x=t/i*this.speed*.4+Math.sin(this.patternTimer*.008)*this.speed*.3,this.velocity.y=Math.max(s/i*this.speed*.2,this.speed*.6))}updateDestroyerMovement(e){const t=e.x-this.position.x;this.velocity.y=this.speed*.8,this.velocity.x=Math.sign(t)*this.speed*.2}shoot(){return this.lastShot>=this.shootCooldown?(this.lastShot=0,this.createProjectiles()):[]}createProjectiles(){const e=[],t=this.position.x+this.width/2,s=this.position.y+this.height;switch(this.type){case"scout":e.push(new C(t-2,s,0,400,this.damage,!1,"#ff4444"));break;case"fighter":e.push(new C(t-8,s,0,450,this.damage,!1,"#ff8800")),e.push(new C(t+4,s,0,450,this.damage,!1,"#ff8800"));break;case"heavy":e.push(new C(t-2,s,0,350,this.damage,!1,"#ff0088")),e.push(new C(t-10,s,-50,350,this.damage*.8,!1,"#ff0088")),e.push(new C(t+6,s,50,350,this.damage*.8,!1,"#ff0088"));break;case"bomber":e.push(new C(t-4,s,0,300,this.damage*1.5,!1,"#ffaa00",8,16));break;case"interceptor":this.burstCount<3?(e.push(new C(t-2,s,0,500,this.damage*.7,!1,"#00ff88")),this.burstCount++,this.lastShot=this.shootCooldown-200):this.burstCount=0;break;case"destroyer":for(let i=-2;i<=2;i++)e.push(new C(t-2,s,i*80,400,this.damage*.8,!1,"#8800ff"));break}return e}takeDamage(e){this.hp=Math.max(0,this.hp-e)}render(e){switch(e.save(),this.type){case"scout":this.renderScout(e);break;case"fighter":this.renderFighter(e);break;case"heavy":this.renderHeavy(e);break;case"bomber":this.renderBomber(e);break;case"interceptor":this.renderInterceptor(e);break;case"destroyer":this.renderDestroyer(e);break}this.renderHealthBar(e),e.restore()}renderScout(e){e.fillStyle="#ff4444",e.beginPath(),e.moveTo(this.position.x+this.width/2,this.position.y+this.height),e.lineTo(this.position.x,this.position.y),e.lineTo(this.position.x+this.width/4,this.position.y+this.height*.3),e.lineTo(this.position.x+this.width*.75,this.position.y+this.height*.3),e.lineTo(this.position.x+this.width,this.position.y),e.closePath(),e.fill()}renderFighter(e){e.fillStyle="#ff8800",e.fillRect(this.position.x,this.position.y,this.width,this.height),e.fillStyle="#ffaa44",e.fillRect(this.position.x-5,this.position.y+10,10,20),e.fillRect(this.position.x+this.width-5,this.position.y+10,10,20)}renderHeavy(e){e.fillStyle="#ff0088",e.fillRect(this.position.x,this.position.y,this.width,this.height),e.fillStyle="#ff44aa",e.fillRect(this.position.x+5,this.position.y+5,this.width-10,this.height-10),e.fillStyle="#ffffff",e.fillRect(this.position.x+10,this.position.y+this.height-5,8,10),e.fillRect(this.position.x+this.width-18,this.position.y+this.height-5,8,10)}renderBomber(e){e.fillStyle="#ffaa00",e.fillRect(this.position.x+10,this.position.y,this.width-20,this.height),e.fillStyle="#ff8800",e.fillRect(this.position.x,this.position.y+15,this.width,15),e.fillStyle="#ff6600",e.fillRect(this.position.x+15,this.position.y+this.height-8,this.width-30,8)}renderInterceptor(e){e.fillStyle="#00ff88",e.beginPath(),e.moveTo(this.position.x+this.width/2,this.position.y),e.lineTo(this.position.x,this.position.y+this.height),e.lineTo(this.position.x+this.width/3,this.position.y+this.height*.7),e.lineTo(this.position.x+this.width*.67,this.position.y+this.height*.7),e.lineTo(this.position.x+this.width,this.position.y+this.height),e.closePath(),e.fill(),e.fillStyle="#44ffaa",e.fillRect(this.position.x+8,this.position.y+this.height,4,8),e.fillRect(this.position.x+this.width-12,this.position.y+this.height,4,8)}renderDestroyer(e){e.fillStyle="#8800ff",e.fillRect(this.position.x+5,this.position.y,this.width-10,this.height),e.fillStyle="#aa44ff",e.fillRect(this.position.x+20,this.position.y-5,this.width-40,15),e.fillStyle="#ffffff",e.beginPath(),e.arc(this.position.x+15,this.position.y+20,6,0,Math.PI*2),e.arc(this.position.x+this.width-15,this.position.y+20,6,0,Math.PI*2),e.fill(),e.fillStyle="#6600cc",e.fillRect(this.position.x,this.position.y+10,5,this.height-20),e.fillRect(this.position.x+this.width-5,this.position.y+10,5,this.height-20)}renderHealthBar(e){if(this.hp<this.maxHp){const t=this.width,s=4,i=this.position.y-8;e.fillStyle="rgba(255, 0, 0, 0.3)",e.fillRect(this.position.x,i,t,s),e.fillStyle="#ff0000";const n=this.hp/this.maxHp*t;e.fillRect(this.position.x,i,n,s)}}static increaseDifficulty(){D.difficultyMultiplier+=.2}static resetDifficulty(){D.difficultyMultiplier=1}};d(D,"difficultyMultiplier",1);let ae=D;class Ft{constructor(e,t,s,i){d(this,"position");d(this,"velocity");d(this,"width");d(this,"height");d(this,"hp");d(this,"maxHp");d(this,"damage");d(this,"scoreValue");d(this,"coinValue");d(this,"type");d(this,"isDefeated",!1);d(this,"speed");d(this,"lastShot",0);d(this,"shootCooldown");d(this,"patternTimer",0);d(this,"specialTimer",0);d(this,"phase",1);d(this,"specialAttackTimer",0);d(this,"specialAttackCooldown",8e3);this.position=new A(e,t),this.velocity=new A(0,0),i?this.type=i:this.type=this.selectBossType(s),this.initializeStats(s)}selectBossType(e){return e<=5?"dreadnought":e<=10?"mothership":"fortress"}initializeStats(e){const t=1+(e-1)*.15;switch(this.type){case"dreadnought":this.width=120,this.height=80,this.maxHp=Math.floor(500*t),this.speed=80,this.damage=Math.floor(60*t),this.shootCooldown=1500,this.scoreValue=2e3,this.coinValue=200;break;case"mothership":this.width=160,this.height=100,this.maxHp=Math.floor(800*t),this.speed=60,this.damage=Math.floor(80*t),this.shootCooldown=1200,this.scoreValue=3500,this.coinValue=350;break;case"fortress":this.width=200,this.height=120,this.maxHp=Math.floor(1200*t),this.speed=40,this.damage=Math.floor(100*t),this.shootCooldown=1e3,this.scoreValue=5e3,this.coinValue=500;break}this.hp=this.maxHp}update(e,t,s){this.patternTimer+=e,this.specialTimer+=e,this.lastShot+=e,this.specialAttackTimer+=e;const i=this.hp/this.maxHp;i>.66?this.phase=1:i>.33?this.phase=2:this.phase=3,this.updateMovement(t),this.position.x+=this.velocity.x*e/1e3,this.position.y+=this.velocity.y*e/1e3,this.position.x=Math.max(0,Math.min(s.width-this.width,this.position.x)),this.position.y=Math.max(-this.height*.3,Math.min(s.height*.4,this.position.y))}updateMovement(e){switch(this.type){case"dreadnought":this.velocity.x=Math.sin(this.patternTimer*.001)*this.speed,this.velocity.y=Math.sin(this.patternTimer*5e-4)*this.speed*.3;break;case"mothership":const t=this.patternTimer*8e-4;this.velocity.x=Math.cos(t)*this.speed*.8,this.velocity.y=Math.sin(t)*this.speed*.4;break;case"fortress":if(this.phase===3){const s=e.x-(this.position.x+this.width/2);this.velocity.x=Math.sign(s)*this.speed*.5,this.velocity.y=Math.sin(this.patternTimer*3e-4)*this.speed*.2}else this.velocity.x=Math.sin(this.patternTimer*6e-4)*this.speed*.7,this.velocity.y=0;break}}shoot(){const e=[];return this.lastShot>=this.shootCooldown&&(this.lastShot=0,e.push(...this.createRegularProjectiles())),this.specialAttackTimer>=this.specialAttackCooldown&&(this.specialAttackTimer=0,e.push(...this.createSpecialAttack())),e}createRegularProjectiles(){const e=[],t=this.position.x+this.width/2,s=this.position.y+this.height;switch(this.type){case"dreadnought":for(let n=0;n<4;n++){const o=(n-1.5)*20;e.push(new C(t+o-3,s,0,350,this.damage,!1,"#ff0000",6,12))}break;case"mothership":for(let n=-3;n<=3;n++)e.push(new C(t-3,s,n*60,400,this.damage*.8,!1,"#ff4400",5,10));break;case"fortress":const i=this.phase===3?8:6;for(let n=0;n<i;n++){const o=n/i*Math.PI*2,a=Math.sin(o)*200,h=Math.cos(o)*300+200;e.push(new C(t-4,s,a,h,this.damage,!1,"#8800ff",8,16))}break}return e}createSpecialAttack(){const e=[],t=this.position.x+this.width/2,s=this.position.y+this.height;switch(this.type){case"dreadnought":for(let i=0;i<10;i++)e.push(new C(t-2,s+i*5,0,600,this.damage*1.5,!1,"#ffff00",4,20));break;case"mothership":for(let i=0;i<5;i++){const n=(i-2)*30;e.push(new C(t+n-3,s,0,250,this.damage*1.2,!1,"#ff8800",6,14))}break;case"fortress":for(let i=0;i<12;i++){const n=i/12*Math.PI*2,o=Math.sin(n)*300,a=Math.cos(n)*200+250;e.push(new C(t-5,s,o,a,this.damage*1.3,!1,"#ff00ff",10,20))}break}return e}takeDamage(e){this.hp=Math.max(0,this.hp-e),this.hp<=0&&(this.isDefeated=!0)}render(e){switch(e.save(),e.shadowColor=this.getBossColor(),e.shadowBlur=15,this.type){case"dreadnought":this.renderDreadnought(e);break;case"mothership":this.renderMothership(e);break;case"fortress":this.renderFortress(e);break}this.renderHealthBar(e),this.renderPhaseIndicator(e),e.restore()}renderDreadnought(e){e.fillStyle="#ff0000",e.fillRect(this.position.x+20,this.position.y+10,this.width-40,this.height-20),e.fillStyle="#ff4444",e.fillRect(this.position.x+40,this.position.y,this.width-80,20),e.fillStyle="#ffffff";for(let t=0;t<4;t++){const s=this.position.x+30+t*20;e.beginPath(),e.arc(s,this.position.y+this.height-10,8,0,Math.PI*2),e.fill()}e.fillStyle="#ffaa00",e.fillRect(this.position.x+10,this.position.y+this.height,this.width-20,8)}renderMothership(e){e.fillStyle="#ff4400",e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/2,this.height/2,0,0,Math.PI*2),e.fill(),e.fillStyle="#ff8800",e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/3,this.height/3,0,0,Math.PI*2),e.fill(),e.fillStyle="#ffff00",e.beginPath(),e.ellipse(this.position.x+this.width/2,this.position.y+this.height/2,this.width/6,this.height/6,0,0,Math.PI*2),e.fill(),e.fillStyle="#ffffff";for(let t=0;t<8;t++){const s=t/8*Math.PI*2,i=this.position.x+this.width/2+Math.cos(s)*this.width/3,n=this.position.y+this.height/2+Math.sin(s)*this.height/3;e.beginPath(),e.arc(i,n,4,0,Math.PI*2),e.fill()}}renderFortress(e){e.fillStyle="#8800ff",e.fillRect(this.position.x,this.position.y+20,this.width,this.height-40),e.fillStyle="#aa44ff",e.fillRect(this.position.x+20,this.position.y,this.width-40,40),e.fillRect(this.position.x+20,this.position.y+this.height-20,this.width-40,20),e.fillStyle="#6600cc",e.fillRect(this.position.x,this.position.y,20,this.height),e.fillRect(this.position.x+this.width-20,this.position.y,20,this.height),e.fillStyle="#ffffff";for(let t=0;t<6;t++){const s=this.position.x+30+t*28;e.fillRect(s,this.position.y+this.height-15,8,15)}e.fillStyle="#ffff00",e.fillRect(this.position.x+this.width/2-10,this.position.y+this.height-25,20,25)}getBossColor(){switch(this.type){case"dreadnought":return"#ff0000";case"mothership":return"#ff4400";case"fortress":return"#8800ff";default:return"#ff0000"}}renderHealthBar(e){const t=this.width,s=8,i=this.position.y-20;e.fillStyle="rgba(255, 0, 0, 0.3)",e.fillRect(this.position.x,i,t,s),e.fillStyle="#ff0000";const n=this.hp/this.maxHp*t;e.fillRect(this.position.x,i,n,s),e.strokeStyle="#ffffff",e.lineWidth=2,e.strokeRect(this.position.x,i,t,s)}renderPhaseIndicator(e){e.fillStyle="#ffffff",e.font="bold 16px Orbitron",e.textAlign="center",e.fillText(`PHASE ${this.phase}`,this.position.x+this.width/2,this.position.y-30)}}class Je{constructor(){d(this,"particles",[])}createExplosion(e,t,s,i){for(let n=0;n<i;n++){const o=Math.PI*2*n/i+Math.random()*.5,a=100+Math.random()*200,h={position:new A(e,t),velocity:new A(Math.cos(o)*a,Math.sin(o)*a),life:1e3+Math.random()*1e3,maxLife:1e3+Math.random()*1e3,color:s,size:2+Math.random()*4};this.particles.push(h)}}update(e){for(let t=this.particles.length-1;t>=0;t--){const s=this.particles[t];s.position.x+=s.velocity.x*e/1e3,s.position.y+=s.velocity.y*e/1e3,s.life-=e,s.velocity.y+=50*e/1e3,s.velocity.x*=.99,s.velocity.y*=.99,s.life<=0&&this.particles.splice(t,1)}}render(e){e.save();for(const t of this.particles){const s=t.life/t.maxLife;e.globalAlpha=s,e.fillStyle=t.color,e.beginPath(),e.arc(t.position.x,t.position.y,t.size*s,0,Math.PI*2),e.fill()}e.restore()}}class Gt{constructor(e){d(this,"keys",new Set);d(this,"mousePos",{x:0,y:0});d(this,"touchPos",null);d(this,"isTouching",!1);d(this,"canvas");this.canvas=e,this.setupEventListeners()}setupEventListeners(){document.addEventListener("keydown",e=>{this.keys.add(e.code),e.preventDefault()}),document.addEventListener("keyup",e=>{this.keys.delete(e.code),e.preventDefault()}),this.canvas.addEventListener("mousemove",e=>{const t=this.canvas.getBoundingClientRect();this.mousePos.x=e.clientX-t.left,this.mousePos.y=e.clientY-t.top}),this.canvas.addEventListener("touchstart",e=>{e.preventDefault(),this.isTouching=!0,this.updateTouchPosition(e)}),this.canvas.addEventListener("touchmove",e=>{e.preventDefault(),this.isTouching&&this.updateTouchPosition(e)}),this.canvas.addEventListener("touchend",e=>{e.preventDefault(),this.isTouching=!1,this.touchPos=null}),this.canvas.addEventListener("contextmenu",e=>{e.preventDefault()})}updateTouchPosition(e){if(e.touches.length>0){const t=this.canvas.getBoundingClientRect();this.touchPos={x:e.touches[0].clientX-t.left,y:e.touches[0].clientY-t.top}}}update(){}isMovingLeft(){return this.keys.has("KeyA")||this.keys.has("ArrowLeft")}isMovingRight(){return this.keys.has("KeyD")||this.keys.has("ArrowRight")}isMovingUp(){return this.keys.has("KeyW")||this.keys.has("ArrowUp")}isMovingDown(){return this.keys.has("KeyS")||this.keys.has("ArrowDown")}isShooting(){return this.keys.has("Space")}getTouchInput(){return this.touchPos}isMobile(){return this.isTouching}}class qt{constructor(){d(this,"elements",{});d(this,"callbacks",{});this.initializeElements(),this.setupEventListeners()}initializeElements(){this.elements.hud=document.getElementById("hud"),this.elements.menuOverlay=document.getElementById("menu-overlay"),this.elements.shopOverlay=document.getElementById("shop-overlay"),this.elements.leaderboardOverlay=document.getElementById("leaderboard-overlay"),this.elements.controlsOverlay=document.getElementById("controls-overlay"),this.elements.gameOverOverlay=document.getElementById("game-over-overlay"),this.elements.pauseOverlay=document.getElementById("pause-overlay"),this.elements.hpFill=document.getElementById("hp-fill"),this.elements.hpText=document.getElementById("hp-text"),this.elements.shieldFill=document.getElementById("shield-fill"),this.elements.shieldText=document.getElementById("shield-text"),this.elements.scoreText=document.getElementById("score-text"),this.elements.waveText=document.getElementById("wave-text"),this.elements.coinsText=document.getElementById("coins-text"),this.elements.weaponCost=document.getElementById("weapon-cost"),this.elements.weaponLevel=document.getElementById("weapon-level"),this.elements.shieldCost=document.getElementById("shield-cost"),this.elements.shieldLevel=document.getElementById("shield-level"),this.elements.hpCost=document.getElementById("hp-cost"),this.elements.hpLevel=document.getElementById("hp-level"),this.elements.speedCost=document.getElementById("speed-cost"),this.elements.speedLevel=document.getElementById("speed-level"),this.elements.finalScore=document.getElementById("final-score"),this.elements.finalWave=document.getElementById("final-wave"),this.elements.finalCoins=document.getElementById("final-coins"),this.elements.playerName=document.getElementById("player-name"),this.elements.leaderboardList=document.getElementById("leaderboard-list"),Object.keys(this.elements).forEach(e=>{this.elements[e]||console.warn(`UI element not found: ${e}`)})}setupEventListeners(){var e,t,s,i,n,o,a,h,l,c,u,f,g,v,_,w;(e=document.getElementById("start-btn"))==null||e.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).startGame)==null||m.call(p)}),(t=document.getElementById("shop-btn"))==null||t.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).pauseAndShowShop)==null||m.call(p)}),(s=document.getElementById("leaderboard-btn"))==null||s.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).showLeaderboard)==null||m.call(p)}),(i=document.getElementById("controls-btn"))==null||i.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).showControls)==null||m.call(p)}),(n=document.getElementById("shop-close-btn"))==null||n.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).resumeFromShop)==null||m.call(p)}),document.querySelectorAll(".shop-buy-btn").forEach(p=>{p.addEventListener("click",m=>{var T,P;const E=m.target.getAttribute("data-upgrade");(P=(T=this.callbacks).purchaseUpgrade)==null||P.call(T,E)})}),(o=document.getElementById("leaderboard-close-btn"))==null||o.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).resumeFromLeaderboard)==null||m.call(p)}),(a=document.getElementById("controls-close-btn"))==null||a.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).resumeFromControls)==null||m.call(p)}),(h=document.getElementById("submit-score-btn"))==null||h.addEventListener("click",()=>{var y,E,T;const p=this.elements.playerName,m=((y=p==null?void 0:p.value)==null?void 0:y.trim())||"Anonymous";(T=(E=this.callbacks).submitScore)==null||T.call(E,m)}),(l=document.getElementById("restart-btn"))==null||l.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).restartGame)==null||m.call(p)}),(c=document.getElementById("main-menu-btn"))==null||c.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).mainMenu)==null||m.call(p)}),(u=document.getElementById("resume-btn"))==null||u.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).resumeGame)==null||m.call(p)}),(f=document.getElementById("pause-shop-btn"))==null||f.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).showShop)==null||m.call(p)}),(g=document.getElementById("pause-menu-btn"))==null||g.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).mainMenu)==null||m.call(p)}),(v=document.getElementById("mobile-menu-btn"))==null||v.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).pauseAndShowShop)==null||m.call(p)}),(_=document.getElementById("mobile-pause-btn"))==null||_.addEventListener("click",()=>{var p,m;(m=(p=this.callbacks).pauseGame)==null||m.call(p)}),(w=this.elements.playerName)==null||w.addEventListener("keypress",p=>{var m,y,E;if(p.key==="Enter"){const T=this.elements.playerName,P=((m=T==null?void 0:T.value)==null?void 0:m.trim())||"Anonymous";(E=(y=this.callbacks).submitScore)==null||E.call(y,P)}})}onStartGame(e){this.callbacks.startGame=e}onShowShop(e){this.callbacks.showShop=e}onPauseAndShowShop(e){this.callbacks.pauseAndShowShop=e}onResumeFromShop(e){this.callbacks.resumeFromShop=e}onResumeFromLeaderboard(e){this.callbacks.resumeFromLeaderboard=e}onResumeFromControls(e){this.callbacks.resumeFromControls=e}onShowLeaderboard(e){this.callbacks.showLeaderboard=e}onShowControls(e){this.callbacks.showControls=e}onPauseGame(e){this.callbacks.pauseGame=e}onResumeGame(e){this.callbacks.resumeGame=e}onRestartGame(e){this.callbacks.restartGame=e}onMainMenu(e){this.callbacks.mainMenu=e}onSubmitScore(e){this.callbacks.submitScore=e}onPurchaseUpgrade(e){this.callbacks.purchaseUpgrade=e}updateHP(e,t){const s=this.elements.hpFill,i=this.elements.hpText;if(s&&i){const n=e/t*100;s.style.width=`${n}%`,i.textContent=`${Math.ceil(e)}/${t}`}}updateShield(e,t){const s=this.elements.shieldFill,i=this.elements.shieldText;if(s&&i){const n=e/t*100;s.style.width=`${n}%`,i.textContent=`${Math.ceil(e)}/${t}`}}updateScore(e){const t=this.elements.scoreText;t&&(t.textContent=e.toLocaleString())}updateWave(e){const t=this.elements.waveText;t&&(t.textContent=`${e}`)}updateCoins(e){const t=this.elements.coinsText;t&&(t.textContent=e.toLocaleString())}updateUpgradeDisplay(e){const t=this.elements.weaponLevel;t&&(t.textContent=e.weapon.toString());const s=this.elements.shieldLevel;s&&(s.textContent=e.shield.toString());const i=this.elements.hpLevel;i&&(i.textContent=e.hp.toString());const n=this.elements.speedLevel;n&&(n.textContent=e.speed.toString());const o={weapon:100,shield:150,hp:200,speed:120};Object.keys(o).forEach(a=>{const h=Math.floor(o[a]*Math.pow(1.5,e[a]-1)),l=this.elements[`${a}Cost`];l&&(l.textContent=h.toString())})}showMainMenu(){this.hideAllOverlays();const e=this.elements.menuOverlay;e&&e.classList.remove("hidden")}showGame(){this.hideAllOverlays()}showShop(){this.hideAllOverlays();const e=this.elements.shopOverlay;e&&e.classList.remove("hidden")}async showLeaderboard(e){this.hideAllOverlays();const t=this.elements.leaderboardOverlay;t&&t.classList.remove("hidden"),this.showLeaderboardLoading();try{const s=e?await e:[];this.populateLeaderboard(s)}catch(s){console.error("Failed to load leaderboard:",s),this.showLeaderboardError()}}showControls(){this.hideAllOverlays();const e=this.elements.controlsOverlay;e&&e.classList.remove("hidden")}showGameOver(e,t,s){this.hideAllOverlays();const i=this.elements.gameOverOverlay;i&&i.classList.remove("hidden");const n=this.elements.finalScore;n&&(n.textContent=e.toLocaleString());const o=this.elements.finalWave;o&&(o.textContent=t.toString());const a=this.elements.finalCoins;a&&(a.textContent=s.toLocaleString());const h=this.elements.playerName;if(h){const l=h;l.value="",l.focus()}}showPause(){this.hideAllOverlays();const e=this.elements.pauseOverlay;e&&e.classList.remove("hidden")}hideAllOverlays(){document.querySelectorAll(".menu-overlay").forEach(e=>{e.classList.add("hidden")})}showLeaderboardLoading(){const e=this.elements.leaderboardList;e&&(e.innerHTML='<p style="text-align: center; color: #666;">Loading leaderboard...</p>')}showLeaderboardError(){const e=this.elements.leaderboardList;e&&(e.innerHTML='<p style="text-align: center; color: #ff6666;">Failed to load leaderboard. Please try again.</p>')}populateLeaderboard(e){const t=this.elements.leaderboardList;if(t){if(!Array.isArray(e)){console.error("populateLeaderboard received non-array data:",e),this.showLeaderboardError();return}if(t.innerHTML="",e.length===0){t.innerHTML='<p style="text-align: center; color: #666;">No scores yet!</p>';return}e.forEach((s,i)=>{const n=document.createElement("div");n.className=`leaderboard-entry ${i<3?"top-3":""}`,n.innerHTML=`
        <span class="leaderboard-rank">#${i+1}</span>
        <span class="leaderboard-name">${s.name}</span>
        <span class="leaderboard-score">${s.score.toLocaleString()}</span>
        <span class="leaderboard-wave">Wave ${s.wave}</span>
      `,t.appendChild(n)})}}}const Wt="modulepreload",Ht=function(r,e){return new URL(r,e).href},Ye={},de=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),a=document.querySelector("meta[property=csp-nonce]"),h=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));i=Promise.allSettled(t.map(l=>{if(l=Ht(l,s),l in Ye)return;Ye[l]=!0;const c=l.endsWith(".css"),u=c?'[rel="stylesheet"]':"";if(!!s)for(let v=o.length-1;v>=0;v--){const _=o[v];if(_.href===l&&(!c||_.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${l}"]${u}`))return;const g=document.createElement("link");if(g.rel=c?"stylesheet":Wt,c||(g.as="script"),g.crossOrigin="",g.href=l,h&&g.setAttribute("nonce",h),document.head.appendChild(g),c)return new Promise((v,_)=>{g.addEventListener("load",v),g.addEventListener("error",()=>_(new Error(`Unable to preload CSS for ${l}`)))})}))}function n(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return i.then(o=>{for(const a of o||[])a.status==="rejected"&&n(a.reason);return e().catch(n)})},Vt=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>de(async()=>{const{default:s}=await Promise.resolve().then(()=>ie);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class We extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class zt extends We{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class Kt extends We{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class Jt extends We{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var Le;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(Le||(Le={}));var Yt=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};class Xt{constructor(e,{headers:t={},customFetch:s,region:i=Le.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Vt(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Yt(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:o}=t;let a={},{region:h}=t;h||(h=this.region),h&&h!=="any"&&(a["x-region"]=h);let l;o&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&o instanceof Blob||o instanceof ArrayBuffer?(a["Content-Type"]="application/octet-stream",l=o):typeof o=="string"?(a["Content-Type"]="text/plain",l=o):typeof FormData<"u"&&o instanceof FormData?l=o:(a["Content-Type"]="application/json",l=JSON.stringify(o)));const c=yield this.fetch(`${this.url}/${e}`,{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},a),this.headers),i),body:l}).catch(v=>{throw new zt(v)}),u=c.headers.get("x-relay-error");if(u&&u==="true")throw new Kt(c);if(!c.ok)throw new Jt(c);let f=((s=c.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),g;return f==="application/json"?g=yield c.json():f==="application/octet-stream"?g=yield c.blob():f==="text/event-stream"?g=c:f==="multipart/form-data"?g=yield c.formData():g=yield c.text(),{data:g,error:null}}catch(i){return{data:null,error:i}}})}}var $=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Qt(r){if(r.__esModule)return r;var e=r.default;if(typeof e=="function"){var t=function s(){return this instanceof s?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var i=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return r[s]}})}),t}var R={},He={},Se={},fe={},ke={},Ee={},Zt=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},se=Zt();const es=se.fetch,ft=se.fetch.bind(se),pt=se.Headers,ts=se.Request,ss=se.Response,ie=Object.freeze(Object.defineProperty({__proto__:null,Headers:pt,Request:ts,Response:ss,default:ft,fetch:es},Symbol.toStringTag,{value:"Module"})),is=Qt(ie);var Te={};Object.defineProperty(Te,"__esModule",{value:!0});let rs=class extends Error{constructor(e){super(e.message),this.name="PostgrestError",this.details=e.details,this.hint=e.hint,this.code=e.code}};Te.default=rs;var gt=$&&$.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Ee,"__esModule",{value:!0});const ns=gt(is),os=gt(Te);let as=class{constructor(e){this.shouldThrowOnError=!1,this.method=e.method,this.url=e.url,this.headers=e.headers,this.schema=e.schema,this.body=e.body,this.shouldThrowOnError=e.shouldThrowOnError,this.signal=e.signal,this.isMaybeSingle=e.isMaybeSingle,e.fetch?this.fetch=e.fetch:typeof fetch>"u"?this.fetch=ns.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(e,t){return this.headers=Object.assign({},this.headers),this.headers[e]=t,this}then(e,t){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const s=this.fetch;let i=s(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async n=>{var o,a,h;let l=null,c=null,u=null,f=n.status,g=n.statusText;if(n.ok){if(this.method!=="HEAD"){const p=await n.text();p===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?c=p:c=JSON.parse(p))}const _=(o=this.headers.Prefer)===null||o===void 0?void 0:o.match(/count=(exact|planned|estimated)/),w=(a=n.headers.get("content-range"))===null||a===void 0?void 0:a.split("/");_&&w&&w.length>1&&(u=parseInt(w[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(c)&&(c.length>1?(l={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,u=null,f=406,g="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{const _=await n.text();try{l=JSON.parse(_),Array.isArray(l)&&n.status===404&&(c=[],l=null,f=200,g="OK")}catch{n.status===404&&_===""?(f=204,g="No Content"):l={message:_}}if(l&&this.isMaybeSingle&&(!((h=l==null?void 0:l.details)===null||h===void 0)&&h.includes("0 rows"))&&(l=null,f=200,g="OK"),l&&this.shouldThrowOnError)throw new os.default(l)}return{error:l,data:c,count:u,status:f,statusText:g}});return this.shouldThrowOnError||(i=i.catch(n=>{var o,a,h;return{error:{message:`${(o=n==null?void 0:n.name)!==null&&o!==void 0?o:"FetchError"}: ${n==null?void 0:n.message}`,details:`${(a=n==null?void 0:n.stack)!==null&&a!==void 0?a:""}`,hint:"",code:`${(h=n==null?void 0:n.code)!==null&&h!==void 0?h:""}`},data:null,count:null,status:0,statusText:""}})),i.then(e,t)}returns(){return this}overrideTypes(){return this}};Ee.default=as;var hs=$&&$.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ke,"__esModule",{value:!0});const ls=hs(Ee);let cs=class extends ls.default{select(e){let t=!1;const s=(e??"*").split("").map(i=>/\s/.test(i)&&!t?"":(i==='"'&&(t=!t),i)).join("");return this.url.searchParams.set("select",s),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(e,{ascending:t=!0,nullsFirst:s,foreignTable:i,referencedTable:n=i}={}){const o=n?`${n}.order`:"order",a=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${a?`${a},`:""}${e}.${t?"asc":"desc"}${s===void 0?"":s?".nullsfirst":".nullslast"}`),this}limit(e,{foreignTable:t,referencedTable:s=t}={}){const i=typeof s>"u"?"limit":`${s}.limit`;return this.url.searchParams.set(i,`${e}`),this}range(e,t,{foreignTable:s,referencedTable:i=s}={}){const n=typeof i>"u"?"offset":`${i}.offset`,o=typeof i>"u"?"limit":`${i}.limit`;return this.url.searchParams.set(n,`${e}`),this.url.searchParams.set(o,`${t-e+1}`),this}abortSignal(e){return this.signal=e,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:e=!1,verbose:t=!1,settings:s=!1,buffers:i=!1,wal:n=!1,format:o="text"}={}){var a;const h=[e?"analyze":null,t?"verbose":null,s?"settings":null,i?"buffers":null,n?"wal":null].filter(Boolean).join("|"),l=(a=this.headers.Accept)!==null&&a!==void 0?a:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${o}; for="${l}"; options=${h};`,o==="json"?this:this}rollback(){var e;return((e=this.headers.Prefer)!==null&&e!==void 0?e:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}};ke.default=cs;var us=$&&$.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(fe,"__esModule",{value:!0});const ds=us(ke);let fs=class extends ds.default{eq(e,t){return this.url.searchParams.append(e,`eq.${t}`),this}neq(e,t){return this.url.searchParams.append(e,`neq.${t}`),this}gt(e,t){return this.url.searchParams.append(e,`gt.${t}`),this}gte(e,t){return this.url.searchParams.append(e,`gte.${t}`),this}lt(e,t){return this.url.searchParams.append(e,`lt.${t}`),this}lte(e,t){return this.url.searchParams.append(e,`lte.${t}`),this}like(e,t){return this.url.searchParams.append(e,`like.${t}`),this}likeAllOf(e,t){return this.url.searchParams.append(e,`like(all).{${t.join(",")}}`),this}likeAnyOf(e,t){return this.url.searchParams.append(e,`like(any).{${t.join(",")}}`),this}ilike(e,t){return this.url.searchParams.append(e,`ilike.${t}`),this}ilikeAllOf(e,t){return this.url.searchParams.append(e,`ilike(all).{${t.join(",")}}`),this}ilikeAnyOf(e,t){return this.url.searchParams.append(e,`ilike(any).{${t.join(",")}}`),this}is(e,t){return this.url.searchParams.append(e,`is.${t}`),this}in(e,t){const s=Array.from(new Set(t)).map(i=>typeof i=="string"&&new RegExp("[,()]").test(i)?`"${i}"`:`${i}`).join(",");return this.url.searchParams.append(e,`in.(${s})`),this}contains(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cs.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cs.{${t.join(",")}}`):this.url.searchParams.append(e,`cs.${JSON.stringify(t)}`),this}containedBy(e,t){return typeof t=="string"?this.url.searchParams.append(e,`cd.${t}`):Array.isArray(t)?this.url.searchParams.append(e,`cd.{${t.join(",")}}`):this.url.searchParams.append(e,`cd.${JSON.stringify(t)}`),this}rangeGt(e,t){return this.url.searchParams.append(e,`sr.${t}`),this}rangeGte(e,t){return this.url.searchParams.append(e,`nxl.${t}`),this}rangeLt(e,t){return this.url.searchParams.append(e,`sl.${t}`),this}rangeLte(e,t){return this.url.searchParams.append(e,`nxr.${t}`),this}rangeAdjacent(e,t){return this.url.searchParams.append(e,`adj.${t}`),this}overlaps(e,t){return typeof t=="string"?this.url.searchParams.append(e,`ov.${t}`):this.url.searchParams.append(e,`ov.{${t.join(",")}}`),this}textSearch(e,t,{config:s,type:i}={}){let n="";i==="plain"?n="pl":i==="phrase"?n="ph":i==="websearch"&&(n="w");const o=s===void 0?"":`(${s})`;return this.url.searchParams.append(e,`${n}fts${o}.${t}`),this}match(e){return Object.entries(e).forEach(([t,s])=>{this.url.searchParams.append(t,`eq.${s}`)}),this}not(e,t,s){return this.url.searchParams.append(e,`not.${t}.${s}`),this}or(e,{foreignTable:t,referencedTable:s=t}={}){const i=s?`${s}.or`:"or";return this.url.searchParams.append(i,`(${e})`),this}filter(e,t,s){return this.url.searchParams.append(e,`${t}.${s}`),this}};fe.default=fs;var ps=$&&$.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(Se,"__esModule",{value:!0});const ne=ps(fe);let gs=class{constructor(e,{headers:t={},schema:s,fetch:i}){this.url=e,this.headers=t,this.schema=s,this.fetch=i}select(e,{head:t=!1,count:s}={}){const i=t?"HEAD":"GET";let n=!1;const o=(e??"*").split("").map(a=>/\s/.test(a)&&!n?"":(a==='"'&&(n=!n),a)).join("");return this.url.searchParams.set("select",o),s&&(this.headers.Prefer=`count=${s}`),new ne.default({method:i,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(e,{count:t,defaultToNull:s=!0}={}){const i="POST",n=[];if(this.headers.Prefer&&n.push(this.headers.Prefer),t&&n.push(`count=${t}`),s||n.push("missing=default"),this.headers.Prefer=n.join(","),Array.isArray(e)){const o=e.reduce((a,h)=>a.concat(Object.keys(h)),[]);if(o.length>0){const a=[...new Set(o)].map(h=>`"${h}"`);this.url.searchParams.set("columns",a.join(","))}}return new ne.default({method:i,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}upsert(e,{onConflict:t,ignoreDuplicates:s=!1,count:i,defaultToNull:n=!0}={}){const o="POST",a=[`resolution=${s?"ignore":"merge"}-duplicates`];if(t!==void 0&&this.url.searchParams.set("on_conflict",t),this.headers.Prefer&&a.push(this.headers.Prefer),i&&a.push(`count=${i}`),n||a.push("missing=default"),this.headers.Prefer=a.join(","),Array.isArray(e)){const h=e.reduce((l,c)=>l.concat(Object.keys(c)),[]);if(h.length>0){const l=[...new Set(h)].map(c=>`"${c}"`);this.url.searchParams.set("columns",l.join(","))}}return new ne.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}update(e,{count:t}={}){const s="PATCH",i=[];return this.headers.Prefer&&i.push(this.headers.Prefer),t&&i.push(`count=${t}`),this.headers.Prefer=i.join(","),new ne.default({method:s,url:this.url,headers:this.headers,schema:this.schema,body:e,fetch:this.fetch,allowEmpty:!1})}delete({count:e}={}){const t="DELETE",s=[];return e&&s.push(`count=${e}`),this.headers.Prefer&&s.unshift(this.headers.Prefer),this.headers.Prefer=s.join(","),new ne.default({method:t,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}};Se.default=gs;var Pe={},xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.version=void 0;xe.version="0.0.0-automated";Object.defineProperty(Pe,"__esModule",{value:!0});Pe.DEFAULT_HEADERS=void 0;const ms=xe;Pe.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${ms.version}`};var mt=$&&$.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(He,"__esModule",{value:!0});const ys=mt(Se),vs=mt(fe),ws=Pe;let bs=class yt{constructor(e,{headers:t={},schema:s,fetch:i}={}){this.url=e,this.headers=Object.assign(Object.assign({},ws.DEFAULT_HEADERS),t),this.schemaName=s,this.fetch=i}from(e){const t=new URL(`${this.url}/${e}`);return new ys.default(t,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(e){return new yt(this.url,{headers:this.headers,schema:e,fetch:this.fetch})}rpc(e,t={},{head:s=!1,get:i=!1,count:n}={}){let o;const a=new URL(`${this.url}/rpc/${e}`);let h;s||i?(o=s?"HEAD":"GET",Object.entries(t).filter(([c,u])=>u!==void 0).map(([c,u])=>[c,Array.isArray(u)?`{${u.join(",")}}`:`${u}`]).forEach(([c,u])=>{a.searchParams.append(c,u)})):(o="POST",h=t);const l=Object.assign({},this.headers);return n&&(l.Prefer=`count=${n}`),new vs.default({method:o,url:a,headers:l,schema:this.schemaName,body:h,fetch:this.fetch,allowEmpty:!1})}};He.default=bs;var re=$&&$.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(R,"__esModule",{value:!0});R.PostgrestError=R.PostgrestBuilder=R.PostgrestTransformBuilder=R.PostgrestFilterBuilder=R.PostgrestQueryBuilder=R.PostgrestClient=void 0;const vt=re(He);R.PostgrestClient=vt.default;const wt=re(Se);R.PostgrestQueryBuilder=wt.default;const bt=re(fe);R.PostgrestFilterBuilder=bt.default;const _t=re(ke);R.PostgrestTransformBuilder=_t.default;const St=re(Ee);R.PostgrestBuilder=St.default;const kt=re(Te);R.PostgrestError=kt.default;var _s=R.default={PostgrestClient:vt.default,PostgrestQueryBuilder:wt.default,PostgrestFilterBuilder:bt.default,PostgrestTransformBuilder:_t.default,PostgrestBuilder:St.default,PostgrestError:kt.default};const{PostgrestClient:Ss,PostgrestQueryBuilder:vr,PostgrestFilterBuilder:wr,PostgrestTransformBuilder:br,PostgrestBuilder:_r,PostgrestError:Sr}=_s;let $e;typeof window>"u"?$e=require("ws"):$e=window.WebSocket;const ks=$e,Es="2.11.10",Ts={"X-Client-Info":`realtime-js/${Es}`},Ps="1.0.0",Et=1e4,xs=1e3;var te;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(te||(te={}));var j;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(j||(j={}));var B;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(B||(B={}));var Ue;(function(r){r.websocket="websocket"})(Ue||(Ue={}));var K;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(K||(K={}));class As{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let o=this.HEADER_LENGTH+2;const a=s.decode(e.slice(o,o+i));o=o+i;const h=s.decode(e.slice(o,o+n));o=o+n;const l=JSON.parse(s.decode(e.slice(o,e.byteLength)));return{ref:null,topic:a,event:h,payload:l}}}class Tt{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var x;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(x||(x={}));const Xe=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,o)=>(n[o]=Os(o,r,e,i),n),{})},Os=(r,e,t,s)=>{const i=e.find(a=>a.name===r),n=i==null?void 0:i.type,o=t[r];return n&&!s.includes(n)?Pt(n,o):De(o)},Pt=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Rs(e,t)}switch(r){case x.bool:return Cs(e);case x.float4:case x.float8:case x.int2:case x.int4:case x.int8:case x.numeric:case x.oid:return js(e);case x.json:case x.jsonb:return Is(e);case x.timestamp:return Ms(e);case x.abstime:case x.date:case x.daterange:case x.int4range:case x.int8range:case x.money:case x.reltime:case x.text:case x.time:case x.timestamptz:case x.timetz:case x.tsrange:case x.tstzrange:return De(e);default:return De(e)}},De=r=>r,Cs=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},js=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Is=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Rs=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const o=r.slice(1,t);try{n=JSON.parse("["+o+"]")}catch{n=o?o.split(","):[]}return n.map(a=>Pt(e,a))}return r},Ms=r=>typeof r=="string"?r.replace(" ","T"):r,xt=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class Oe{constructor(e,t,s={},i=Et){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Qe;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Qe||(Qe={}));class he{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.joinRef=this.channel._joinRef(),this.state=he.syncState(this.state,i,n,o),this.pendingDiffs.forEach(h=>{this.state=he.syncDiff(this.state,h,n,o)}),this.pendingDiffs=[],a()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:o,onSync:a}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=he.syncDiff(this.state,i,n,o),a())}),this.onJoin((i,n,o)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:o})}),this.onLeave((i,n,o)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:o})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),o=this.transformState(t),a={},h={};return this.map(n,(l,c)=>{o[l]||(h[l]=c)}),this.map(o,(l,c)=>{const u=n[l];if(u){const f=c.map(w=>w.presence_ref),g=u.map(w=>w.presence_ref),v=c.filter(w=>g.indexOf(w.presence_ref)<0),_=u.filter(w=>f.indexOf(w.presence_ref)<0);v.length>0&&(a[l]=v),_.length>0&&(h[l]=_)}else a[l]=c}),this.syncDiff(n,{joins:a,leaves:h},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:o}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(a,h)=>{var l;const c=(l=e[a])!==null&&l!==void 0?l:[];if(e[a]=this.cloneDeep(h),c.length>0){const u=e[a].map(g=>g.presence_ref),f=c.filter(g=>u.indexOf(g.presence_ref)<0);e[a].unshift(...f)}s(a,c,h)}),this.map(o,(a,h)=>{let l=e[a];if(!l)return;const c=h.map(u=>u.presence_ref);l=l.filter(u=>c.indexOf(u.presence_ref)<0),e[a]=l,i(a,l,h),l.length===0&&delete e[a]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var Ze;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(Ze||(Ze={}));var et;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(et||(et={}));var F;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(F||(F={}));class Ve{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=j.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Oe(this,B.join,this.params,this.timeout),this.rejoinTimer=new Tt(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=j.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=j.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=j.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=j.errored,this.rejoinTimer.scheduleTimeout())}),this._on(B.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new he(this),this.broadcastEndpointURL=xt(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.joinedOnce)throw"tried to subscribe multiple times. 'subscribe' can only be called a single time per channel instance";{const{config:{broadcast:n,presence:o,private:a}}=this.params;this._onError(c=>e==null?void 0:e(F.CHANNEL_ERROR,c)),this._onClose(()=>e==null?void 0:e(F.CLOSED));const h={},l={broadcast:n,presence:o,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(c=>c.filter))!==null&&i!==void 0?i:[],private:a};this.socket.accessTokenValue&&(h.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:l},h)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:c})=>{var u;if(this.socket.setAuth(),c===void 0){e==null||e(F.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,g=(u=f==null?void 0:f.length)!==null&&u!==void 0?u:0,v=[];for(let _=0;_<g;_++){const w=f[_],{filter:{event:p,schema:m,table:y,filter:E}}=w,T=c&&c[_];if(T&&T.event===p&&T.schema===m&&T.table===y&&T.filter===E)v.push(Object.assign(Object.assign({},w),{id:T.id}));else{this.unsubscribe(),this.state=j.errored,e==null||e(F.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=v,e&&e(F.SUBSCRIBED);return}}).receive("error",c=>{this.state=j.errored,e==null||e(F.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(c).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(F.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:o}=e,h={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:o,private:this.private}]})};try{const l=await this._fetchWithTimeout(this.broadcastEndpointURL,h,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=l.body)===null||i===void 0?void 0:i.cancel()),l.ok?"ok":"error"}catch(l){return l.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var o,a,h;const l=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((h=(a=(o=this.params)===null||o===void 0?void 0:o.config)===null||a===void 0?void 0:a.broadcast)===null||h===void 0)&&h.ack)&&n("ok"),l.receive("ok",()=>n("ok")),l.receive("error",()=>n("error")),l.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=j.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(B.close,"leave",this._joinRef())};return this.joinPush.destroy(),new Promise(s=>{const i=new Oe(this,B.leave,{},e);i.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),i.send(),this._canPush()||i.trigger("ok",{})})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),o=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),o}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new Oe(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const o=e.toLocaleLowerCase(),{close:a,error:h,leave:l,join:c}=B;if(s&&[a,h,l,c].indexOf(o)>=0&&s!==this._joinRef())return;let f=this._onMessage(o,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(o)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(g=>{var v,_,w;return((v=g.filter)===null||v===void 0?void 0:v.event)==="*"||((w=(_=g.filter)===null||_===void 0?void 0:_.event)===null||w===void 0?void 0:w.toLocaleLowerCase())===o}).map(g=>g.callback(f,s)):(n=this.bindings[o])===null||n===void 0||n.filter(g=>{var v,_,w,p,m,y;if(["broadcast","presence","postgres_changes"].includes(o))if("id"in g){const E=g.id,T=(v=g.filter)===null||v===void 0?void 0:v.event;return E&&((_=t.ids)===null||_===void 0?void 0:_.includes(E))&&(T==="*"||(T==null?void 0:T.toLocaleLowerCase())===((w=t.data)===null||w===void 0?void 0:w.type.toLocaleLowerCase()))}else{const E=(m=(p=g==null?void 0:g.filter)===null||p===void 0?void 0:p.event)===null||m===void 0?void 0:m.toLocaleLowerCase();return E==="*"||E===((y=t==null?void 0:t.event)===null||y===void 0?void 0:y.toLocaleLowerCase())}else return g.type.toLocaleLowerCase()===o}).map(g=>{if(typeof f=="object"&&"ids"in f){const v=f.data,{schema:_,table:w,commit_timestamp:p,type:m,errors:y}=v;f=Object.assign(Object.assign({},{schema:_,table:w,commit_timestamp:p,eventType:m,new:{},old:{},errors:y}),this._getPayloadRecords(v))}g.callback(f,s)})}_isClosed(){return this.state===j.closed}_isJoined(){return this.state===j.joined}_isJoining(){return this.state===j.joining}_isLeaving(){return this.state===j.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&Ve.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(B.close,{},e)}_onError(e){this._on(B.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=j.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Xe(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Xe(e.columns,e.old_record)),t}}const tt=()=>{},Ls=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class $s{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers=Ts,this.params={},this.timeout=Et,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=tt,this.ref=0,this.logger=tt,this.conn=null,this.sendBuffer=[],this.serializer=new As,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let o;return n?o=n:typeof fetch>"u"?o=(...a)=>de(async()=>{const{default:h}=await Promise.resolve().then(()=>ie);return{default:h}},void 0,import.meta.url).then(({default:h})=>h(...a)):o=fetch,(...a)=>o(...a)},this.endPoint=`${e}/${Ue.websocket}`,this.httpEndpoint=xt(e),t!=null&&t.transport?this.transport=t.transport:this.transport=null,t!=null&&t.params&&(this.params=t.params),t!=null&&t.headers&&(this.headers=Object.assign(Object.assign({},this.headers),t.headers)),t!=null&&t.timeout&&(this.timeout=t.timeout),t!=null&&t.logger&&(this.logger=t.logger),(t!=null&&t.logLevel||t!=null&&t.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t!=null&&t.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t==null?void 0:t.params)===null||s===void 0?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t!=null&&t.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t!=null&&t.encode?t.encode:(n,o)=>o(JSON.stringify(n)),this.decode=t!=null&&t.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new Tt(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t==null?void 0:t.fetch),t!=null&&t.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=(t==null?void 0:t.worker)||!1,this.workerUrl=t==null?void 0:t.workerUrl}this.accessToken=(t==null?void 0:t.accessToken)||null}connect(){if(!this.conn){if(this.transport||(this.transport=ks),this.transport){typeof window<"u"&&this.transport===window.WebSocket?this.conn=new this.transport(this.endpointURL()):this.conn=new this.transport(this.endpointURL(),void 0,{headers:this.headers}),this.setupConnection();return}this.conn=new Us(this.endpointURL(),void 0,{close:()=>{this.conn=null}})}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Ps}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels=this.channels.filter(s=>s._joinRef!==e._joinRef),this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case te.connecting:return K.Connecting;case te.open:return K.Open;case te.closing:return K.Closing;default:return K.Closed}}isConnected(){return this.connectionState()===K.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===s);if(i)return i;{const n=new Ve(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:s,payload:i,ref:n}=e,o=()=>{this.encode(e,a=>{var h;(h=this.conn)===null||h===void 0||h.send(a)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?o():this.sendBuffer.push(o)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{t&&s.updateJoinPayload({access_token:t,version:this.headers&&this.headers["X-Client-Info"]}),s.joinedOnce&&s._isJoined()&&s._push(B.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(xs,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:n,ref:o}=t;s==="phoenix"&&i==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),o&&o===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${i} ${o&&"("+o+")"||""}`,n),Array.from(this.channels).filter(a=>a._isMember(s)).forEach(a=>a._trigger(i,n,o)),this.stateChangeCallbacks.message.forEach(a=>a(t))})}_onConnOpen(){if(this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),!this.worker)this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs);else{this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}this.stateChangeCallbacks.open.forEach(e=>e())}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",e.message),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(B.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([Ls],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Us{constructor(e,t,s){this.binaryType="arraybuffer",this.onclose=()=>{},this.onerror=()=>{},this.onmessage=()=>{},this.onopen=()=>{},this.readyState=te.connecting,this.send=()=>{},this.url=null,this.url=e,this.close=s.close}}class ze extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function O(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class Ds extends ze{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class Be extends ze{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var Bs=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};const At=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>de(async()=>{const{default:s}=await Promise.resolve().then(()=>ie);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Ns=()=>Bs(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield de(()=>Promise.resolve().then(()=>ie),void 0,import.meta.url)).Response:Response}),Ne=r=>{if(Array.isArray(r))return r.map(t=>Ne(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=Ne(s)}),e};var J=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};const Ce=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Fs=(r,e,t)=>J(void 0,void 0,void 0,function*(){const s=yield Ns();r instanceof s&&!(t!=null&&t.noResolveJson)?r.json().then(i=>{e(new Ds(Ce(i),r.status||500))}).catch(i=>{e(new Be(Ce(i),i))}):e(new Be(Ce(r),r))}),Gs=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e==null?void 0:e.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),t))};function pe(r,e,t,s,i,n){return J(this,void 0,void 0,function*(){return new Promise((o,a)=>{r(t,Gs(e,s,i,n)).then(h=>{if(!h.ok)throw h;return s!=null&&s.noResolveJson?h:h.json()}).then(h=>o(h)).catch(h=>Fs(h,a,s))})})}function be(r,e,t,s){return J(this,void 0,void 0,function*(){return pe(r,"GET",e,t,s)})}function q(r,e,t,s,i){return J(this,void 0,void 0,function*(){return pe(r,"POST",e,s,i,t)})}function qs(r,e,t,s,i){return J(this,void 0,void 0,function*(){return pe(r,"PUT",e,s,i,t)})}function Ws(r,e,t,s){return J(this,void 0,void 0,function*(){return pe(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Ot(r,e,t,s,i){return J(this,void 0,void 0,function*(){return pe(r,"DELETE",e,s,i,t)})}var I=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};const Hs={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},st={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class Vs{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=At(i)}uploadOrUpdate(e,t,s,i){return I(this,void 0,void 0,function*(){try{let n;const o=Object.assign(Object.assign({},st),i);let a=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(o.upsert)});const h=o.metadata;typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",o.cacheControl),h&&n.append("metadata",this.encodeMetadata(h)),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",o.cacheControl),h&&n.append("metadata",this.encodeMetadata(h))):(n=s,a["cache-control"]=`max-age=${o.cacheControl}`,a["content-type"]=o.contentType,h&&(a["x-metadata"]=this.toBase64(this.encodeMetadata(h)))),i!=null&&i.headers&&(a=Object.assign(Object.assign({},a),i.headers));const l=this._removeEmptyFolders(t),c=this._getFinalPath(l),u=yield this.fetch(`${this.url}/object/${c}`,Object.assign({method:e,body:n,headers:a},o!=null&&o.duplex?{duplex:o.duplex}:{})),f=yield u.json();return u.ok?{data:{path:l,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(n){if(O(n))return{data:null,error:n};throw n}})}upload(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return I(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),o=this._getFinalPath(n),a=new URL(this.url+`/object/upload/sign/${o}`);a.searchParams.set("token",t);try{let h;const l=Object.assign({upsert:st.upsert},i),c=Object.assign(Object.assign({},this.headers),{"x-upsert":String(l.upsert)});typeof Blob<"u"&&s instanceof Blob?(h=new FormData,h.append("cacheControl",l.cacheControl),h.append("",s)):typeof FormData<"u"&&s instanceof FormData?(h=s,h.append("cacheControl",l.cacheControl)):(h=s,c["cache-control"]=`max-age=${l.cacheControl}`,c["content-type"]=l.contentType);const u=yield this.fetch(a.toString(),{method:"PUT",body:h,headers:c}),f=yield u.json();return u.ok?{data:{path:n,fullPath:f.Key},error:null}:{data:null,error:f}}catch(h){if(O(h))return{data:null,error:h};throw h}})}createSignedUploadUrl(e,t){return I(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t!=null&&t.upsert&&(i["x-upsert"]="true");const n=yield q(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),o=new URL(this.url+n.url),a=o.searchParams.get("token");if(!a)throw new ze("No token returned by API");return{data:{signedUrl:o.toString(),path:e,token:a},error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}update(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:yield q(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers}),error:null}}catch(i){if(O(i))return{data:null,error:i};throw i}})}copy(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:{path:(yield q(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s==null?void 0:s.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if(O(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return I(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield q(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s!=null&&s.transform?{transform:s.transform}:{}),{headers:this.headers});const o=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${o}`)},{data:n,error:null}}catch(i){if(O(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return I(this,void 0,void 0,function*(){try{const i=yield q(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s!=null&&s.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(o=>Object.assign(Object.assign({},o),{signedUrl:o.signedURL?encodeURI(`${this.url}${o.signedURL}${n}`):null})),error:null}}catch(i){if(O(i))return{data:null,error:i};throw i}})}download(e,t){return I(this,void 0,void 0,function*(){const i=typeof(t==null?void 0:t.transform)<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString((t==null?void 0:t.transform)||{}),o=n?`?${n}`:"";try{const a=this._getFinalPath(e);return{data:yield(yield be(this.fetch,`${this.url}/${i}/${a}${o}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(a){if(O(a))return{data:null,error:a};throw a}})}info(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield be(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:Ne(s),error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}exists(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield Ws(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if(O(s)&&s instanceof Be){const i=s.originalError;if([400,404].includes(i==null?void 0:i.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t!=null&&t.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const a=typeof(t==null?void 0:t.transform)<"u"?"render/image":"object",h=this.transformOptsToQueryString((t==null?void 0:t.transform)||{});h!==""&&i.push(h);let l=i.join("&");return l!==""&&(l=`?${l}`),{data:{publicUrl:encodeURI(`${this.url}/${a}/public/${s}${l}`)}}}remove(e){return I(this,void 0,void 0,function*(){try{return{data:yield Ot(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}list(e,t,s){return I(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},Hs),t),{prefix:e||""});return{data:yield q(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if(O(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const zs="2.7.1",Ks={"X-Client-Info":`storage-js/${zs}`};var Y=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};class Js{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},Ks),t),this.fetch=At(s)}listBuckets(){return Y(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if(O(e))return{data:null,error:e};throw e}})}getBucket(e){return Y(this,void 0,void 0,function*(){try{return{data:yield be(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return Y(this,void 0,void 0,function*(){try{return{data:yield q(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return Y(this,void 0,void 0,function*(){try{return{data:yield qs(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if(O(s))return{data:null,error:s};throw s}})}emptyBucket(e){return Y(this,void 0,void 0,function*(){try{return{data:yield q(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}deleteBucket(e){return Y(this,void 0,void 0,function*(){try{return{data:yield Ot(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if(O(t))return{data:null,error:t};throw t}})}}class Ys extends Js{constructor(e,t={},s){super(e,t,s)}from(e){return new Vs(this.url,this.headers,e,this.fetch)}}const Xs="2.50.0";let oe="";typeof Deno<"u"?oe="deno":typeof document<"u"?oe="web":typeof navigator<"u"&&navigator.product==="ReactNative"?oe="react-native":oe="node";const Qs={"X-Client-Info":`supabase-js-${oe}/${Xs}`},Zs={headers:Qs},ei={schema:"public"},ti={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},si={};var ii=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};const ri=r=>{let e;return r?e=r:typeof fetch>"u"?e=ft:e=fetch,(...t)=>e(...t)},ni=()=>typeof Headers>"u"?pt:Headers,oi=(r,e,t)=>{const s=ri(t),i=ni();return(n,o)=>ii(void 0,void 0,void 0,function*(){var a;const h=(a=yield e())!==null&&a!==void 0?a:r;let l=new i(o==null?void 0:o.headers);return l.has("apikey")||l.set("apikey",r),l.has("Authorization")||l.set("Authorization",`Bearer ${h}`),s(n,Object.assign(Object.assign({},o),{headers:l}))})};var ai=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};function hi(r){return r.endsWith("/")?r:r+"/"}function li(r,e){var t,s;const{db:i,auth:n,realtime:o,global:a}=r,{db:h,auth:l,realtime:c,global:u}=e,f={db:Object.assign(Object.assign({},h),i),auth:Object.assign(Object.assign({},l),n),realtime:Object.assign(Object.assign({},c),o),global:Object.assign(Object.assign(Object.assign({},u),a),{headers:Object.assign(Object.assign({},(t=u==null?void 0:u.headers)!==null&&t!==void 0?t:{}),(s=a==null?void 0:a.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>ai(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}const Ct="2.70.0",ee=30*1e3,Fe=3,je=Fe*ee,ci="http://localhost:9999",ui="supabase.auth.token",di={"X-Client-Info":`gotrue-js/${Ct}`},Ge="X-Supabase-Api-Version",jt={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},fi=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,pi=6e5;class Ke extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function b(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class gi extends Ke{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function mi(r){return b(r)&&r.name==="AuthApiError"}class It extends Ke{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class H extends Ke{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class G extends H{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function yi(r){return b(r)&&r.name==="AuthSessionMissingError"}class ge extends H{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class me extends H{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class ye extends H{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function vi(r){return b(r)&&r.name==="AuthImplicitGrantRedirectError"}class it extends H{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class qe extends H{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function Ie(r){return b(r)&&r.name==="AuthRetryableFetchError"}class rt extends H{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class le extends H{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const _e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),nt=` 	
\r=`.split(""),wi=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<nt.length;e+=1)r[nt[e].charCodeAt(0)]=-2;for(let e=0;e<_e.length;e+=1)r[_e[e].charCodeAt(0)]=e;return r})();function ot(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(_e[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(_e[s]),e.queuedBits-=6}}function Rt(r,e,t){const s=wi[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function at(r){const e=[],t=o=>{e.push(String.fromCodePoint(o))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=o=>{Si(o,s,t)};for(let o=0;o<r.length;o+=1)Rt(r.charCodeAt(o),i,n);return e.join("")}function bi(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function _i(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}bi(s,e)}}function Si(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if(!(r>>7-s&1)){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function ki(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)Rt(r.charCodeAt(i),t,s);return new Uint8Array(e)}function Ei(r){const e=[];return _i(r,t=>e.push(t)),new Uint8Array(e)}function Ti(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return r.forEach(i=>ot(i,t,s)),ot(null,t,s),e.join("")}function Pi(r){return Math.round(Date.now()/1e3)+r}function xi(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const U=()=>typeof window<"u"&&typeof document<"u",V={tested:!1,writable:!1},ce=()=>{if(!U())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(V.tested)return V.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),V.tested=!0,V.writable=!0}catch{V.tested=!0,V.writable=!1}return V.writable};function Ai(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const Mt=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>de(async()=>{const{default:s}=await Promise.resolve().then(()=>ie);return{default:s}},void 0,import.meta.url).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Oi=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",Lt=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},ve=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},we=async(r,e)=>{await r.removeItem(e)};class Ae{constructor(){this.promise=new Ae.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}Ae.promiseConstructor=Promise;function Re(r){const e=r.split(".");if(e.length!==3)throw new le("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!fi.test(e[s]))throw new le("JWT not in base64url format");return{header:JSON.parse(at(e[0])),payload:JSON.parse(at(e[1])),signature:ki(e[2]),raw:{header:e[0],payload:e[1]}}}async function Ci(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function ji(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const o=await r(n);if(!e(n,null,o)){s(o);return}}catch(o){if(!e(n,o)){i(o);return}}})()})}function Ii(r){return("0"+r.toString(16)).substr(-2)}function Ri(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,Ii).join("")}async function Mi(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function Li(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Mi(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function X(r,e,t=!1){const s=Ri();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await Lt(r,`${e}-code-verifier`,i);const n=await Li(s);return[n,s===n?"plain":"s256"]}const $i=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function Ui(r){const e=r.headers.get(Ge);if(!e||!e.match($i))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function Di(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function Bi(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const Ni=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Q(r){if(!Ni.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}var Fi=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};const z=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),Gi=[502,503,504];async function ht(r){var e;if(!Oi(r))throw new qe(z(r),0);if(Gi.includes(r.status))throw new qe(z(r),r.status);let t;try{t=await r.json()}catch(n){throw new It(z(n),n)}let s;const i=Ui(r);if(i&&i.getTime()>=jt["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new rt(z(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new G}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,o)=>n&&typeof o=="string",!0))throw new rt(z(t),r.status,t.weak_password.reasons);throw new gi(z(t),r.status||500,s)}const qi=(r,e,t,s)=>{const i={method:r,headers:(e==null?void 0:e.headers)||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function k(r,e,t,s){var i;const n=Object.assign({},s==null?void 0:s.headers);n[Ge]||(n[Ge]=jt["2024-01-01"].name),s!=null&&s.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const o=(i=s==null?void 0:s.query)!==null&&i!==void 0?i:{};s!=null&&s.redirectTo&&(o.redirect_to=s.redirectTo);const a=Object.keys(o).length?"?"+new URLSearchParams(o).toString():"",h=await Wi(r,e,t+a,{headers:n,noResolveJson:s==null?void 0:s.noResolveJson},{},s==null?void 0:s.body);return s!=null&&s.xform?s==null?void 0:s.xform(h):{data:Object.assign({},h),error:null}}async function Wi(r,e,t,s,i,n){const o=qi(e,s,i,n);let a;try{a=await r(t,Object.assign({},o))}catch(h){throw console.error(h),new qe(z(h),0)}if(a.ok||await ht(a),s!=null&&s.noResolveJson)return a;try{return await a.json()}catch(h){await ht(h)}}function N(r){var e;let t=null;Ki(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Pi(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function lt(r){const e=N(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function W(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function Hi(r){return{data:r,error:null}}function Vi(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,o=Fi(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),a={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},h=Object.assign({},o);return{data:{properties:a,user:h},error:null}}function zi(r){return r}function Ki(r){return r.access_token&&r.refresh_token&&r.expires_in}const Me=["global","local","others"];var Ji=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};class Yi{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=Mt(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=Me[0]){if(Me.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Me.join(", ")}`);try{return await k(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:W})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=Ji(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s==null?void 0:s.newEmail,delete i.newEmail),await k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:Vi,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(b(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:W})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,o,a,h;try{const l={nextPage:null,lastPage:0,total:0},c=await k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e==null?void 0:e.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:zi});if(c.error)throw c.error;const u=await c.json(),f=(o=c.headers.get("x-total-count"))!==null&&o!==void 0?o:0,g=(h=(a=c.headers.get("link"))===null||a===void 0?void 0:a.split(","))!==null&&h!==void 0?h:[];return g.length>0&&(g.forEach(v=>{const _=parseInt(v.split(";")[0].split("=")[1].substring(0,1)),w=JSON.parse(v.split(";")[1].split("=")[1]);l[`${w}Page`]=_}),l.total=parseInt(f)),{data:Object.assign(Object.assign({},u),l),error:null}}catch(l){if(b(l))return{data:{users:[]},error:l};throw l}}async getUserById(e){Q(e);try{return await k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:W})}catch(t){if(b(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Q(e);try{return await k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:W})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){Q(e);try{return await k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:W})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){Q(e.userId);try{const{data:t,error:s}=await k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(b(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Q(e.userId),Q(e.id);try{return{data:await k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}}const Xi={getItem:r=>ce()?globalThis.localStorage.getItem(r):null,setItem:(r,e)=>{ce()&&globalThis.localStorage.setItem(r,e)},removeItem:r=>{ce()&&globalThis.localStorage.removeItem(r)}};function ct(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function Qi(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const Z={debug:!!(globalThis&&ce()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class $t extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class Zi extends $t{}async function er(r,e,t){Z.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),Z.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){Z.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{Z.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw Z.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new Zi(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(Z.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}Qi();const tr={url:ci,storageKey:ui,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:di,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function ut(r,e,t){return await t()}class ue{constructor(e){var t,s;this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=ue.nextInstanceID,ue.nextInstanceID+=1,this.instanceID>0&&U()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},tr),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new Yi({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=Mt(i.fetch),this.lock=i.lock||ut,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:U()&&(!((t=globalThis==null?void 0:globalThis.navigator)===null||t===void 0)&&t.locks)?this.lock=er:this.lock=ut,this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER,this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?i.storage?this.storage=i.storage:ce()?this.storage=Xi:(this.memoryStorage={},this.storage=ct(this.memoryStorage)):(this.memoryStorage={},this.storage=ct(this.memoryStorage)),U()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Ct}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Ai(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),U()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),vi(n)){const h=(e=n.details)===null||e===void 0?void 0:e.code;if(h==="identity_already_exists"||h==="identity_not_found"||h==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:o,redirectType:a}=i;return this._debug("#_initialize()","detected session in URL",o,"redirect type",a),await this._saveSession(o),setTimeout(async()=>{a==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",o):await this._notifyAllSubscribers("SIGNED_IN",o)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return b(t)?{error:t}:{error:new It("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e==null?void 0:e.options)===null||i===void 0?void 0:i.captchaToken}},xform:N}),{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const h=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:l,session:h},error:null}}catch(n){if(b(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,i;try{let n;if("email"in e){const{email:c,password:u,options:f}=e;let g=null,v=null;this.flowType==="pkce"&&([g,v]=await X(this.storage,this.storageKey)),n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f==null?void 0:f.emailRedirectTo,body:{email:c,password:u,data:(t=f==null?void 0:f.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken},code_challenge:g,code_challenge_method:v},xform:N})}else if("phone"in e){const{phone:c,password:u,options:f}=e;n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:c,password:u,data:(s=f==null?void 0:f.data)!==null&&s!==void 0?s:{},channel:(i=f==null?void 0:f.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f==null?void 0:f.captchaToken}},xform:N})}else throw new me("You must provide either an email or phone number and a password");const{data:o,error:a}=n;if(a||!o)return{data:{user:null,session:null},error:a};const h=o.session,l=o.user;return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",h)),{data:{user:l,session:h},error:null}}catch(n){if(b(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:o,options:a}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:lt})}else if("phone"in e){const{phone:n,password:o,options:a}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:o,gotrue_meta_security:{captcha_token:a==null?void 0:a.captchaToken}},xform:lt})}else throw new me("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new ge}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,n,o,a,h,l,c,u,f,g;let v,_;if("message"in e)v=e.message,_=e.signature;else{const{chain:w,wallet:p,statement:m,options:y}=e;let E;if(U())if(typeof p=="object")E=p;else{const P=window;if("solana"in P&&typeof P.solana=="object"&&("signIn"in P.solana&&typeof P.solana.signIn=="function"||"signMessage"in P.solana&&typeof P.solana.signMessage=="function"))E=P.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof p!="object"||!(y!=null&&y.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");E=p}const T=new URL((t=y==null?void 0:y.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in E&&E.signIn){const P=await E.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},y==null?void 0:y.signInWithSolana),{version:"1",domain:T.host,uri:T.href}),m?{statement:m}:null));let M;if(Array.isArray(P)&&P[0]&&typeof P[0]=="object")M=P[0];else if(P&&typeof P=="object"&&"signedMessage"in P&&"signature"in P)M=P;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in M&&"signature"in M&&(typeof M.signedMessage=="string"||M.signedMessage instanceof Uint8Array)&&M.signature instanceof Uint8Array)v=typeof M.signedMessage=="string"?M.signedMessage:new TextDecoder().decode(M.signedMessage),_=M.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in E)||typeof E.signMessage!="function"||!("publicKey"in E)||typeof E!="object"||!E.publicKey||!("toBase58"in E.publicKey)||typeof E.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");v=[`${T.host} wants you to sign in with your Solana account:`,E.publicKey.toBase58(),...m?["",m,""]:[""],"Version: 1",`URI: ${T.href}`,`Issued At: ${(i=(s=y==null?void 0:y.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=y==null?void 0:y.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${y.signInWithSolana.notBefore}`]:[],...!((o=y==null?void 0:y.signInWithSolana)===null||o===void 0)&&o.expirationTime?[`Expiration Time: ${y.signInWithSolana.expirationTime}`]:[],...!((a=y==null?void 0:y.signInWithSolana)===null||a===void 0)&&a.chainId?[`Chain ID: ${y.signInWithSolana.chainId}`]:[],...!((h=y==null?void 0:y.signInWithSolana)===null||h===void 0)&&h.nonce?[`Nonce: ${y.signInWithSolana.nonce}`]:[],...!((l=y==null?void 0:y.signInWithSolana)===null||l===void 0)&&l.requestId?[`Request ID: ${y.signInWithSolana.requestId}`]:[],...!((u=(c=y==null?void 0:y.signInWithSolana)===null||c===void 0?void 0:c.resources)===null||u===void 0)&&u.length?["Resources",...y.signInWithSolana.resources.map(M=>`- ${M}`)]:[]].join(`
`);const P=await E.signMessage(new TextEncoder().encode(v),"utf8");if(!P||!(P instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");_=P}}try{const{data:w,error:p}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:v,signature:Ti(_)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(g=e.options)===null||g===void 0?void 0:g.captchaToken}}:null),xform:N});if(p)throw p;return!w||!w.session||!w.user?{data:{user:null,session:null},error:new ge}:(w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),{data:Object.assign({},w),error:p})}catch(w){if(b(w))return{data:{user:null,session:null},error:w};throw w}}async _exchangeCodeForSession(e){const t=await ve(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:n,error:o}=await k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:N});if(await we(this.storage,`${this.storageKey}-code-verifier`),o)throw o;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new ge}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:o})}catch(n){if(b(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:n,nonce:o}=e,a=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:o,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:N}),{data:h,error:l}=a;return l?{data:{user:null,session:null},error:l}:!h||!h.session||!h.user?{data:{user:null,session:null},error:new ge}:(h.session&&(await this._saveSession(h.session),await this._notifyAllSubscribers("SIGNED_IN",h.session)),{data:h,error:l})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,n,o;try{if("email"in e){const{email:a,options:h}=e;let l=null,c=null;this.flowType==="pkce"&&([l,c]=await X(this.storage,this.storageKey));const{error:u}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:a,data:(t=h==null?void 0:h.data)!==null&&t!==void 0?t:{},create_user:(s=h==null?void 0:h.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},code_challenge:l,code_challenge_method:c},redirectTo:h==null?void 0:h.emailRedirectTo});return{data:{user:null,session:null},error:u}}if("phone"in e){const{phone:a,options:h}=e,{data:l,error:c}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:a,data:(i=h==null?void 0:h.data)!==null&&i!==void 0?i:{},create_user:(n=h==null?void 0:h.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:h==null?void 0:h.captchaToken},channel:(o=h==null?void 0:h.channel)!==null&&o!==void 0?o:"sms"}});return{data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:c}}throw new me("You must provide either an email or phone number.")}catch(a){if(b(a))return{data:{user:null,session:null},error:a};throw a}}async verifyOtp(e){var t,s;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:o,error:a}=await k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:N});if(a)throw a;if(!o)throw new Error("An error occurred on token verification.");const h=o.session,l=o.user;return h!=null&&h.access_token&&(await this._saveSession(h),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",h)),{data:{user:l,session:h},error:null}}catch(i){if(b(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let n=null,o=null;return this.flowType==="pkce"&&([n,o]=await X(this.storage,this.storageKey)),await k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e==null?void 0:e.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:o}),headers:this.headers,xform:Hi})}catch(n){if(b(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new G;const{error:i}=await k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(b(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:o}=await k(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}},redirectTo:n==null?void 0:n.emailRedirectTo});return{data:{user:null,session:null},error:o}}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:o,error:a}=await k(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n==null?void 0:n.captchaToken}}});return{data:{user:null,session:null,messageId:o==null?void 0:o.message_id},error:a}}throw new me("You must provide either an email or phone number and a type")}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await ve(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<je:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.storage.isServer){let o=this.suppressGetSessionWarning;e=new Proxy(e,{get:(h,l,c)=>(!o&&l==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),o=!0,this.suppressGetSessionWarning=!0),Reflect.get(h,l,c))})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:W}):await this._useSession(async t=>{var s,i,n;const{data:o,error:a}=t;if(a)throw a;return!(!((s=o.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new G}:await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=o.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:W})})}catch(t){if(b(t))return yi(t)&&(await this._removeSession(),await we(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new G;const o=i.session;let a=null,h=null;this.flowType==="pkce"&&e.email!=null&&([a,h]=await X(this.storage,this.storageKey));const{data:l,error:c}=await k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:a,code_challenge_method:h}),jwt:o.access_token,xform:W});if(c)throw c;return o.user=l.user,await this._saveSession(o),await this._notifyAllSubscribers("USER_UPDATED",o),{data:{user:o.user},error:null}})}catch(s){if(b(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new G;const t=Date.now()/1e3;let s=t,i=!0,n=null;const{payload:o}=Re(e.access_token);if(o.exp&&(s=o.exp,i=s<=t),i){const{session:a,error:h}=await this._callRefreshToken(e.refresh_token);if(h)return{data:{user:null,session:null},error:h};if(!a)return{data:{user:null,session:null},error:null};n=a}else{const{data:a,error:h}=await this._getUser(e.access_token);if(h)throw h;n={access_token:e.access_token,refresh_token:e.refresh_token,user:a.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(b(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:o,error:a}=t;if(a)throw a;e=(s=o.session)!==null&&s!==void 0?s:void 0}if(!(e!=null&&e.refresh_token))throw new G;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(b(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!U())throw new ye("No browser detected.");if(e.error||e.error_description||e.error_code)throw new ye(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new it("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new ye("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new it("No code detected.");const{data:m,error:y}=await this._exchangeCodeForSession(e.code);if(y)throw y;const E=new URL(window.location.href);return E.searchParams.delete("code"),window.history.replaceState(window.history.state,"",E.toString()),{data:{session:m.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:o,expires_in:a,expires_at:h,token_type:l}=e;if(!n||!a||!o||!l)throw new ye("No session defined in URL");const c=Math.round(Date.now()/1e3),u=parseInt(a);let f=c+u;h&&(f=parseInt(h));const g=f-c;g*1e3<=ee&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${g}s, should have been closer to ${u}s`);const v=f-u;c-v>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",v,f,c):c-v<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",v,f,c);const{data:_,error:w}=await this._getUser(n);if(w)throw w;const p={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:u,expires_at:f,refresh_token:o,token_type:l,user:_.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:p,redirectType:e.type},error:null}}catch(s){if(b(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await ve(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{error:n};const o=(s=i.session)===null||s===void 0?void 0:s.access_token;if(o){const{error:a}=await this.admin.signOut(o,e);if(a&&!(mi(a)&&(a.status===404||a.status===401||a.status===403)))return{error:a}}return e!=="others"&&(await this._removeSession(),await we(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=xi(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:o}=t;if(o)throw o;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await X(this.storage,this.storageKey,!0));try{return await k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(b(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(b(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var o,a,h,l,c;const{data:u,error:f}=n;if(f)throw f;const g=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(o=e.options)===null||o===void 0?void 0:o.redirectTo,scopes:(a=e.options)===null||a===void 0?void 0:a.scopes,queryParams:(h=e.options)===null||h===void 0?void 0:h.queryParams,skipBrowserRedirect:!0});return await k(this.fetch,"GET",g,{headers:this.headers,jwt:(c=(l=u.session)===null||l===void 0?void 0:l.access_token)!==null&&c!==void 0?c:void 0})});if(i)throw i;return U()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s==null?void 0:s.url),{data:{provider:e.provider,url:s==null?void 0:s.url},error:null}}catch(s){if(b(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:o}=t;if(o)throw o;return await k(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await ji(async i=>(i>0&&await Ci(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:N})),(i,n)=>{const o=200*Math.pow(2,i);return n&&Ie(n)&&Date.now()+o-s<ee})}catch(s){if(this._debug(t,"error",s),b(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),U()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e;const t="#_recoverAndRefresh()";this._debug(t,"begin");try{const s=await ve(this.storage,this.storageKey);if(this._debug(t,"session from storage",s),!this._isValidSession(s)){this._debug(t,"session is not valid"),s!==null&&await this._removeSession();return}const i=((e=s.expires_at)!==null&&e!==void 0?e:1/0)*1e3-Date.now()<je;if(this._debug(t,`session has${i?"":" not"} expired with margin of ${je}s`),i){if(this.autoRefreshToken&&s.refresh_token){const{error:n}=await this._callRefreshToken(s.refresh_token);n&&(console.error(n),Ie(n)||(this._debug(t,"refresh failed with a non-retryable error, removing the session",n),await this._removeSession()))}}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(t,"error",s),console.error(s);return}finally{this._debug(t,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new G;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new Ae;const{data:n,error:o}=await this._refreshAccessToken(e);if(o)throw o;if(!n.session)throw new G;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const a={session:n.session,error:null};return this.refreshingDeferred.resolve(a),a}catch(n){if(this._debug(i,"error",n),b(n)){const o={session:null,error:n};return Ie(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(o),o}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],o=Array.from(this.stateChangeEmitters.values()).map(async a=>{try{await a.callback(e,t)}catch(h){n.push(h)}});if(await Promise.all(o),n.length>0){for(let a=0;a<n.length;a+=1)console.error(n[a]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await Lt(this.storage,this.storageKey,e)}async _removeSession(){this._debug("#_removeSession()"),await we(this.storage,this.storageKey),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&U()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),ee);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/ee);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${ee}ms, refresh threshold is ${Fe} ticks`),i<=Fe&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof $t)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!U()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s!=null&&s.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s!=null&&s.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,o]=await X(this.storage,this.storageKey),a=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(o)}`});i.push(a.toString())}if(s!=null&&s.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s!=null&&s.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:o}=t;if(o)return{data:null,error:o};const a=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:h,error:l}=await k(this.fetch,"POST",`${this.url}/factors`,{body:a,headers:this.headers,jwt:(s=n==null?void 0:n.session)===null||s===void 0?void 0:s.access_token});return l?{data:null,error:l}:(e.factorType==="totp"&&(!((i=h==null?void 0:h.totp)===null||i===void 0)&&i.qr_code)&&(h.totp.qr_code=`data:image/svg+xml;utf-8,${h.totp.qr_code}`),{data:h,error:null})})}catch(t){if(b(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:o,error:a}=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token});return a?{data:null,error:a}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),{data:o,error:a})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i==null?void 0:i.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(b(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=(e==null?void 0:e.factors)||[],i=s.filter(o=>o.factor_type==="totp"&&o.status==="verified"),n=s.filter(o=>o.factor_type==="phone"&&o.status==="verified");return{data:{all:s,totp:i,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:o}=Re(i.access_token);let a=null;o.aal&&(a=o.aal);let h=a;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(u=>u.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(h="aal2");const c=o.amr||[];return{data:{currentLevel:a,nextLevel:h,currentAuthenticationMethods:c},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s||(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+pi>Date.now()))return s;const{data:i,error:n}=await k(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(n)throw n;if(!i.keys||i.keys.length===0)throw new le("JWKS is empty");if(this.jwks=i,this.jwks_cached_at=Date.now(),s=i.keys.find(o=>o.kid===e),!s)throw new le("No matching signing key found in JWKS");return s}async getClaims(e,t={keys:[]}){try{let s=e;if(!s){const{data:g,error:v}=await this.getSession();if(v||!g.session)return{data:null,error:v};s=g.session.access_token}const{header:i,payload:n,signature:o,raw:{header:a,payload:h}}=Re(s);if(Di(n.exp),!i.kid||i.alg==="HS256"||!("crypto"in globalThis&&"subtle"in globalThis.crypto)){const{error:g}=await this.getUser(s);if(g)throw g;return{data:{claims:n,header:i,signature:o},error:null}}const l=Bi(i.alg),c=await this.fetchJwk(i.kid,t),u=await crypto.subtle.importKey("jwk",c,l,!0,["verify"]);if(!await crypto.subtle.verify(l,u,o,Ei(`${a}.${h}`)))throw new le("Invalid JWT signature");return{data:{claims:n,header:i,signature:o},error:null}}catch(s){if(b(s))return{data:null,error:s};throw s}}}ue.nextInstanceID=0;const sr=ue;class ir extends sr{constructor(e){super(e)}}var rr=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(o){o(n)})}return new(t||(t=Promise))(function(n,o){function a(c){try{l(s.next(c))}catch(u){o(u)}}function h(c){try{l(s.throw(c))}catch(u){o(u)}}function l(c){c.done?n(c.value):i(c.value).then(a,h)}l((s=s.apply(r,e||[])).next())})};class nr{constructor(e,t,s){var i,n,o;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const a=hi(e),h=new URL(a);this.realtimeUrl=new URL("realtime/v1",h),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",h),this.storageUrl=new URL("storage/v1",h),this.functionsUrl=new URL("functions/v1",h);const l=`sb-${h.hostname.split(".")[0]}-auth-token`,c={db:ei,realtime:si,auth:Object.assign(Object.assign({},ti),{storageKey:l}),global:Zs},u=li(s??{},c);this.storageKey=(i=u.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=u.global.headers)!==null&&n!==void 0?n:{},u.accessToken?(this.accessToken=u.accessToken,this.auth=new Proxy({},{get:(f,g)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(g)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((o=u.auth)!==null&&o!==void 0?o:{},this.headers,u.global.fetch),this.fetch=oi(t,this._getAccessToken.bind(this),u.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},u.realtime)),this.rest=new Ss(new URL("rest/v1",h).href,{headers:this.headers,schema:u.db.schema,fetch:this.fetch}),u.accessToken||this._listenForAuthEvents()}get functions(){return new Xt(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new Ys(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return rr(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:n,flowType:o,lock:a,debug:h},l,c){const u={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ir({url:this.authUrl.href,headers:Object.assign(Object.assign({},u),l),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:o,lock:a,debug:h,fetch:c,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new $s(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e==null?void 0:e.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s==null?void 0:s.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const or=(r,e,t)=>new nr(r,e,t),ar="https://inakluyaljmvavpjrqss.supabase.co",hr="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImluYWtsdXlhbGptdmF2cGpycXNzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDkzOTQ5ODksImV4cCI6MjA2NDk3MDk4OX0.5IvV1mMkLs15ykyxEDIOfGMn3cTG4Vn7BytxKklGqQQ",dt=or(ar,hr);class lr{constructor(){d(this,"SAVE_KEY","spaceBattle2_save")}saveGameData(e){try{localStorage.setItem(this.SAVE_KEY,JSON.stringify(e))}catch(t){console.error("Failed to save game data:",t)}}loadGameData(){try{const e=localStorage.getItem(this.SAVE_KEY);if(e)return JSON.parse(e)}catch(e){console.error("Failed to load game data:",e)}return{coins:0,upgrades:{weapon:1,shield:1,hp:1,speed:1}}}async addScore(e,t,s){try{const{error:i}=await dt.from("leaderboard").insert({player_name:e,score:t,wave:s});if(i)throw i}catch(i){throw console.error("Failed to add score to leaderboard:",i),i}}async getLeaderboard(){try{const{data:e,error:t}=await dt.from("leaderboard").select("player_name, score, wave, created_at").order("score",{ascending:!1}).order("wave",{ascending:!1}).limit(10);if(t)throw t;return(e||[]).map(s=>({name:s.player_name,score:s.score,wave:s.wave,date:s.created_at}))}catch(e){throw console.error("Failed to fetch leaderboard:",e),e}}}class cr{constructor(){d(this,"audioContext",null);d(this,"enabled",!0);this.initializeAudio()}initializeAudio(){try{this.audioContext=new(window.AudioContext||window.webkitAudioContext)}catch(e){console.warn("Web Audio API not supported:",e),this.enabled=!1}}playShoot(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(800,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(400,this.audioContext.currentTime+.1),t.gain.setValueAtTime(.1,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.1),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.1)}playExplosion(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(200,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(50,this.audioContext.currentTime+.3),t.gain.setValueAtTime(.2,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.3),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.3)}playPowerUp(){if(!this.enabled||!this.audioContext)return;const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.connect(t),t.connect(this.audioContext.destination),e.frequency.setValueAtTime(400,this.audioContext.currentTime),e.frequency.exponentialRampToValueAtTime(800,this.audioContext.currentTime+.2),t.gain.setValueAtTime(.1,this.audioContext.currentTime),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.2),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.2)}setEnabled(e){this.enabled=e}}var S=(r=>(r.MENU="menu",r.PLAYING="playing",r.PAUSED="paused",r.GAME_OVER="game_over",r.SHOP="shop",r.LEADERBOARD="leaderboard",r.CONTROLS="controls",r))(S||{});class ur{constructor(e){d(this,"canvas");d(this,"ctx");d(this,"gameState",S.MENU);d(this,"previousGameState",S.MENU);d(this,"lastTime",0);d(this,"player");d(this,"enemies",[]);d(this,"boss",null);d(this,"projectiles",[]);d(this,"powerUps",[]);d(this,"particles");d(this,"inputManager");d(this,"uiManager");d(this,"storageManager");d(this,"soundManager");d(this,"stats",{score:0,wave:1,coins:0,enemiesKilled:0,gameTime:0});d(this,"waveTimer",0);d(this,"waveDelay",3e3);d(this,"enemiesInWave",5);d(this,"enemiesSpawned",0);d(this,"waveComplete",!1);d(this,"isBossWave",!1);d(this,"powerUpTimer",0);d(this,"powerUpSpawnRate",15e3);this.canvas=e,this.ctx=e.getContext("2d"),this.resizeCanvas(),window.addEventListener("resize",()=>this.resizeCanvas()),this.inputManager=new Gt(e),this.uiManager=new qt,this.storageManager=new lr,this.soundManager=new cr,this.player=new Nt(e.width/2,e.height-100),this.particles=new Je,this.loadGameData(),this.setupEventListeners()}resizeCanvas(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.player&&(this.player.position.x=Math.min(this.player.position.x,this.canvas.width-this.player.width),this.player.position.y=Math.min(this.player.position.y,this.canvas.height-this.player.height))}setupEventListeners(){this.uiManager.onStartGame(()=>this.startNewGame()),this.uiManager.onPauseAndShowShop(()=>this.pauseAndShowShop()),this.uiManager.onShowShop(()=>this.showShop()),this.uiManager.onResumeFromShop(()=>this.resumeFromShop()),this.uiManager.onShowLeaderboard(()=>this.showLeaderboard()),this.uiManager.onResumeFromLeaderboard(()=>this.resumeFromLeaderboard()),this.uiManager.onShowControls(()=>this.showControls()),this.uiManager.onResumeFromControls(()=>this.resumeFromControls()),this.uiManager.onPauseGame(()=>this.pauseGame()),this.uiManager.onResumeGame(()=>this.resumeGame()),this.uiManager.onRestartGame(()=>this.startNewGame()),this.uiManager.onMainMenu(()=>this.showMainMenu()),this.uiManager.onSubmitScore(e=>this.submitScore(e)),this.uiManager.onPurchaseUpgrade(e=>this.purchaseUpgrade(e)),document.addEventListener("keydown",e=>{e.code==="Escape"?this.gameState===S.PLAYING?this.pauseGame():this.gameState===S.PAUSED?this.resumeGame():this.gameState===S.SHOP&&this.previousGameState===S.PLAYING?this.resumeFromShop():this.gameState===S.LEADERBOARD&&this.previousGameState===S.PLAYING?this.resumeFromLeaderboard():this.gameState===S.CONTROLS&&this.previousGameState===S.PLAYING&&this.resumeFromControls():e.code==="KeyP"&&this.gameState===S.PLAYING&&this.pauseGame()})}loadGameData(){const e=this.storageManager.loadGameData();this.stats.coins=e.coins,this.player.applyUpgrades(e.upgrades),this.uiManager.updateUpgradeDisplay(e.upgrades),this.uiManager.updateCoins(this.stats.coins)}saveGameData(){this.storageManager.saveGameData({coins:this.stats.coins,upgrades:this.player.getUpgrades()})}start(){this.gameLoop(0)}gameLoop(e){const t=e-this.lastTime;this.lastTime=e,this.update(t),this.render(),requestAnimationFrame(s=>this.gameLoop(s))}update(e){if(this.gameState===S.PLAYING){if(this.stats.gameTime+=e,this.inputManager.update(),this.player.update(e,this.inputManager,this.canvas),this.inputManager.isShooting()||this.inputManager.isMobile()){const t=this.player.shoot();t&&(this.projectiles.push(t),this.soundManager.playShoot())}this.updateProjectiles(e),this.updateEnemies(e),this.updateBoss(e),this.updatePowerUps(e),this.particles.update(e),this.checkCollisions(),this.updateWaveLogic(e),this.updatePowerUpSpawning(e),this.updateUI(),this.player.hp<=0&&this.gameOver()}}updateProjectiles(e){for(let t=this.projectiles.length-1;t>=0;t--){const s=this.projectiles[t];s.update(e),(s.position.y<-50||s.position.y>this.canvas.height+50||s.position.x<-50||s.position.x>this.canvas.width+50)&&this.projectiles.splice(t,1)}}updateEnemies(e){for(let t=this.enemies.length-1;t>=0;t--){const s=this.enemies[t];s.update(e,this.player.position,this.canvas);const i=s.shoot();i.length>0&&this.projectiles.push(...i),s.position.y>this.canvas.height+100&&this.enemies.splice(t,1)}}updateBoss(e){if(!this.boss)return;this.boss.update(e,this.player.position,this.canvas);const t=this.boss.shoot();if(t.length>0&&this.projectiles.push(...t),this.boss.isDefeated){this.stats.enemiesKilled++,this.stats.score+=this.boss.scoreValue,this.stats.coins+=this.boss.coinValue,this.particles.createExplosion(this.boss.position.x+this.boss.width/2,this.boss.position.y+this.boss.height/2,"#ffaa00",30),this.soundManager.playExplosion();for(let s=0;s<3;s++)this.spawnPowerUp(this.boss.position.x+Math.random()*this.boss.width,this.boss.position.y+Math.random()*this.boss.height);this.boss=null,this.isBossWave=!1,this.waveComplete=!0,this.waveTimer=0}}updatePowerUps(e){for(let t=this.powerUps.length-1;t>=0;t--){const s=this.powerUps[t];s.update(e),(s.position.y>this.canvas.height+50||s.isExpired())&&this.powerUps.splice(t,1)}}checkCollisions(){for(let e=this.projectiles.length-1;e>=0;e--){const t=this.projectiles[e];if(t.isPlayerProjectile){for(let s=this.enemies.length-1;s>=0;s--){const i=this.enemies[s];if(this.checkCollision(t,i)){i.takeDamage(t.damage),this.projectiles.splice(e,1),this.particles.createExplosion(i.position.x,i.position.y,"#ff4444",5),i.hp<=0&&(this.enemies.splice(s,1),this.stats.enemiesKilled++,this.stats.score+=i.scoreValue,this.stats.coins+=i.coinValue,this.particles.createExplosion(i.position.x,i.position.y,"#ffaa00",15),this.soundManager.playExplosion(),Math.random()<.15&&this.spawnPowerUp(i.position.x,i.position.y));break}}this.boss&&this.checkCollision(t,this.boss)&&(this.boss.takeDamage(t.damage),this.projectiles.splice(e,1),this.particles.createExplosion(t.position.x,t.position.y,"#ff4444",8))}}for(let e=this.projectiles.length-1;e>=0;e--){const t=this.projectiles[e];t.isPlayerProjectile||this.checkCollision(t,this.player)&&(this.player.takeDamage(t.damage),this.projectiles.splice(e,1),this.particles.createExplosion(this.player.position.x,this.player.position.y,"#4444ff",8))}for(let e=this.enemies.length-1;e>=0;e--){const t=this.enemies[e];this.checkCollision(t,this.player)&&(this.player.takeDamage(t.damage),t.takeDamage(this.player.ramDamage),this.particles.createExplosion((t.position.x+this.player.position.x)/2,(t.position.y+this.player.position.y)/2,"#ffffff",10),t.hp<=0&&(this.enemies.splice(e,1),this.stats.enemiesKilled++,this.stats.score+=t.scoreValue,this.stats.coins+=t.coinValue,this.soundManager.playExplosion()))}this.boss&&this.checkCollision(this.boss,this.player)&&(this.player.takeDamage(this.boss.damage),this.particles.createExplosion(this.player.position.x,this.player.position.y,"#ffffff",15));for(let e=this.powerUps.length-1;e>=0;e--){const t=this.powerUps[e];this.checkCollision(t,this.player)&&(this.player.applyPowerUp(t),this.powerUps.splice(e,1),this.particles.createExplosion(t.position.x,t.position.y,t.color,8),this.soundManager.playPowerUp())}}checkCollision(e,t){return e.position.x<t.position.x+t.width&&e.position.x+e.width>t.position.x&&e.position.y<t.position.y+t.height&&e.position.y+e.height>t.position.y}updateWaveLogic(e){this.enemies.length===0&&(!this.isBossWave||!this.boss)&&this.enemiesSpawned>=this.enemiesInWave?(this.waveComplete||(this.waveComplete=!0,this.waveTimer=0,this.stats.score+=this.stats.wave*100,this.stats.coins+=this.stats.wave*10),this.waveTimer+=e,this.waveTimer>=this.waveDelay&&this.startNextWave()):!this.isBossWave&&this.enemiesSpawned<this.enemiesInWave&&this.enemies.length<3&&(this.spawnEnemy(),this.enemiesSpawned++)}startNextWave(){this.stats.wave++,this.waveComplete=!1,this.waveTimer=0,this.isBossWave=this.stats.wave%5===0,this.isBossWave?(this.spawnBoss(),this.enemiesInWave=0,this.enemiesSpawned=0):(this.enemiesInWave=Math.min(5+Math.floor(this.stats.wave/2),15),this.enemiesSpawned=0),this.stats.wave%5===0&&ae.increaseDifficulty()}spawnEnemy(){const e=Math.random()*(this.canvas.width-60),t=-60,s=new ae(e,t,this.stats.wave);this.enemies.push(s)}spawnBoss(){const e=this.canvas.width/2-100,t=-120;this.boss=new Ft(e,t,this.stats.wave)}updatePowerUpSpawning(e){if(this.powerUpTimer+=e,this.powerUpTimer>=this.powerUpSpawnRate){this.powerUpTimer=0;const t=Math.random()*(this.canvas.width-40);this.spawnPowerUp(t,-40)}}spawnPowerUp(e,t){const s=new Bt(e,t);this.powerUps.push(s)}updateUI(){this.uiManager.updateHP(this.player.hp,this.player.maxHp),this.uiManager.updateShield(this.player.shield,this.player.maxShield),this.uiManager.updateScore(this.stats.score),this.uiManager.updateWave(this.stats.wave),this.uiManager.updateCoins(this.stats.coins)}render(){const e=this.ctx.createLinearGradient(0,0,0,this.canvas.height);e.addColorStop(0,"#000428"),e.addColorStop(1,"#004e92"),this.ctx.fillStyle=e,this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.drawStars(),(this.gameState===S.PLAYING||this.gameState===S.PAUSED)&&(this.player.render(this.ctx),this.enemies.forEach(t=>t.render(this.ctx)),this.boss&&this.boss.render(this.ctx),this.projectiles.forEach(t=>t.render(this.ctx)),this.powerUps.forEach(t=>t.render(this.ctx)),this.particles.render(this.ctx),this.waveComplete&&this.waveTimer<2e3&&this.drawWaveTransition(),this.isBossWave&&this.boss&&this.waveTimer<3e3&&this.drawBossWarning())}drawStars(){this.ctx.fillStyle="#ffffff";for(let e=0;e<100;e++){const t=e*137.5%this.canvas.width,s=e*73.3%this.canvas.height,i=Math.sin(e+this.stats.gameTime*.001)*.5+1;this.ctx.globalAlpha=Math.sin(e+this.stats.gameTime*.002)*.3+.7,this.ctx.fillRect(t,s,i,i)}this.ctx.globalAlpha=1}drawWaveTransition(){this.ctx.save(),this.ctx.fillStyle="rgba(0, 0, 0, 0.7)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ffff00",this.ctx.font="bold 48px Orbitron",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const e=this.isBossWave?`BOSS WAVE ${this.stats.wave}!`:`WAVE ${this.stats.wave} COMPLETE!`;this.ctx.fillText(e,this.canvas.width/2,this.canvas.height/2-30),this.ctx.font="bold 24px Orbitron",this.ctx.fillStyle="#00ffff";const t=`Next wave in ${Math.ceil((this.waveDelay-this.waveTimer)/1e3)}...`;this.ctx.fillText(t,this.canvas.width/2,this.canvas.height/2+30),this.ctx.restore()}drawBossWarning(){this.ctx.save(),this.ctx.fillStyle="rgba(255, 0, 0, 0.3)",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle="#ff0000",this.ctx.font="bold 64px Orbitron",this.ctx.textAlign="center",this.ctx.textBaseline="middle";const e=Math.sin(this.stats.gameTime*.01)*.5+.5;this.ctx.globalAlpha=e,this.ctx.fillText("WARNING",this.canvas.width/2,this.canvas.height/2-50),this.ctx.font="bold 32px Orbitron",this.ctx.fillStyle="#ffff00",this.ctx.fillText("BOSS APPROACHING",this.canvas.width/2,this.canvas.height/2+20),this.ctx.restore()}startNewGame(){this.gameState=S.PLAYING,this.previousGameState=S.MENU,this.stats={score:0,wave:1,coins:this.stats.coins,enemiesKilled:0,gameTime:0},this.player.reset(this.canvas.width/2,this.canvas.height-100),this.enemies=[],this.boss=null,this.projectiles=[],this.powerUps=[],this.particles=new Je,this.enemiesInWave=5,this.enemiesSpawned=0,this.waveComplete=!1,this.isBossWave=!1,this.waveTimer=0,this.powerUpTimer=0,ae.resetDifficulty(),this.uiManager.showGame()}pauseGame(){this.gameState===S.PLAYING&&(this.previousGameState=this.gameState,this.gameState=S.PAUSED,this.uiManager.showPause())}resumeGame(){this.gameState===S.PAUSED&&(this.gameState=S.PLAYING,this.uiManager.showGame())}pauseAndShowShop(){this.gameState===S.PLAYING?(this.previousGameState=this.gameState,this.gameState=S.SHOP,this.uiManager.showShop()):this.gameState===S.MENU&&this.showShop()}showShop(){this.uiManager.showShop()}resumeFromShop(){this.previousGameState===S.PLAYING?(this.gameState=S.PLAYING,this.uiManager.showGame()):this.showMainMenu()}async showLeaderboard(){this.gameState===S.PLAYING&&(this.previousGameState=this.gameState,this.gameState=S.LEADERBOARD);const e=this.storageManager.getLeaderboard();await this.uiManager.showLeaderboard(e)}resumeFromLeaderboard(){this.previousGameState===S.PLAYING?(this.gameState=S.PLAYING,this.uiManager.showGame()):this.showMainMenu()}showControls(){this.gameState===S.PLAYING&&(this.previousGameState=this.gameState,this.gameState=S.CONTROLS),this.uiManager.showControls()}resumeFromControls(){this.previousGameState===S.PLAYING?(this.gameState=S.PLAYING,this.uiManager.showGame()):this.showMainMenu()}gameOver(){this.gameState=S.GAME_OVER,this.previousGameState=S.GAME_OVER,this.saveGameData(),this.uiManager.showGameOver(this.stats.score,this.stats.wave-1,this.stats.coins)}showMainMenu(){this.gameState=S.MENU,this.previousGameState=S.MENU,this.uiManager.showMainMenu()}async submitScore(e){try{await this.storageManager.addScore(e,this.stats.score,this.stats.wave-1),await this.showLeaderboard()}catch(t){console.error("Failed to submit score:",t),await this.showLeaderboard()}}purchaseUpgrade(e){const t=this.player.getUpgradeCost(e);return this.stats.coins>=t?(this.stats.coins-=t,this.player.upgrade(e),this.saveGameData(),this.uiManager.updateCoins(this.stats.coins),this.uiManager.updateUpgradeDisplay(this.player.getUpgrades()),!0):!1}}document.addEventListener("DOMContentLoaded",()=>{const r=document.getElementById("gameCanvas");if(!r){console.error("Canvas element not found!");return}new ur(r).start(),console.log("Space Battle Game v2.0 - Enemy Variety & Boss Battles Loaded"),console.log("Build timestamp:",new Date().toISOString())});
//# sourceMappingURL=index-ZlUybU87.js.map
